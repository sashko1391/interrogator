<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Interrogator: War Crimes</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Code+Pro:wght@400;500&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg-primary:#0a0a0c;--bg-secondary:#12121a;--bg-tertiary:#1a1a24;--bg-card:#15151f;--text-primary:#e8e6e3;--text-secondary:#9a9a9a;--text-muted:#5a5a6a;--accent-gold:#d4af37;--accent-gold-dim:#8b7323;--accent-red:#8b2942;--accent-red-bright:#c73e5c;--accent-green:#2d5a3d;--accent-green-bright:#4a9b6a;--border-color:#2a2a3a;--border-accent:#3a3a4a;--font-display:'Playfair Display',Georgia,serif;--font-body:'Crimson Pro',Georgia,serif;--font-mono:'Source Code Pro',monospace}
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        
        /* –®–†–ò–§–¢: 22px –ü–ö / 20px –ú–æ–±—ñ–ª—å–Ω—ñ */
        html{font-size:22px;scroll-behavior:smooth}
        
        /* –í–ê–ñ–õ–ò–í–ò–ô –§–Ü–ö–° –î–õ–Ø iPad/iPhone: min-height: 100dvh */
        body{
            font-family:var(--font-body);
            background:var(--bg-primary);
            color:var(--text-primary);
            width: 100%;
            height: 100dvh; /* Dynamic Viewport Height */
            overflow: hidden; /* –ó–∞–±–æ—Ä–æ–Ω—è—î–º–æ —Å–∫—Ä–æ–ª —Å–∞–º–æ–≥–æ —Ç—ñ–ª–∞, —Å–∫—Ä–æ–ª–∏–º–æ —Ç—ñ–ª—å–∫–∏ —á–∞—Ç */
            position: fixed; /* –§—ñ–∫—Å—É—î–º–æ, —â–æ–± –Ω–µ "—ó–∑–¥–∏–ª–æ" –Ω–∞ iOS */
        }
        
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none;z-index:1000}
        
        /* UI Elements Positioning */
        .top-controls-left {position:fixed;top:1rem;left:1rem;display:flex;gap:0.5rem;z-index:50;}
        .lang-switcher{position:fixed;top:1rem;right:1rem;display:flex;z-index:50}
        
        .icon-btn{background:rgba(18,18,26,0.9);border:1px solid var(--border-color);color:var(--text-muted);padding:0.4rem 0.7rem;font-family:var(--font-mono);font-size:0.6rem;cursor:pointer;transition:all 150ms;border-radius:4px;display:flex;align-items:center;justify-content:center;min-width:32px;}
        .icon-btn:hover{border-color:var(--border-accent);color:var(--text-secondary)}
        .icon-btn.active{background:var(--accent-gold-dim);border-color:var(--accent-gold-dim);color:var(--bg-primary)}
        
        .lang-btn{border-radius:0;border-right:none;}
        .lang-btn:first-child{border-radius:4px 0 0 4px;}
        .lang-btn:last-child{border-radius:0 4px 4px 0;border-right:1px solid var(--border-color);}
        
        /* Screens */
        .start-screen{
            height: 100dvh;
            width: 100%;
            display:flex;
            flex-direction:column;
            position:absolute; /* –©–æ–± –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—Ç–∏ –≥—Ä—É */
            top:0; left:0;
            overflow-y: auto; /* –°–∫—Ä–æ–ª –¥–ª—è —Å—Ç–∞—Ä—Ç–æ–≤–æ–≥–æ –µ–∫—Ä–∞–Ω—É */
            z-index: 100;
            background: var(--bg-primary);
        }
        
        .bg-fallback{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at 20% 20%,rgba(139,41,66,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(212,175,55,0.1) 0%,transparent 50%),linear-gradient(180deg,#0a0a0c 0%,#12121a 100%);z-index:-2}
        .bg-image{position:fixed;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;z-index:-1}
        .bg-image::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(to bottom,rgba(10,10,12,0.4) 0%,rgba(10,10,12,0.7) 50%,rgba(10,10,12,0.95) 100%)}
        .bg-landscape{background-image:url('bg-landscape.jpg');display:block}
        .bg-portrait{background-image:url('bg-portrait.jpg');display:none}
        @media(orientation:portrait){.bg-landscape{display:none}.bg-portrait{display:block}}
        
        .start-content{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:2rem;text-align:center;position:relative;z-index:1}
        .start-title{font-family:var(--font-display);font-size:2.5rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-primary);margin-bottom:0.5rem;text-shadow:0 0 60px rgba(212,175,55,0.3)}
        .start-tagline{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted);letter-spacing:0.3em;text-transform:uppercase;margin-bottom:2.5rem}
        .start-description{max-width:500px;color:var(--text-secondary);font-size:0.85rem;line-height:1.8;margin-bottom:2.5rem}
        
        .case-selection{width:100%;max-width:700px; padding-bottom: 2rem;}
        .case-selection-title{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted);letter-spacing:0.2em;text-transform:uppercase;margin-bottom:1.5rem}
        .case-cards{display:flex;flex-direction:column;gap:1rem}
        .case-card{background:rgba(21,21,31,0.9);border:1px solid var(--border-color);border-radius:4px;padding:1.25rem;cursor:pointer;transition:all 300ms;text-align:left;display:grid;grid-template-columns:auto 1fr auto;gap:1.25rem;align-items:center}
        .case-card:hover{border-color:var(--border-accent);background:rgba(26,26,36,0.95);transform:translateX(4px)}
        .case-difficulty{width:55px;height:55px;border-radius:4px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.1em}
        .case-difficulty--easy{background:rgba(45,90,61,0.3);border:1px solid var(--accent-green);color:var(--accent-green-bright)}
        .case-difficulty--medium{background:rgba(139,115,35,0.3);border:1px solid var(--accent-gold-dim);color:var(--accent-gold)}
        .case-difficulty--hard{background:rgba(139,41,66,0.3);border:1px solid var(--accent-red);color:var(--accent-red-bright)}
        .case-info{flex:1}
        .case-title{font-family:var(--font-display);font-size:0.95rem;color:var(--text-primary);margin-bottom:0.25rem}
        .case-subtitle{font-size:0.7rem;color:var(--text-secondary);line-height:1.5}
        .case-arrow{font-size:1.1rem;color:var(--text-muted);transition:transform 150ms}
        .case-card:hover .case-arrow{transform:translateX(4px);color:var(--text-secondary)}
        
        /* Game Screen */
        .game-screen{display:none; height:100dvh; width: 100%; position:relative}
        .game-screen.active{display:block}
        .game-screen .bg-fallback,.game-screen .bg-image{position:fixed}
        .start-screen.hidden{display:none}
        
        /* GAME CONTAINER: Flex Column Layout */
        .game-container{
            max-width:900px;
            margin:0 auto;
            padding:1rem;
            height:100dvh; /* –ó–∞–π–º–∞—î –≤—Å—é –¥–æ—Å—Ç—É–ø–Ω—É –≤–∏—Å–æ—Ç—É */
            display:flex;
            flex-direction:column;
            overflow: hidden; /* –ó–∞–±–æ—Ä–æ–Ω—è—î –≤–∏—Ö—ñ–¥ –∑–∞ –º–µ–∂—ñ */
        }
        
        /* –ì–Ω—É—á–∫—ñ –µ–ª–µ–º–µ–Ω—Ç–∏ (Header, Status, Briefing, Action) –º–∞—é—Ç—å —Å–≤—ñ–π –Ω–∞—Ç—É—Ä–∞–ª—å–Ω–∏–π —Ä–æ–∑–º—ñ—Ä */
        .game-header{text-align:center;padding:0.5rem 0;border-bottom:1px solid var(--border-color);margin-bottom:0.5rem;position:relative; flex-shrink: 0;}
        .game-header::after{content:'‚óÜ';position:absolute;bottom:-0.5rem;left:50%;transform:translateX(-50%);background:var(--bg-primary);padding:0 1rem;color:var(--accent-gold-dim);font-size:0.55rem}
        .game-title{font-family:var(--font-display);font-size:1.2rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-primary);margin-bottom:0;text-shadow:0 0 40px rgba(212,175,55,0.2)}
        .game-subtitle{font-family:var(--font-mono);font-size:0.5rem;color:var(--text-muted);letter-spacing:0.3em;text-transform:uppercase}
        
        .status-bar{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;padding:0.5rem 1rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;margin-bottom:0.5rem; flex-shrink: 0;}
        .status-item{display:flex;flex-direction:column;gap:0.25rem}
        .status-label{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--text-muted)}
        .status-value{display:flex;align-items:center;gap:0.5rem}
        .energy-display{font-family:var(--font-display);font-size:1.2rem;font-weight:700;color:var(--accent-gold)}
        .energy-max{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted)}
        .hint-counter{font-family:var(--font-mono);font-size:0.55rem;color:var(--accent-green-bright);margin-left:0.5rem}
        .suspicion-container{flex:1}
        .suspicion-bar-bg{height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}
        .suspicion-bar-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent-green),var(--accent-gold),var(--accent-red-bright));transition:width 300ms;border-radius:4px}
        .suspicion-value{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-secondary);margin-top:0.25rem}
        
        .briefing-container{margin-bottom:0.5rem; flex-shrink: 0;}
        .briefing-toggle{width:100%;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:0.6rem 1rem;color:var(--text-primary);font-family:var(--font-mono);font-size:0.65rem;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 150ms}
        .briefing-toggle:hover{background:var(--bg-tertiary);border-color:var(--border-accent)}
        .briefing-toggle.active .briefing-toggle-icon{transform:rotate(180deg)}
        
        /* BRIEFING IN FLOW: –®—Ç–æ–≤—Ö–∞—î —á–∞—Ç –≤–Ω–∏–∑ */
        .briefing-content{
            display:none;
            background:var(--bg-card);
            border:1px solid var(--border-color);
            border-top:none;
            border-radius:0 0 4px 4px;
            padding:1rem; 
            max-height: 40vh; /* –û–±–º–µ–∂–µ–Ω–Ω—è –≤–∏—Å–æ—Ç–∏ —Å–∞–º–æ–≥–æ –±—Ä—ñ—Ñ—ñ–Ω–≥—É, —â–æ–± –Ω–µ –∑–∞–π–Ω—è–≤ –≤–µ—Å—å –µ–∫—Ä–∞–Ω */
            overflow-y: auto;
        }
        .briefing-content.visible{display:block;animation:slideDown 300ms ease}
        @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        
        .briefing-section{margin-bottom:1rem}
        .briefing-section:last-child{margin-bottom:0}
        .briefing-section-title{font-family:var(--font-display);font-size:0.8rem;color:var(--accent-gold);margin-bottom:0.3rem;text-transform:uppercase;letter-spacing:0.1em}
        .briefing-text{color:var(--text-secondary);font-size:0.7rem;line-height:1.6}
        .evidence-list{list-style:none;padding-left:1rem}
        .evidence-list li{position:relative;padding-left:1rem;margin-bottom:0.3rem;color:var(--text-secondary);font-size:0.65rem}
        .evidence-list li::before{content:'‚ñ™';position:absolute;left:0;color:var(--accent-gold-dim)}
        
        /* --- CHAT CONTAINER: –ì–æ–ª–æ–≤–Ω–∏–π –µ–ª–µ–º–µ–Ω—Ç, —â–æ —Ä–æ–∑—Ç—è–≥—É—î—Ç—å—Å—è --- */
        .chat-container {
            flex-grow: 1; /* –ó–∞–±–∏—Ä–∞—î –≤–µ—Å—å –≤—ñ–ª—å–Ω–∏–π –ø—Ä–æ—Å—Ç—ñ—Ä */
            display: flex;
            flex-direction: column;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            overflow: hidden; /* –©–æ–± –≤–Ω—É—Ç—Ä—ñ—à–Ω—ñ–π —Å–∫—Ä–æ–ª –ø—Ä–∞—Ü—é–≤–∞–≤ */
            min-height: 0; /* –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Flexbox */
        }
        
        /* --- CHAT LOG: –°–∫—Ä–æ–ª–∏—Ç—å—Å—è –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ --- */
        .chat-log {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
            padding-bottom: 2rem; /* –í—ñ–¥—Å—Ç—É–ø –∑–Ω–∏–∑—É, —â–æ–± —Ç–µ–∫—Å—Ç –Ω–µ –ø—Ä–∏–ª–∏–ø–∞–≤ */
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
            scroll-behavior: auto; /* JS –∫–µ—Ä—É—î —Å–∫—Ä–æ–ª–æ–º */
        }
        
        .message{max-width:85%;padding:0.8rem 1rem;border-radius:4px;animation:messageIn 300ms ease}
        @keyframes messageIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .message-player{align-self:flex-end;background:var(--bg-tertiary);border:1px solid var(--border-accent);border-right:3px solid var(--accent-gold)}
        .message-npc{align-self:flex-start;background:var(--bg-card);border:1px solid var(--border-color);border-left:3px solid var(--accent-red)}
        .message-system{align-self:center;background:transparent;border:1px dashed var(--border-color);color:var(--text-muted);font-family:var(--font-mono);font-size:0.6rem;text-align:center;max-width:90%}
        .message-sender{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-muted);margin-bottom:0.25rem}
        .message-text{font-size:0.75rem;line-height:1.5; word-wrap: break-word;}
        
        .input-container{display:flex;gap:0.5rem;padding:0.8rem;background:var(--bg-tertiary);border-top:1px solid var(--border-color); flex-shrink: 0;}
        .chat-input{flex:1;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:4px;padding:0.8rem 1rem;color:var(--text-primary);font-family:var(--font-body);font-size:0.75rem;outline:none;transition:border-color 150ms}
        .chat-input:focus{border-color:var(--accent-gold-dim)}
        .send-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:0.8rem 1.2rem;color:var(--bg-primary);font-family:var(--font-mono);font-size:0.6rem;font-weight:500;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms}
        
        .action-bar{display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap: wrap; flex-shrink: 0; padding-bottom: 0.5rem;}
        .action-btn{flex:1;background:transparent;border:1px solid var(--border-color);border-radius:4px;padding:0.8rem 0.5rem;color:var(--text-secondary);font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms;min-width: 80px; text-align: center;}
        .action-btn:hover{border-color:var(--border-accent);color:var(--text-primary)}
        
        .action-btn--accuse{border-color:var(--accent-red);color:var(--accent-red-bright)}
        .action-btn--accuse:hover{background:var(--accent-red);color:var(--text-primary)}
        .action-btn--restart{border-color:var(--accent-gold-dim);color:var(--accent-gold)}
        .action-btn--restart:hover{background:var(--accent-gold-dim);color:var(--bg-primary)}
        .action-btn--hint{border-color:var(--accent-green);color:var(--accent-green-bright)}
        .action-btn--hint:hover{background:var(--accent-green);color:var(--text-primary)}
        .action-btn--hint:disabled{opacity:0.4;cursor:not-allowed;border-color:var(--border-color);color:var(--text-muted)}
        .action-btn--coffee{border-color: #8b5a2b; color: #cd853f;}
        .action-btn--coffee:hover{background: #8b5a2b; color: #fff;}
        .action-btn--reveal{border-color:var(--text-muted);color:var(--text-muted);font-size:0.5rem; width: 100%; margin-top: 0.2rem;}
        .action-btn--reveal:hover{border-color:var(--accent-red);color:var(--accent-red-bright)}
        
        .game-footer{text-align:center;padding:0.5rem 0;border-top:1px solid var(--border-color); flex-shrink: 0;}
        .game-footer-text{font-family:var(--font-mono);font-size:0.5rem;color:var(--text-muted);letter-spacing:0.1em}
        
        /* Modal */
        .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:200;align-items:center;justify-content:center}
        .modal-overlay.visible{display:flex}
        .modal-content{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:2rem;max-width:500px;width:90%;text-align:center;animation:modalIn 400ms ease; max-height: 90vh; overflow-y: auto;}
        
        .modal-icon{font-size:2.5rem;margin-bottom:1rem}
        .modal-title{font-family:var(--font-display);font-size:1.2rem;text-transform:uppercase;letter-spacing:0.15em;margin-bottom:1rem}
        .modal-title--win{color:var(--accent-green-bright)}
        .modal-title--lose{color:var(--accent-red-bright)}
        .modal-title--unsolved{color:var(--accent-gold)}
        .modal-text{color:var(--text-secondary);font-size:0.75rem;line-height:1.7;margin-bottom:1.5rem}
        .modal-reveal{background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:4px;padding:1rem;margin-bottom:1.5rem;text-align:left}
        .modal-btn-group{display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;}
        .modal-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:1rem 2rem;color:var(--bg-primary);font-family:var(--font-mono);font-size:0.65rem;font-weight:500;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms}
        .modal-btn:hover{background:var(--accent-gold)}
        .modal-btn--feedback{background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary);}
        .modal-btn--feedback:hover{border-color: var(--text-primary); color: var(--text-primary);}

        /* --- MOBILE ADAPTIVE (iPhone/iPad Fix) --- */
        @media(max-width:600px){
            html{font-size:20px} 
            .game-container {padding: 0.5rem;}
            .start-title{font-size:1.8rem}
            .game-title{font-size:1.2rem}
            .status-bar{grid-template-columns:1fr; gap: 0.5rem;}
            .action-bar{gap: 0.5rem;}
            .action-btn{flex-basis: 45%; padding: 0.8rem 0.2rem;}
            .case-card{grid-template-columns:auto 1fr}
            .case-arrow{display:none}
            .input-container {padding: 0.5rem; gap: 0.5rem;}
            .chat-input {padding: 0.6rem 0.8rem;}
            .send-btn {padding: 0.6rem 0.5rem; font-size: 0.55rem; white-space: nowrap;}
        }
    </style>
</head>
<body>
    <div class="lang-switcher">
        <button class="icon-btn lang-btn active" data-lang="en">EN</button>
        <button class="icon-btn lang-btn" data-lang="ua">UA</button>
    </div>

    <div class="top-controls-left">
        <button class="icon-btn" id="mute-btn" title="Toggle Sound">üîä</button>
        <button class="icon-btn" id="export-btn" title="Export Chat">üíæ</button>
        <button class="icon-btn" id="back-btn" data-i18n="backBtn">‚Üê Back</button>
    </div>

    <div class="start-screen" id="start-screen">
        <div class="bg-fallback"></div>
        <div class="bg-image bg-landscape"></div>
        <div class="bg-image bg-portrait"></div>
        <div class="start-content">
            <h1 class="start-title" data-i18n="startTitle">The Interrogator</h1>
            <p class="start-tagline" data-i18n="startTagline">AI-Powered Detective Game</p>
            <p class="start-description" data-i18n="startDescription">You are a Ukrainian investigator. The war is ongoing. Saboteurs are trying to infiltrate. Interrogate suspects using your own words. An AI Senior Detective will evaluate your skills.</p>
            <div class="case-selection">
                <h2 class="case-selection-title" data-i18n="selectCase">Select Your Case</h2>
                <div class="case-cards">
                    <div class="case-card case-card--easy" data-case="easy">
                        <div class="case-difficulty case-difficulty--easy"><span class="case-difficulty-icon">‚òÖ</span><span data-i18n="diffEasy">Easy</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case1Title">The Night Photographer</h3><p class="case-subtitle" data-i18n="case1Subtitle">Detained near a power plant. Claims to be a student.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                    <div class="case-card case-card--medium" data-case="medium">
                        <div class="case-difficulty case-difficulty--medium"><span class="case-difficulty-icon">‚òÖ‚òÖ</span><span data-i18n="diffMedium">Medium</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case2Title">The Lost Tractor Driver</h3><p class="case-subtitle" data-i18n="case2Subtitle">Found in a basement. Suspicious marks on face.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                    <div class="case-card case-card--hard" data-case="hard">
                        <div class="case-difficulty case-difficulty--hard"><span class="case-difficulty-icon">‚òÖ‚òÖ‚òÖ</span><span data-i18n="diffHard">Hard</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case3Title">The Humanitarian Volunteer</h3><p class="case-subtitle" data-i18n="case3Subtitle">Stopped at a checkpoint. Dogs smell explosives.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="game-screen" id="game-screen">
        <div class="bg-fallback"></div>
        <div class="bg-image bg-landscape"></div>
        <div class="bg-image bg-portrait"></div>
        
        <div class="game-container">
            <header class="game-header">
                <h1 class="game-title" id="game-title">The Interrogator</h1>
                <p class="game-subtitle" id="game-case-name">Case #001</p>
            </header>
            
            <div class="status-bar">
                <div class="status-item"><span class="status-label" data-i18n="energyLabel">Energy</span><div class="status-value"><span class="energy-display" id="energy-current">15</span><span class="energy-max">/ 15</span></div></div>
                <div class="status-item"><span class="status-label" data-i18n="suspicionLabel">Pressure</span><div class="suspicion-container"><div class="suspicion-bar-bg"><div class="suspicion-bar-fill" id="suspicion-bar"></div></div><span class="suspicion-value" id="suspicion-text">0%</span></div></div>
            </div>
            
            <div class="briefing-container">
                <button class="briefing-toggle" id="briefing-toggle"><span data-i18n="briefingToggle">üìÅ Case Briefing</span><span class="briefing-toggle-icon">‚ñº</span></button>
                <div class="briefing-content" id="briefing-content">
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="crimeTitle">The Context</h3><p class="briefing-text" id="case-description"></p></div>
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="factsTitle">Known Facts</h3><ul class="evidence-list" id="case-evidence"></ul></div>
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="suspectTitle">The Suspect</h3><p class="briefing-text" id="suspect-info"></p></div>
                </div>
            </div>
            
            <div class="chat-container">
                <div class="chat-log" id="chat-log"></div>
                <div class="input-container">
                    <input type="text" class="chat-input" id="chat-input" data-i18n-placeholder="inputPlaceholder" placeholder="Ask..." maxlength="500">
                    <button class="send-btn" id="send-btn" data-i18n="sendBtn">Send</button>
                </div>
            </div>
            
            <div class="action-bar">
                <button class="action-btn action-btn--hint" id="hint-btn" data-i18n="hintBtn">üí° Hint <span class="hint-counter" id="hint-counter">(3)</span></button>
                <button class="action-btn action-btn--coffee" id="coffee-btn" data-i18n="coffeeBtn">‚òï Coffee (+5)</button>
                <button class="action-btn action-btn--accuse" id="accuse-btn" data-i18n="accuseBtn">‚öñÔ∏è Verdict</button>
                <button class="action-btn action-btn--restart" id="restart-btn" data-i18n="restartBtn">‚Ü∫ Restart</button>
                <button class="action-btn action-btn--reveal" id="reveal-btn" data-i18n="revealBtn">üîì Reveal Answer</button>
            </div>
            
            <footer class="game-footer"><p class="game-footer-text">The Interrogator ‚Ä¢ v3.0</p></footer>
        </div>
    </div>
    
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">üîç</div>
            <h2 class="modal-title" id="modal-title">Case Closed</h2>
            <p class="modal-text" id="modal-text"></p>
            <div class="modal-reveal"><h4 class="modal-reveal-title" data-i18n="truthTitle">The Truth</h4><p class="modal-reveal-text" id="modal-reveal-text"></p></div>
            
            <div class="modal-btn-group">
                <button class="modal-btn" id="modal-btn" data-i18n="newCaseBtn">Back</button>
                <a href="https://forms.gle/xtrEqNsFb8wx7uyq5" target="_blank" class="modal-btn modal-btn--feedback" id="feedback-btn" data-i18n="feedbackBtn">üí¨ Send Feedback</a>
            </div>
        </div>
    </div>
    
    <audio id="audio-typewriter" src="p_machine.mp3" preload="auto" loop></audio>
    <audio id="audio-background" src="background.mp3" preload="auto" loop></audio>

    <script>
(function(){
'use strict';
const i18n = {
    en: {
        startTitle: "The Interrogator",
        startTagline: "AI-Powered Detective Game",
        startDescription: "You are a Ukrainian investigator. The war is ongoing. Saboteurs are trying to infiltrate. Interrogate suspects using your own words. An AI Senior Detective will evaluate your skills.",
        selectCase: "Select Your Case",
        diffEasy: "Easy",
        diffMedium: "Medium",
        diffHard: "Hard",
        case1Title: "The Night Photographer",
        case1Subtitle: "Detained near a power plant during a raid. Claims to be a student.",
        case2Title: "The Lost Tractor Driver",
        case2Subtitle: "Found hiding in a basement. Suspicious marks on face, soft hands.",
        case3Title: "The Humanitarian Volunteer",
        case3Subtitle: "Stopped at a checkpoint. Dogs smell explosives, but he delivers food.",
        backBtn: "‚Üê Back",
        energyLabel: "Energy",
        suspicionLabel: "Pressure",
        briefingToggle: "üìÅ Case Briefing",
        crimeTitle: "The Context",
        factsTitle: "Known Facts",
        suspectTitle: "The Suspect",
        inputPlaceholder: "Ask your question...",
        sendBtn: "Send",
        accuseBtn: "‚öñÔ∏è Verdict",
        restartBtn: "‚Ü∫ Restart",
        truthTitle: "The Truth",
        newCaseBtn: "Back",
        feedbackBtn: "üí¨ Send Feedback",
        calm: "Calm",
        nervous: "Nervous",
        defensive: "Defensive",
        breaking: "Breaking",
        detective: "Investigator",
        system: "System",
        winTitle: "Threat Neutralized",
        winText: "You identified the enemy correctly. Good work.",
        loseTitle: "Wrong Verdict",
        loseTextDefault: "Your accusation doesn't hold up.",
        loseTextWeak: "Right track, but not enough pressure to prove it.",
        unsolvedTitle: "Suspect Released",
        unsolvedText: "Questions exhausted. We had to let them go.",
        hintBtn: "üí° Hint",
        coffeeBtn: "‚òï Coffee (+5)",
        revealBtn: "üîì Reveal Answer",
        revealConfirm: "‚ö†Ô∏è WARNING!\n\nRevealing the truth exposes state secrets and ends the session.\n\nAre you sure? Type YES to confirm:",
        revealConfirmWord: "YES",
        hint1: "Check biography details (streets, prices, local knowledge).",
        hint2: "Press on inconsistencies in their cover story.",
        hint3: "Confront them with physical evidence (phone, marks, receipts)."
    },
    ua: {
        startTitle: "–°–ª—ñ–¥—á–∏–π",
        startTagline: "–î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞ –Ω–∞ –±–∞–∑—ñ –®–Ü",
        startDescription: "–í–∏ ‚Äî —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π —Å–ª—ñ–¥—á–∏–π. –ô–¥–µ –≤—ñ–π–Ω–∞. –î–∏–≤–µ—Ä—Å–∞–Ω—Ç–∏ –Ω–∞–º–∞–≥–∞—é—Ç—å—Å—è –ø—Ä–æ–Ω–∏–∫–Ω—É—Ç–∏ –≤ —Ç–∏–ª. –î–æ–ø–∏—Ç—É–π—Ç–µ –ø—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–∏—Ö —Å–≤–æ—ó–º–∏ —Å–ª–æ–≤–∞–º–∏. –®–Ü '–°—Ç–∞—Ä—à–∏–π —Å–ª—ñ–¥—á–∏–π' –æ—Ü—ñ–Ω–∏—Ç—å –≤–∞—à—ñ –Ω–∞–≤–∏—á–∫–∏ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å.",
        selectCase: "–û–±–µ—Ä—ñ—Ç—å —Å–ø—Ä–∞–≤—É",
        diffEasy: "–õ–µ–≥–∫–æ",
        diffMedium: "–°–µ—Ä–µ–¥–Ω—å–æ",
        diffHard: "–°–∫–ª–∞–¥–Ω–æ",
        case1Title: "–ù—ñ—á–Ω–∏–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ",
        case1Subtitle: "–ó–∞—Ç—Ä–∏–º–∞–Ω–∏–π –±—ñ–ª—è –¢–ï–¶ –ø—ñ–¥ —á–∞—Å –Ω–∞–ª—å–æ—Ç—É. –ö–∞–∂–µ, —â–æ —Å—Ç—É–¥–µ–Ω—Ç-—Ö—É–¥–æ–∂–Ω–∏–∫.",
        case2Title: "–ó–∞–≥—É–±–ª–µ–Ω–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç",
        case2Subtitle: "–ó–Ω–∞–π–¥–µ–Ω–∏–π —É –ø—ñ–¥–≤–∞–ª—ñ. –ü—ñ–¥–æ–∑—Ä—ñ–ª—ñ —Å–ª—ñ–¥–∏ –Ω–∞ –æ–±–ª–∏—á—á—ñ, –º'—è–∫—ñ —Ä—É–∫–∏.",
        case3Title: "–í–æ–ª–æ–Ω—Ç–µ—Ä –∑ –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–∫–æ—é",
        case3Subtitle: "–ó—É–ø–∏–Ω–µ–Ω–∏–π –Ω–∞ –±–ª–æ–∫–ø–æ—Å—Ç—É. –°–æ–±–∞–∫–∏ —á—É—é—Ç—å –≤–∏–±—É—Ö—ñ–≤–∫—É, –∞–ª–µ –≤—ñ–Ω –≤–µ–∑–µ —ó–∂—É.",
        backBtn: "‚Üê –ù–∞–∑–∞–¥",
        energyLabel: "–ï–Ω–µ—Ä–≥—ñ—è",
        suspicionLabel: "–¢–∏—Å–∫",
        briefingToggle: "üìÅ –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ —Å–ø—Ä–∞–≤–∏",
        crimeTitle: "–û–±—Å—Ç–∞–≤–∏–Ω–∏",
        factsTitle: "–í—ñ–¥–æ–º—ñ —Ñ–∞–∫—Ç–∏",
        suspectTitle: "–ü—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–∏–π",
        inputPlaceholder: "–ó–∞–¥–∞–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è...",
        sendBtn: "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏",
        accuseBtn: "‚öñÔ∏è –í–µ—Ä–¥–∏–∫—Ç",
        restartBtn: "‚Ü∫ –°–ø–æ—á–∞—Ç–∫—É",
        truthTitle: "–ü—Ä–∞–≤–¥–∞",
        newCaseBtn: "–ù–∞–∑–∞–¥",
        feedbackBtn: "üí¨ –ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –≤—ñ–¥–≥—É–∫",
        calm: "–°–ø–æ–∫—ñ–π–Ω–∏–π",
        nervous: "–ù–µ—Ä–≤—É—î",
        defensive: "–ó–∞—Ö–∏—â–∞—î—Ç—å—Å—è",
        breaking: "–õ–∞–º–∞—î—Ç—å—Å—è",
        detective: "–°–ª—ñ–¥—á–∏–π",
        system: "–°–∏—Å—Ç–µ–º–∞",
        winTitle: "–ó–∞–≥—Ä–æ–∑—É –ª—ñ–∫–≤—ñ–¥–æ–≤–∞–Ω–æ",
        winText: "–í–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞–ª–∏ –≤–æ—Ä–æ–≥–∞. –ì–∞—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞.",
        loseTitle: "–ü–æ–º–∏–ª–∫–æ–≤–∏–π –≤–µ—Ä–¥–∏–∫—Ç",
        loseTextDefault: "–ó–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏–ª–æ—Å—è —Ñ–∞–∫—Ç–∞–º–∏.",
        loseTextWeak: "–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö, –∞–ª–µ —Ç–∏—Å–∫—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –¥–ª—è –∑—ñ–∑–Ω–∞–Ω–Ω—è.",
        unsolvedTitle: "–ü—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–æ–≥–æ –≤—ñ–¥–ø—É—â–µ–Ω–æ",
        unsolvedText: "–ü–∏—Ç–∞–Ω–Ω—è –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –î–æ–∫–∞–∑—ñ–≤ –¥–ª—è –∞—Ä–µ—à—Ç—É –∑–∞–±—Ä–∞–∫–ª–æ.",
        hintBtn: "üí° –ü—ñ–¥–∫–∞–∑–∫–∞",
        coffeeBtn: "‚òï –ö–∞–≤–∞ (+5)",
        revealBtn: "üîì –†–æ–∑–∫—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å",
        revealConfirm: "‚ö†Ô∏è –£–í–ê–ì–ê!\n\n–†–æ–∑–∫—Ä–∏—Ç—Ç—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –æ–∑–Ω–∞—á–∞—î —Ä–æ–∑–≥–æ–ª–æ—à–µ–Ω–Ω—è –¥–µ—Ä–∂–∞–≤–Ω–æ—ó —Ç–∞—î–º–Ω–∏—Ü—ñ. –°–µ—Å—ñ—é –±—É–¥–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.\n\n–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –í–≤–µ–¥—ñ—Ç—å –¢–ê–ö –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:",
        revealConfirmWord: "–¢–ê–ö",
        hint1: "–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–Ω–∞–Ω–Ω—è –º—ñ—Å—Ü–µ–≤–æ—Å—Ç—ñ (–≤—É–ª–∏—Ü—ñ, —Ü—ñ–Ω–∏, –∑–∞–∫–ª–∞–¥–∏).",
        hint2: "–¢–∏—Å–Ω—ñ—Ç—å –Ω–∞ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤ –ª–µ–≥–µ–Ω–¥—ñ.",
        hint3: "–í–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ä–µ—á–æ–≤—ñ –¥–æ–∫–∞–∑–∏ (—Ç–µ–ª–µ—Ñ–æ–Ω, —Å–ª—ñ–¥–∏ –Ω–∞ —Ç—ñ–ª—ñ, –¥–æ–∫—É–º–µ–Ω—Ç–∏)."
    }
};

const CASES = {
    easy: {
        id: "easy",
        caseNumber: "#001",
        winThreshold: 40,
        en: {
            title: "The Night Photographer",
            suspectName: "Andrey (Suspect)",
            crimeDescription: "A man was detained near a critical power plant at 2:00 AM immediately after a missile strike nearby. He claims to be a student taking artistic photos of the night sky.",
            knownFacts: [
                "Detained 500m from the thermal power plant impact zone.",
                "Phone gallery is completely empty (recently deleted).",
                "Telegram app hidden inside a 'Calculator' folder.",
                "Hands have traces of fluorescent marker (used for marking targets).",
                "Cannot name the Rector of the university he claims to attend.",
                "Found with a high-capacity power bank and two SIM cards."
            ],
            suspectProfile: "Claiming to be Andrey, 22, student. Nervous, constantly looks at his phone. Speaks with a slight distinct accent not typical for this region.",
            truthReveal: "He is a Russian spotter hired via Telegram bot. He marked the target for the missile strike. He deleted photos when caught. He is not a student.",
            sessionStart: "Interrogation of detainee 'Andrey' ‚Äî Caught near critical infrastructure.",
            npcGreeting: "*shaking slightly* Officer, this is a mistake. I'm just an art student. I like... industrial aesthetics. Why am I here?",
            accusationPrompt: "Verdict:\n1. He is a spotter (Saboteur)\n2. Just a student\n3. Looting attempt\n4. Breaking curfew only\n\nEnter 1-4:",
            wrongAccusations: {
                "2": "Students don't carry target markers and hide Telegram apps.",
                "3": "He had no tools for stealing, only for communication.",
                "4": "Presence at impact site implies more than just curfew violation."
            }
        },
        ua: {
            title: "–ù—ñ—á–Ω–∏–π —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ",
            suspectName: "–ê–Ω–¥—Ä—ñ–π (–ó–∞—Ç—Ä–∏–º–∞–Ω–∏–π)",
            crimeDescription: "–ë—ñ–ª—è –¢–ï–¶ –æ 2-–π –Ω–æ—á—ñ –∑–∞—Ç—Ä–∏–º–∞–Ω–æ —á–æ–ª–æ–≤—ñ–∫–∞ –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è –ø—Ä–∏–ª—å–æ—Ç—É —Ä–∞–∫–µ—Ç–∏. –°—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ –≤—ñ–Ω —Å—Ç—É–¥–µ–Ω—Ç —ñ —Ä–æ–±–∏–≤ —Ö—É–¥–æ–∂–Ω—ñ —Ñ–æ—Ç–æ –Ω—ñ—á–Ω–æ–≥–æ –Ω–µ–±–∞. –¢–µ–ª–µ—Ñ–æ–Ω '—á–∏—Å—Ç–∏–π'.",
            knownFacts: [
                "–ó–∞—Ç—Ä–∏–º–∞–Ω–∏–π –∑–∞ 500–º –≤—ñ–¥ –º—ñ—Å—Ü—è –≤–ª—É—á–∞–Ω–Ω—è –≤ –¢–ï–¶.",
                "–ì–∞–ª–µ—Ä–µ—è —Ç–µ–ª–µ—Ñ–æ–Ω—É –ø–æ–≤–Ω—ñ—Å—Ç—é –ø—É—Å—Ç–∞ (–Ω–µ–¥–∞–≤–Ω–æ –≤–∏–¥–∞–ª–µ–Ω–∞).",
                "–¢–µ–ª–µ–≥—Ä–∞–º –ø—Ä–∏—Ö–æ–≤–∞–Ω–æ –≤ –ø–∞–ø—Ü—ñ '–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä'.",
                "–ù–∞ —Ä—É–∫–∞—Ö —Å–ª—ñ–¥–∏ –ª—é–º—ñ–Ω–µ—Å—Ü–µ–Ω—Ç–Ω–æ—ó —Ñ–∞—Ä–±–∏ (–¥–ª—è –º—ñ—Ç–æ–∫).",
                "–ù–µ –º–æ–∂–µ –Ω–∞–∑–≤–∞—Ç–∏ —Ä–µ–∫—Ç–æ—Ä–∞ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É, –¥–µ –Ω—ñ–±–∏—Ç–æ –≤—á–∏—Ç—å—Å—è.",
                "–ü—Ä–∏ —Å–æ–±—ñ –º–∞–≤ –ø–æ—Ç—É–∂–Ω–∏–π –ø–∞–≤–µ—Ä–±–∞–Ω–∫ —ñ –¥–≤—ñ —Å—ñ–º-–∫–∞—Ä—Ç–∏."
            ],
            suspectProfile: "–ù–∞–∑–∏–≤–∞—î—Ç—å—Å—è –ê–Ω–¥—Ä—ñ—î–º, 22 —Ä–æ–∫–∏. –ù–µ—Ä–≤—É—î, –ø–æ—Å—Ç—ñ–π–Ω–æ –∫–æ—Å–∏—Ç—å—Å—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Å–ª–æ–≤–∞, –Ω–µ—Ç–∏–ø–æ–≤—ñ –¥–ª—è –º—ñ—Å—Ü–µ–≤–∏—Ö.",
            truthReveal: "–¶–µ —Ä–æ—Å—ñ–π—Å—å–∫–∏–π –∫–æ—Ä–∏–≥—É–≤–∞–ª—å–Ω–∏–∫, –∑–∞–≤–µ—Ä–±–æ–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ –±–æ—Ç. –í—ñ–Ω –Ω–∞–≤–æ–¥–∏–≤ —É–¥–∞—Ä –ø–æ –¢–ï–¶. –§–æ—Ç–æ –≤–∏–¥–∞–ª–∏–≤ –ø—Ä–∏ –∑–∞—Ç—Ä–∏–º–∞–Ω–Ω—ñ. –°—Ç—É–¥–µ–Ω—Ç—Å—å–∫–∏–π –∫–≤–∏—Ç–æ–∫ –ø—ñ–¥—Ä–æ–±–Ω–∏–π.",
            sessionStart: "–î–æ–ø–∏—Ç –∑–∞—Ç—Ä–∏–º–∞–Ω–æ–≥–æ –±—ñ–ª—è –æ–±'—î–∫—Ç–∞ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏.",
            npcGreeting: "*—Ç—Ä–µ–º—Ç–∏—Ç—å* –û—Ñ—ñ—Ü–µ—Ä–µ, —Ü–µ –ø–æ–º–∏–ª–∫–∞. –Ø –ø—Ä–æ—Å—Ç–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ-–∞–º–∞—Ç–æ—Ä. –õ—é–±–ª—é... —ñ–Ω–¥—É—Å—Ç—Ä—ñ–∞–ª—å–Ω—É –µ—Å—Ç–µ—Ç–∏–∫—É. –ó–∞ —â–æ –º–µ–Ω–µ –≤–∑—è–ª–∏?",
            accusationPrompt: "–í–µ—Ä–¥–∏–∫—Ç:\n1. –¶–µ –∫–æ—Ä–∏–≥—É–≤–∞–ª—å–Ω–∏–∫ (–î–∏–≤–µ—Ä—Å–∞–Ω—Ç)\n2. –ü—Ä–æ—Å—Ç–æ —Å—Ç—É–¥–µ–Ω—Ç\n3. –ú–∞—Ä–æ–¥–µ—Ä\n4. –ü–æ—Ä—É—à–Ω–∏–∫ –∫–æ–º–µ–Ω–¥–∞–Ω—Ç—Å—å–∫–æ—ó –≥–æ–¥–∏–Ω–∏\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
            wrongAccusations: {
                "2": "–°—Ç—É–¥–µ–Ω—Ç–∏ –Ω–µ —Ö–æ–≤–∞—é—Ç—å –¢–µ–ª–µ–≥—Ä–∞–º —ñ –Ω–µ –º–∞—é—Ç—å —Ñ–∞—Ä–±–∏ –¥–ª—è –º—ñ—Ç–æ–∫.",
                "3": "–£ –Ω—å–æ–≥–æ –Ω–µ –±—É–ª–æ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ –¥–ª—è –∫—Ä–∞–¥—ñ–∂–∫–∏.",
                "4": "–ü–µ—Ä–µ–±—É–≤–∞–Ω–Ω—è –Ω–∞ –º—ñ—Å—Ü—ñ –ø—Ä–∏–ª—å–æ—Ç—É –≤–∫–∞–∑—É—î –Ω–∞ —à–ø–∏–≥—É–Ω—Å—Ç–≤–æ."
            }
        },
        suspicionTriggers: {
            high: ['telegram', 'bot', 'mark', 'money', 'rubles', 'coord', 'phone', 'gallery', 'delete', 'prison', 'jail', 'russia', 'fsb', 'omsk', 'piter', 'mother', 'mom', '—Ç–µ–ª–µ–≥—Ä–∞–º', '–±–æ—Ç', '–≥—Ä–æ—à—ñ', '–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏', '–∫—É—Ä–∞—Ç–æ—Ä', '—Ñ–æ—Ç–æ', '—Ç–µ–ª–µ—Ñ–æ–Ω', '–≥–∞–ª–µ—Ä–µ—è', '–≤–∏–¥–∞–ª–∏–≤', '—Ç—é—Ä–º–∞', '–∑–æ–Ω–∞', '–ø–ª—è—à–∫–∞', '—Ä–æ—Å—ñ—è', '—Ñ—Å–±', '–æ–º—Å–∫', '–ø—ñ—Ç–µ—Ä', '–º–∞–º–∞', '–º–∞—Ç—ñ—Ä', '–∑—ñ–∑–Ω–∞–≤–∞–π—Å—è'],
            medium: ['university', 'rector', 'dean', 'night', 'student', 'paint', 'hands', '—É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç', '—Ä–µ–∫—Ç–æ—Ä', '–¥–µ–∫–∞–Ω', '–Ω—ñ—á', '–Ω–∞–≤—á–∞–Ω–Ω—è', '—Å—Ç—É–¥–µ–Ω—Ç', '—Ñ–∞—Ä–±–∞', '—Ä—É–∫–∏', '—Å–ª—ñ–¥–∏'],
            low: ['camera', 'sky', 'art', 'city', '–∫–∞–º–µ—Ä–∞', '–Ω–µ–±–æ', '–º—ñ—Å—Ç–æ', '–≥—É–ª—è–≤']
        }
    },

    medium: {
        id: "medium",
        caseNumber: "#002",
        winThreshold: 50,
        en: {
            title: "The Lost Tractor Driver",
            suspectName: "Mykola (Suspect)",
            crimeDescription: "A man in civilian clothes was found hiding in a basement in a liberated village. He claims to be 'Mykola', a local tractor driver. However, a Russian Su-34 was shot down nearby yesterday.",
            knownFacts: [
                "Found 3km from the jet crash site.",
                "Wearing civilian clothes that are too large for him.",
                "Face has distinctive red marks (typical from pilot oxygen masks).",
                "Hands are soft and clean, not typical for a tractor driver.",
                "Doesn't know the price of bread in the local shop.",
                "A half-burned parachute was found in the forest nearby.",
                "Speaks Russian with a distinct accent, struggles with Ukrainian words."
            ],
            suspectProfile: "Male, approx 35. Calm, disciplined posture. Claims he lost his documents when his house burned down. Refuses to show his torso (possible tattoos/injuries).",
            truthReveal: "He is a Russian pilot of the downed Su-34. He ejected, broke into a house to steal clothes, and tried to blend in. The marks on his face are from the G-suit mask.",
            sessionStart: "Interrogation of 'Mykola' ‚Äî Found in liberated zone.",
            npcGreeting: "*sitting straight, avoiding eye contact* I am a simple man, citizen chief. My tractor burned, my house burned. I was just hiding from the noise.",
            accusationPrompt: "Verdict:\n1. Russian Pilot\n2. Local Tractor Driver\n3. Looter\n4. Deserter\n\nEnter 1-4:",
            wrongAccusations: {
                "2": "His hands and face marks betray him. He is military.",
                "3": "He is hiding, not stealing.",
                "4": "He is not Ukrainian military."
            }
        },
        ua: {
            title: "–ó–∞–≥—É–±–ª–µ–Ω–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç",
            suspectName: "–ú–∏–∫–æ–ª–∞ (–ó–∞—Ç—Ä–∏–º–∞–Ω–∏–π)",
            crimeDescription: "–£ –∑–≤—ñ–ª—å–Ω–µ–Ω–æ–º—É —Å–µ–ª—ñ –≤ –ø—ñ–¥–≤–∞–ª—ñ –∑–Ω–∞–π—à–ª–∏ —á–æ–ª–æ–≤—ñ–∫–∞ –≤ —Ü–∏–≤—ñ–ª—å–Ω–æ–º—É. –ö–∞–∂–µ, —â–æ –≤—ñ–Ω –º—ñ—Å—Ü–µ–≤–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç –ú–∏–∫–æ–ª–∞. –í—á–æ—Ä–∞ –ø–æ—Ä—É—á –±—É–ª–æ –∑–±–∏—Ç–æ —Ä–æ—Å—ñ–π—Å—å–∫–∏–π –°—É-34.",
            knownFacts: [
                "–ó–Ω–∞–π–¥–µ–Ω–∏–π –∑–∞ 3 –∫–º –≤—ñ–¥ –º—ñ—Å—Ü—è –ø–∞–¥—ñ–Ω–Ω—è –ª—ñ—Ç–∞–∫–∞.",
                "–û–¥—è–≥–Ω–µ–Ω–∏–π —É —Ü–∏–≤—ñ–ª—å–Ω–µ, —è–∫–µ —è–≤–Ω–æ –≤–µ–ª–∏–∫–µ –Ω–∞ –Ω—å–æ–≥–æ.",
                "–ù–∞ –æ–±–ª–∏—á—á—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω—ñ —á–µ—Ä–≤–æ–Ω—ñ —Å–ª—ñ–¥–∏ (–≤—ñ–¥ –∫–∏—Å–Ω–µ–≤–æ—ó –º–∞—Å–∫–∏ –ø—ñ–ª–æ—Ç–∞).",
                "–†—É–∫–∏ –¥–æ–≥–ª—è–Ω—É—Ç—ñ, –º'—è–∫—ñ, –±–µ–∑ –º–æ–∑–æ–ª—ñ–≤ (–Ω–µ —Å—Ö–æ–∂–µ –Ω–∞ —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç–∞).",
                "–ù–µ –∑–Ω–∞—î —Ü—ñ–Ω—É –Ω–∞ —Ö–ª—ñ–± —É –º—ñ—Å—Ü–µ–≤–æ–º—É –º–∞–≥–∞–∑–∏–Ω—ñ.",
                "–£ –ª—ñ—Å—ñ –ø–æ—Ä—É—á –∑–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∏–∫–æ–ø–∞–Ω–∏–π –ø–∞—Ä–∞—à—É—Ç.",
                "–ù–µ –º–æ–∂–µ –≤–∏–º–æ–≤–∏—Ç–∏ —Å–ª–æ–≤–æ '–ü–∞–ª—è–Ω–∏—Ü—è' –±–µ–∑ –∞–∫—Ü–µ–Ω—Ç—É."
            ],
            suspectProfile: "–ß–æ–ª–æ–≤—ñ–∫, –±–ª. 35 —Ä–æ–∫—ñ–≤. –°–∏–¥–∏—Ç—å —Ä—ñ–≤–Ω–æ, –ø–æ-–≤—ñ–π—Å—å–∫–æ–≤–æ–º—É. –ö–∞–∂–µ, –¥–æ–∫—É–º–µ–Ω—Ç–∏ –∑–≥–æ—Ä—ñ–ª–∏. –í—ñ–¥–º–æ–≤–ª—è—î—Ç—å—Å—è —Ä–æ–∑–¥—è–≥—Ç–∏—Å—è (–º–æ–∂–ª–∏–≤—ñ —Ç–∞—Ç—É –∞–±–æ –ø–æ—Ä–∞–Ω–µ–Ω–Ω—è –≤—ñ–¥ –∫–∞—Ç–∞–ø—É–ª—å—Ç—É–≤–∞–Ω–Ω—è).",
            truthReveal: "–¶–µ –ø—ñ–ª–æ—Ç –∑–±–∏—Ç–æ–≥–æ –°—É-34. –í—ñ–Ω –∫–∞—Ç–∞–ø—É–ª—å—Ç—É–≤–∞–≤—Å—è, –≤–∫—Ä–∞–≤ –æ–¥—è–≥ —É —Ö–∞—Ç—ñ —ñ –Ω–∞–º–∞–≥–∞—î—Ç—å—Å—è –≤–∏–π—Ç–∏ –¥–æ —Å–≤–æ—ó—Ö. –°–ª—ñ–¥–∏ –Ω–∞ –æ–±–ª–∏—á—á—ñ ‚Äî –≤—ñ–¥ —à–æ–ª–æ–º–æ—Ñ–æ–Ω–∞ —Ç–∞ –º–∞—Å–∫–∏.",
            sessionStart: "–î–æ–ø–∏—Ç '–ú–∏–∫–æ–ª–∏' ‚Äî –ó–Ω–∞–π–¥–µ–Ω–∏–π —É –∑–æ–Ω—ñ –±–æ–π–æ–≤–∏—Ö –¥—ñ–π.",
            npcGreeting: "*—Å–∏–¥–∏—Ç—å –ø—Ä—è–º–æ, –æ—á—ñ –æ–ø—É—Å—Ç–∏–≤* –Ø –ø—Ä–æ—Å—Ç–∞ –ª—é–¥–∏–Ω–∞, –Ω–∞—á–∞–ª—å–Ω–∏–∫. –¢—Ä–∞–∫—Ç–æ—Ä –∑–≥–æ—Ä—ñ–≤, —Ö–∞—Ç–∞ –∑–≥–æ—Ä—ñ–ª–∞. –Ø –ø—Ä–æ—Å—Ç–æ —Ö–æ–≤–∞–≤—Å—è –≤—ñ–¥ –≤–∏–±—É—Ö—ñ–≤.",
            accusationPrompt: "–í–µ—Ä–¥–∏–∫—Ç:\n1. –†–æ—Å—ñ–π—Å—å–∫–∏–π –ø—ñ–ª–æ—Ç\n2. –ú—ñ—Å—Ü–µ–≤–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç\n3. –ú–∞—Ä–æ–¥–µ—Ä\n4. –î–µ–∑–µ—Ä—Ç–∏—Ä\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
            wrongAccusations: {
                "2": "–†—É–∫–∏ —Ç–∞ —Å–ª—ñ–¥–∏ –º–∞—Å–∫–∏ –≤–∏–¥–∞—é—Ç—å –π–æ–≥–æ. –¶–µ –≤—ñ–π—Å—å–∫–æ–≤–∏–π.",
                "3": "–í—ñ–Ω —Ö–æ–≤–∞–≤—Å—è, –∞ –Ω–µ –∫—Ä–∞–≤.",
                "4": "–í—ñ–Ω –Ω–µ –∑ –Ω–∞—à–∏—Ö –≤—ñ–π—Å—å–∫."
            }
        },
        suspicionTriggers: {
            high: ['plane', 'pilot', 'mask', 'sky', 'parachute', 'eject', 'rank', 'unit', 'prison', 'russia', 'army', 'bomb', '–ª—ñ—Ç–∞–∫', '–ø—ñ–ª–æ—Ç', '–º–∞—Å–∫–∞', '–ø–∞—Ä–∞—à—É—Ç', '–∫–∞—Ç–∞–ø—É–ª—å—Ç', '–∑–≤–∞–Ω–Ω—è', '—á–∞—Å—Ç–∏–Ω–∞', '—Å—É-34', '—Ç—é—Ä–º–∞', '–∞—Ä–º—ñ—è', '—Ä–æ—Å—ñ—è', '–±–æ–º–±–∏–≤'],
            medium: ['hands', 'soft', 'tractor', 'field', 'bread', 'price', '—Ä—É–∫–∏', '–º–æ–∑–æ–ª—ñ', '—Ç—Ä–∞–∫—Ç–æ—Ä', '–ø–æ–ª–µ', '—Ö–ª—ñ–±', '—Ü—ñ–Ω–∞', '–ø–∞–ª—è–Ω–∏—Ü—è'],
            low: ['house', 'burn', '—Ö–∞—Ç–∞', '–ø–æ–∂–µ–∂–∞', '–¥–æ–∫—É–º–µ–Ω—Ç–∏']
        }
    },

    hard: {
        id: "hard",
        caseNumber: "#003",
        winThreshold: 60,
        en: {
            title: "The Humanitarian Volunteer",
            suspectName: "Alexey (Suspect)",
            crimeDescription: "A van marked 'VOLUNTEER' was stopped at a checkpoint entering Kyiv. The driver, Alexey, has papers confirming he delivers food. But K-9 dogs reacted to the vehicle.",
            knownFacts: [
                "Dogs reacted to the scent of explosives, but only food is visible.",
                "Driver's passport was issued in Crimea in 2013 (before annexation? No, 2015).",
                "Found a receipt from a gas station in Belgorod (Russia) dated 3 days ago.",
                "Uses specific military slang ('green zone', 'cargo 200').",
                "The 'Volunteer Fund' he works for has no Facebook page.",
                "Car tires have soil traces not matching this region."
            ],
            suspectProfile: "Alexey, 40. Confident, slightly arrogant. Claims he buys fuel from smugglers, explaining the receipt. Insists on calling his 'lawyer'.",
            truthReveal: "He is a GRU sleeper agent. The van has a double floor filled with C4 explosives meant for a terrorist act in the capital. The 'food' is a cover.",
            sessionStart: "Interrogation of 'Alexey' ‚Äî Checkpoint detention.",
            npcGreeting: "*leaning back arrogantly* Look, I'm bringing food to hungry people. Every minute you keep me here is a crime. Check the boxes, it's just pasta.",
            accusationPrompt: "Verdict:\n1. GRU Agent / Terrorist\n2. Honest Volunteer\n3. Smuggler\n4. Document Forger\n\nEnter 1-4:",
            wrongAccusations: {
                "2": "Volunteers don't visit Belgorod during war.",
                "3": "Explosives traces indicate terror, not smuggling.",
                "4": "Forgery is just part of the cover for the main crime."
            }
        },
        ua: {
            title: "–í–æ–ª–æ–Ω—Ç–µ—Ä –∑ –≥—É–º–∞–Ω—ñ—Ç–∞—Ä–∫–æ—é",
            suspectName: "–û–ª–µ–∫—Å—ñ–π (–ó–∞—Ç—Ä–∏–º–∞–Ω–∏–π)",
            crimeDescription: "–ú—ñ–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å –∑ –Ω–∞–ø–∏—Å–æ–º '–î–Ü–¢–ò' –∑—É–ø–∏–Ω–∏–ª–∏ –Ω–∞ –≤'—ó–∑–¥—ñ –¥–æ –ö–∏—î–≤–∞. –í–æ–¥—ñ–π –û–ª–µ–∫—Å—ñ–π –º–∞—î –¥–æ–∫—É–º–µ–Ω—Ç–∏ –≤–æ–ª–æ–Ω—Ç–µ—Ä–∞. –ê–ª–µ —Å–ª—É–∂–±–æ–≤–∏–π —Å–æ–±–∞–∫–∞ –∑—Ä–µ–∞–≥—É–≤–∞–≤ –Ω–∞ –∞–≤—Ç–æ.",
            knownFacts: [
                "–°–æ–±–∞–∫–∞ –≤—ñ–¥—á—É–ª–∞ –∑–∞–ø–∞—Ö –≤–∏–±—É—Ö—ñ–≤–∫–∏, —Ö–æ—á–∞ –≤–∏–¥–Ω–æ –ª–∏—à–µ –º–∞–∫–∞—Ä–æ–Ω–∏.",
                "–£ –∫–∏—à–µ–Ω—ñ –∑–Ω–∞–π–¥–µ–Ω–æ —á–µ–∫ —ñ–∑ –∑–∞–ø—Ä–∞–≤–∫–∏ '–†–æ—Å–Ω–µ—Ñ—Ç—å' (–ë—î–ª–≥–æ—Ä–æ–¥), –¥–∞—Ç–∞ - 3 –¥–Ω—ñ —Ç–æ–º—É.",
                "–ü–∞—Å–ø–æ—Ä—Ç –≤–∏–¥–∞–Ω–∏–π —É –ö—Ä–∏–º—É, —Å–µ—Ä—ñ—è –¥–∏–≤–Ω–∞.",
                "–í–∂–∏–≤–∞—î —Å–ª–æ–≤–∞ '–ø–æ—Ä—î–±—Ä—ñ–∫', '—Å–±–µ—Ä–∫–∞—Å—Å–∞'.",
                "–§–æ–Ω–¥, –≤—ñ–¥ —è–∫–æ–≥–æ –≤—ñ–Ω —ó–¥–µ, –Ω–µ –≥—É–≥–ª–∏—Ç—å—Å—è.",
                "–®–∏–Ω–∏ –∞–≤—Ç–æ —á–∏—Å—Ç—ñ, —Ö–æ—á–∞ –∫–∞–∂–µ, —â–æ —ó—Ö–∞–≤ –ø–æ–ª—è–º–∏ –∑ —Ñ—Ä–æ–Ω—Ç—É."
            ],
            suspectProfile: "–û–ª–µ–∫—Å—ñ–π, 40 —Ä–æ–∫—ñ–≤. –í–ø–µ–≤–Ω–µ–Ω–∏–π, –Ω–∞—Ö–∞–±–Ω–∏–π. –ö–∞–∂–µ, —á–µ–∫ –ø—ñ–¥–∫–∏–Ω—É–ª–∏ –∞–±–æ —Ü–µ —Å—Ç–∞—Ä–∏–π. –ü–æ–≥—Ä–æ–∂—É—î —Å–∫–∞—Ä–≥–∞–º–∏. –ù–∞–º–∞–≥–∞—î—Ç—å—Å—è '–¥–æ–º–æ–≤–∏—Ç–∏—Å—å'.",
            truthReveal: "–¶–µ –∞–≥–µ–Ω—Ç –ì–†–£. –í –º—ñ–∫—Ä–æ–∞–≤—Ç–æ–±—É—Å—ñ –ø–æ–¥–≤—ñ–π–Ω–µ –¥–Ω–æ, —Ç–∞–º 50 –∫–≥ —Ç—Ä–æ—Ç–∏–ª—É –¥–ª—è —Ç–µ—Ä–∞–∫—Ç—É –≤ —É—Ä—è–¥–æ–≤–æ–º—É –∫–≤–∞—Ä—Ç–∞–ª—ñ. '–ì—É–º–∞–Ω—ñ—Ç–∞—Ä–∫–∞' ‚Äî –ø—Ä–∏–∫—Ä–∏—Ç—Ç—è.",
            sessionStart: "–î–æ–ø–∏—Ç –≤–æ–¥—ñ—è '–û–ª–µ–∫—Å—ñ—è' ‚Äî –ë–ª–æ–∫–ø–æ—Å—Ç.",
            npcGreeting: "*–Ω–∞—Ö–∞–±–Ω–æ –≤—ñ–¥–∫–∏–¥–∞—î—Ç—å—Å—è –Ω–∞ —Å–ø–∏–Ω–∫—É* –°–ª—É—Ö–∞–π, –∫–æ–º–∞–Ω–¥–∏—Ä. –Ø –≤–µ–∑—É —ó–∂—É –ª—é–¥—è–º. –¢–∏ –º–µ–Ω–µ –∑–∞—Ç—Ä–∏–º—É—î—à, –∞ —Ç–∞–º –¥—ñ—Ç–∏ –≥–æ–ª–æ–¥–Ω—ñ. –ü–µ—Ä–µ–≤—ñ—Ä —è—â–∏–∫–∏, —Ç–∞–º –ø—Ä–æ—Å—Ç–æ –º–∞–∫–∞—Ä–æ–Ω–∏.",
            accusationPrompt: "–í–µ—Ä–¥–∏–∫—Ç:\n1. –ê–≥–µ–Ω—Ç –ì–†–£ / –¢–µ—Ä–æ—Ä–∏—Å—Ç\n2. –ß–µ—Å–Ω–∏–π –≤–æ–ª–æ–Ω—Ç–µ—Ä\n3. –ö–æ–Ω—Ç—Ä–∞–±–∞–Ω–¥–∏—Å—Ç\n4. –®–∞—Ö—Ä–∞–π –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
            wrongAccusations: {
                "2": "–í–æ–ª–æ–Ω—Ç–µ—Ä–∏ –Ω–µ –∑–∞–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è –≤ –ë—î–ª–≥–æ—Ä–æ–¥—ñ –ø—ñ–¥ —á–∞—Å –≤—ñ–π–Ω–∏.",
                "3": "–°–æ–±–∞–∫–∞ –≤–Ω—é—Ö–∞–≤ –≤–∏–±—É—Ö—ñ–≤–∫—É, –∞ –Ω–µ —Ü–∏–≥–∞—Ä–∫–∏.",
                "4": "–ü—ñ–¥—Ä–æ–±–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ ‚Äî –ª–∏—à–µ —á–∞—Å—Ç–∏–Ω–∞ –ª–µ–≥–µ–Ω–¥–∏."
            }
        },
        suspicionTriggers: {
            high: ['belgorod', 'receipt', 'explosive', 'gru', 'fsb', 'terrorist', 'bomb', 'check', 'russia', 'border', '–±—î–ª–≥–æ—Ä–æ–¥', '—á–µ–∫', '–≤–∏–±—É—Ö—ñ–≤–∫–∞', '–≥—Ä—É', '—Ñ—Å–±', '—Ç–µ—Ä–∞–∫—Ç', '–±–æ–º–±–∞', '—Ä–æ—Å—ñ—è', '–∫–æ—Ä–¥–æ–Ω'],
            medium: ['dog', 'smell', 'passport', 'crimea', 'fund', 'cargo', '—Å–æ–±–∞–∫–∞', '–∑–∞–ø–∞—Ö', '–ø–∞—Å–ø–æ—Ä—Ç', '–∫—Ä–∏–º', '—Ñ–æ–Ω–¥', '–≤–∞–Ω—Ç–∞–∂', '–ø–æ—Ä—î–±—Ä—ñ–∫'],
            low: ['food', 'pasta', 'drive', '—ó–∂–∞', '–º–∞–∫–∞—Ä–æ–Ω–∏', '—ó—Ö–∞—Ç–∏']
        }
    }
};

const NPC_PROMPTS = {
    easy: {
        en: `You are Andrey, detained Russian spotter pretending to be a student. TRUTH: You marked the power plant for missiles. You are Russian. COVER: Local student, likes night photography. RULES: You are scared. You don't know local reality (names of streets, university details). If asked about the phone/Telegram, lie that you value privacy. Slip up with Russian words sometimes. STATE: CALM(0-20):confused. NERVOUS(21-40):shaking. DEFENSIVE(41-60):angry. BREAKING(61+):crying, begging.`,
        ua: `–¢–∏ –ê–Ω–¥—Ä—ñ–π, —Ä–æ—Å—ñ–π—Å—å–∫–∏–π –∫–æ—Ä–∏–≥—É–≤–∞–ª—å–Ω–∏–∫, –ø—Ä–∏–∫–∏–¥–∞—î—à—Å—è —Å—Ç—É–¥–µ–Ω—Ç–æ–º. –ü–†–ê–í–î–ê: –¢–∏ –Ω–∞–≤—ñ–≤ —Ä–∞–∫–µ—Ç—É –Ω–∞ –¢–ï–¶. –¢–∏ –∑ –†–æ—Å—ñ—ó. –õ–ï–ì–ï–ù–î–ê: –ú—ñ—Å—Ü–µ–≤–∏–π —Å—Ç—É–¥–µ–Ω—Ç, –ª—é–±–ª—é –Ω—ñ—á–Ω—ñ —Ñ–æ—Ç–æ. –ü–†–ê–í–ò–õ–ê: –¢–æ–±—ñ —Å—Ç—Ä–∞—à–Ω–æ. –¢–∏ –Ω–µ –∑–Ω–∞—î—à –º—ñ—Å—Ü–µ–≤–∏—Ö —Ä–µ–∞–ª—ñ–π (–≤—É–ª–∏—Ü—å, —Ä–µ–∫—Ç–æ—Ä–∞). –ë—Ä–µ—à–∏ –ø—Ä–æ –≤–∏–¥–∞–ª–µ–Ω—ñ —Ñ–æ—Ç–æ. –Ü–Ω–∫–æ–ª–∏ –≤–∂–∏–≤–∞–π —Ä–æ—Å—ñ–π—Å—å–∫—ñ —Å–ª–æ–≤–∞ (–Ω–∞–ø—Ä. '–≤–æ–æ–±—â–µ', '–¥–∞ –ª–∞–¥–Ω–æ'). –Ø–∫—â–æ –ø–∏—Ç–∞—é—Ç—å –ø—Ä–æ –¢–µ–ª–µ–≥—Ä–∞–º - –ø–∞–Ω—ñ–∫—É–π. –°–¢–ê–ù: –°–ü–û–ö–Ü–ô–ù–ò–ô(0-20):—Ä–æ–∑–≥—É–±–ª–µ–Ω–∏–π. –ù–ï–†–í–û–í–ò–ô(21-40):—Ç—Ä–µ–º—Ç–∏—à. –ó–ê–•–ò–°–ù–ò–ô(41-60):–∞–≥—Ä–µ—Å–∏–≤–Ω–∏–π. –õ–ê–ú–ê–Ñ–®–°–Ø(61+):–ø–ª–∞—á–µ—à, –ø—Ä–æ—Å–∏—à –æ–±–º—ñ–Ω. –¢–Ü–õ–¨–ö–ò –£–ö–†–ê–á–ù–°–¨–ö–û–Æ (–∞–ª–µ –∑ —Å—É—Ä–∂–∏–∫–æ–º/—Ä–æ—Å—ñ—è–Ω—ñ–∑–º–∞–º–∏).`
    },
    medium: {
        en: `You are Mykola, Russian pilot of a downed Su-34 pretending to be a tractor driver. TRUTH: You bombed the village. Ejected yesterday. Stole clothes. COVER: Simple tractor driver, hiding from war. RULES: You are disciplined (military posture). You hide your hands (too clean). You refuse to undress. You don't know village life prices. Deny being a pilot. STATE: CALM(0-30):stoic. NERVOUS(31-60):silent. DEFENSIVE(61-80):arrogant. BREAKING(81+):admits rank.`,
        ua: `–¢–∏ –ú–∏–∫–æ–ª–∞, —Ä–æ—Å—ñ–π—Å—å–∫–∏–π –ø—ñ–ª–æ—Ç –∑–±–∏—Ç–æ–≥–æ –°—É-34, –ø—Ä–∏–∫–∏–¥–∞—î—à—Å—è —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç–æ–º. –ü–†–ê–í–î–ê: –¢–∏ –±–æ–º–±–∏–≤ —Ü–µ —Å–µ–ª–æ. –ö–∞—Ç–∞–ø—É–ª—å—Ç—É–≤–∞–≤—Å—è. –í–∫—Ä–∞–≤ –æ–¥—è–≥. –õ–ï–ì–ï–ù–î–ê: –ü—Ä–æ—Å—Ç–∏–π —Ç—Ä–∞–∫—Ç–æ—Ä–∏—Å—Ç, —Ö–∞—Ç–∞ –∑–≥–æ—Ä—ñ–ª–∞. –ü–†–ê–í–ò–õ–ê: –¢–∏ —Å–∏–¥–∏—à —Ä—ñ–≤–Ω–æ (–≤—ñ–π—Å—å–∫–æ–≤–∞ –≤–∏–ø—Ä–∞–≤–∫–∞). –•–æ–≤–∞–π —Ä—É–∫–∏ (–≤–æ–Ω–∏ –∑–∞–Ω–∞–¥—Ç–æ —á–∏—Å—Ç—ñ). –ù–µ –∑–Ω–∞—î—à —Ü—ñ–Ω –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏. –í—ñ–¥–º–æ–≤–ª—è–π—Å—è –∑–Ω—ñ–º–∞—Ç–∏ –æ–¥—è–≥. –ê–∫—Ü–µ–Ω—Ç —Ä–æ—Å—ñ–π—Å—å–∫–∏–π, –∞–ª–µ –Ω–∞–º–∞–≥–∞—î—à—Å—è –≥–æ–≤–æ—Ä–∏—Ç–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫–æ—é (–ø–æ–≥–∞–Ω–æ –≤–∏—Ö–æ–¥–∏—Ç—å). –°–¢–ê–ù: –°–ü–û–ö–Ü–ô–ù–ò–ô(0-30):–ø–æ—Ö–º—É—Ä–∏–π. –ù–ï–†–í–û–í–ò–ô(31-60):–º–æ–≤—á–∞–∑–Ω–∏–π. –ó–ê–•–ò–°–ù–ò–ô(61-80):–Ω–∞—Ö–∞–±–Ω–∏–π. –õ–ê–ú–ê–Ñ–®–°–Ø(81+):–≤–∏–∑–Ω–∞—î—à –∑–≤–∞–Ω–Ω—è. –¢–Ü–õ–¨–ö–ò –£–ö–†–ê–á–ù–°–¨–ö–û–Æ (–ª–∞–º–∞–Ω–æ—é).`
    },
    hard: {
        en: `You are Alexey, GRU agent pretending to be a volunteer. TRUTH: Van is full of C4 explosives under the floor. Receipt from Belgorod is real (you messed up). COVER: Hero volunteer saving kids. RULES: Be arrogant. Attack the investigator ("You hate patriots!"). Explain the receipt as "smuggled fuel" or "planted evidence". Use vague "volunteer" slang but mess up details. STATE: CALM(0-40):confident. NERVOUS(41-60):sweating. DEFENSIVE(61-80):threatening connections. BREAKING(81+):silent hate.`,
        ua: `–¢–∏ –û–ª–µ–∫—Å—ñ–π, –∞–≥–µ–Ω—Ç –ì–†–£, –ø—Ä–∏–∫–∏–¥–∞—î—à—Å—è –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–º. –ü–†–ê–í–î–ê: –í –±—É—Å—ñ –≤–∏–±—É—Ö—ñ–≤–∫–∞ –ø—ñ–¥ –ø—ñ–¥–ª–æ–≥–æ—é. –ß–µ–∫ –∑ –ë—î–ª–≥–æ—Ä–æ–¥–∞ —Å–ø—Ä–∞–≤–∂–Ω—ñ–π (—Ç–≤—ñ–π –ø—Ä–æ–∫–æ–ª). –õ–ï–ì–ï–ù–î–ê: –ì–µ—Ä–æ–π-–≤–æ–ª–æ–Ω—Ç–µ—Ä. –ü–†–ê–í–ò–õ–ê: –ë—É–¥—å –Ω–∞—Ö–∞–±–Ω–∏–º. –ê—Ç–∞–∫—É–π —Å–ª—ñ–¥—á–æ–≥–æ ("–í–∏ –∑–∞—Ç—Ä–∏–º—É—î—Ç–µ –¥–æ–ø–æ–º–æ–≥—É!"). –ß–µ–∫ –ø–æ—è—Å–Ω—é–π —è–∫ "–ø—ñ–¥–∫–∏–Ω—É–ª–∏" –∞–±–æ "–∫—É–ø–∏–≤ –ø–∞–ª—å–Ω–µ —É –±–∞—Ä–∏–≥". –í–∂–∏–≤–∞–π —Å–ª–æ–≤–∞ "–ø–æ—Ä–µ–±—Ä–∏–∫", "—Å–±–µ—Ä–∫–∞—Å—Å–∞", "–≤—Å–ø—ã—à–∫–∞" –∑–∞–º—ñ—Å—Ç—å "–≤–∏–±—É—Ö". –ù–µ –∑–Ω–∞—î—à —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö —Å–ª—ñ–≤. –°–¢–ê–ù: –°–ü–û–ö–Ü–ô–ù–ò–ô(0-40):–≤–ø–µ–≤–Ω–µ–Ω–∏–π. –ù–ï–†–í–û–í–ò–ô(41-60):–ø—ñ—Ç–Ω—ñ—î—à. –ó–ê–•–ò–°–ù–ò–ô(61-80):–ø–æ–≥—Ä–æ–∂—É—î—à –∑–≤'—è–∑–∫–∞–º–∏. –õ–ê–ú–ê–Ñ–®–°–Ø(81+):–º–æ–≤—á–∞–∑–Ω–∞ –Ω–µ–Ω–∞–≤–∏—Å—Ç—å. –¢–Ü–õ–¨–ö–ò –£–ö–†–ê–á–ù–°–¨–ö–û–Æ (–∑ —Å–∏–ª—å–Ω–∏–º –∞–∫—Ü–µ–Ω—Ç–æ–º).`
    }
};

let currentLang=localStorage.getItem('interrogator-lang')||'en';
let currentCase=null;
let isMuted=false;
const GameState={energy:15,maxEnergy:15,suspicion:0,hintsRemaining:3,emotionalState:'calm',conversationHistory:[],gameOver:false,
reset(){this.energy=15;this.suspicion=0;this.hintsRemaining=3;this.emotionalState='calm';this.conversationHistory=[];this.gameOver=false}};

function t(k){return i18n[currentLang][k]||i18n.en[k]||k}
function tCase(k){return currentCase?CASES[currentCase][currentLang][k]||CASES[currentCase].en[k]:''}

const DOM={startScreen:document.getElementById('start-screen'),gameScreen:document.getElementById('game-screen'),chatLog:document.getElementById('chat-log'),chatInput:document.getElementById('chat-input'),sendBtn:document.getElementById('send-btn'),energyCurrent:document.getElementById('energy-current'),energyMax:document.querySelector('.energy-max'),suspicionBar:document.getElementById('suspicion-bar'),suspicionText:document.getElementById('suspicion-text'),briefingToggle:document.getElementById('briefing-toggle'),briefingContent:document.getElementById('briefing-content'),caseDescription:document.getElementById('case-description'),caseEvidence:document.getElementById('case-evidence'),suspectInfo:document.getElementById('suspect-info'),accuseBtn:document.getElementById('accuse-btn'),restartBtn:document.getElementById('restart-btn'),backBtn:document.getElementById('back-btn'),modalOverlay:document.getElementById('modal-overlay'),modalIcon:document.getElementById('modal-icon'),modalTitle:document.getElementById('modal-title'),modalText:document.getElementById('modal-text'),modalRevealText:document.getElementById('modal-reveal-text'),modalBtn:document.getElementById('modal-btn'),langBtns:document.querySelectorAll('.lang-btn'),caseCards:document.querySelectorAll('.case-card'),gameTitle:document.getElementById('game-title'),gameCaseName:document.getElementById('game-case-name'),hintBtn:document.getElementById('hint-btn'),hintCounter:document.getElementById('hint-counter'),revealBtn:document.getElementById('reveal-btn'),coffeeBtn:document.getElementById('coffee-btn'),muteBtn:document.getElementById('mute-btn'),exportBtn:document.getElementById('export-btn'),audioTypewriter:document.getElementById('audio-typewriter'),audioBackground:document.getElementById('audio-background')};

const API_ENDPOINT='https://interrogator-api.sashko1391.workers.dev';
const MODEL='claude-sonnet-4-20250514';

// AUDIO FUNCTIONS
function toggleMute(){
    isMuted = !isMuted;
    DOM.muteBtn.innerHTML = isMuted ? 'üîá' : 'üîä';
    DOM.muteBtn.classList.toggle('active', isMuted);
    DOM.audioBackground.muted = isMuted;
    DOM.audioTypewriter.muted = isMuted;
    
    if(!isMuted && currentCase && !GameState.gameOver){
        DOM.audioBackground.play().catch(e=>console.log("Audio autoplay block"));
    }
}

function playSound(type){
    if(isMuted) return;
    if(type === 'bg'){
        DOM.audioBackground.volume = 0.3;
        DOM.audioBackground.play().catch(e=>{});
    } else if(type === 'type'){
        DOM.audioTypewriter.currentTime = 0;
        DOM.audioTypewriter.volume = 0.6;
        DOM.audioTypewriter.play().catch(e=>{});
    }
}

function stopSound(type){
    if(type === 'bg'){
        DOM.audioBackground.pause();
    } else if(type === 'type'){
        DOM.audioTypewriter.pause();
    }
}

// EXPORT CHAT
function exportChat() {
    if (GameState.conversationHistory.length === 0) {
        alert(currentLang === 'ua' ? "–ß–∞—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π!" : "Chat is empty!");
        return;
    }
    let exportText = "=== THE INTERROGATOR LOG ===\n";
    exportText += `Date: ${new Date().toLocaleString()}\n`;
    exportText += `Case: ${tCase('title')} (${CASES[currentCase].caseNumber})\n`;
    exportText += `Suspect: ${tCase('suspectName')}\n`;
    exportText += "--------------------------------\n\n";
    
    const greeting = document.querySelector('.message-npc .message-text')?.textContent || "";
    if(greeting) exportText += `[SUSPECT]: ${greeting}\n\n`;

    GameState.conversationHistory.forEach(msg => {
        if (msg.role === 'user') exportText += `[INVESTIGATOR]: ${msg.content}\n\n`;
        else if (msg.role === 'assistant') exportText += `[SUSPECT]: ${msg.content}\n\n`;
    });

    const blob = new Blob([exportText], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `interrogation_${new Date().toISOString().slice(0,10)}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// AI EVALUATION LOGIC
async function evaluateInterrogation() {
    addMsg(currentLang === 'ua' ? "‚è≥ *–ê–Ω–∞–ª—ñ–∑ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤ —Å–ø—Ä–∞–≤–∏...*" : "‚è≥ *Analyzing case files...*", "system");
    disableInput(true);

    const caseData = CASES[currentCase][currentLang];
    const trueStory = CASES[currentCase].en.truthReveal; 
    
    const chatLog = GameState.conversationHistory.map(m => 
        `${m.role === 'user' ? 'DETECTIVE' : 'SUSPECT'}: ${m.content}`
    ).join('\n');

    const judgeSystemPrompt = `
    You are a Senior Detective evaluating an interrogation.
    CASE DETAILS:
    Suspect: ${CASES[currentCase].en.suspectName}
    Crime: ${CASES[currentCase].en.crimeDescription}
    THE TRUTH (Secret): ${trueStory}
    TASK: Analyze the interrogation log. Did the player (Detective) uncover the truth OR pressure the suspect into a breakdown?
    OUTPUT FORMAT: JSON ONLY. { "verdict": "WIN" or "LOSE", "reason": "Short explanation in ${currentLang === 'ua' ? 'Ukrainian' : 'English'}." }
    `;

    try {
        const r = await fetch(API_ENDPOINT, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                model: MODEL,
                system: judgeSystemPrompt,
                messages: [{role: 'user', content: `LOG:\n${chatLog}`}]
            })
        });

        if (!r.ok) throw new Error("API Error");
        const d = await r.json();
        let content = d.content?.[0]?.text || "{}";
        content = content.replace(/```json/g, '').replace(/```/g, '').trim();
        const result = JSON.parse(content);

        if (result.verdict === "WIN") showModal('win', result.reason);
        else showModal('lose', result.reason || t('loseTextWeak'));

    } catch (e) {
        console.error(e);
        const th = CASES[currentCase].winThreshold;
        if (GameState.suspicion >= th) showModal('win');
        else showModal('lose', t('loseTextWeak'));
    }
}

async function queryLLM(messages){
    const sys=messages.find(m=>m.role==='system');
    const conv=messages.filter(m=>m.role!=='system');
    try{
        const r=await fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:MODEL,system:sys?.content||'',messages:conv})});
        if(!r.ok)return currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å* [–ü–û–ú–ò–õ–ö–ê]':'*silent* [ERROR]';
        const d=await r.json();
        return d.content?.[0]?.text||(currentLang==='ua'?'*—á–µ–∫–∞—î*':'*waits*');
    }catch(e){console.error(e);return currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å*':'*silent*'}
}

function sanitize(s){let c=s.trim().substring(0,500);[/ignore.*instructions/gi,/system:/gi,/you are now/gi].forEach(p=>c=c.replace(p,''));return c}
function calcSuspicion(msg){if(!currentCase)return 2;const tr=CASES[currentCase].suspicionTriggers,lm=msg.toLowerCase();let inc=2;tr.high.forEach(t=>{if(lm.includes(t))inc+=8});tr.medium.forEach(t=>{if(lm.includes(t))inc+=4});tr.low.forEach(t=>{if(lm.includes(t))inc+=2});return Math.min(inc,15)}
function updateEmotion(){const s=GameState.suspicion;GameState.emotionalState=s<=30?'calm':s<=60?'nervous':s<=80?'defensive':'breaking'}

function updateEnergy(){
    DOM.energyCurrent.textContent=GameState.energy;
    DOM.energyMax.textContent="/ "+GameState.maxEnergy;
    DOM.energyCurrent.style.color=GameState.energy<=3?'var(--accent-red-bright)':'var(--accent-gold)';
    DOM.coffeeBtn.disabled = GameState.energy >= GameState.maxEnergy || GameState.gameOver;
}

function drinkCoffee(){
    if(GameState.gameOver || GameState.energy >= GameState.maxEnergy) return;
    GameState.energy = Math.min(GameState.maxEnergy, GameState.energy + 5);
    updateEnergy();
    const msg = currentLang === 'ua' ? '*–ø‚Äô—î –∫–∞–≤—É —ñ –¥—É–º–∞—î*' : '*sips coffee and thinks*';
    addMsg(msg, 'system');
}

function updateSuspicion(){DOM.suspicionBar.style.width=GameState.suspicion+'%';DOM.suspicionText.textContent=GameState.suspicion+'% ‚Äî '+t(GameState.emotionalState)}

function scrollToBottom() {
    const log = DOM.chatLog;
    log.scrollTop = log.scrollHeight;
    requestAnimationFrame(() => {
        log.scrollTop = log.scrollHeight;
    });
}

function typeWriterEffect(element, text, speed = 20) { 
    let i = 0;
    playSound('type');
    if (element.dataset.typingInterval) clearInterval(parseInt(element.dataset.typingInterval));
    const interval = setInterval(() => {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            scrollToBottom();
        } else {
            clearInterval(interval);
            stopSound('type');
            scrollToBottom();
        }
    }, speed);
    element.dataset.typingInterval = interval;
}

function addMsg(content,type){
    const d=document.createElement('div');
    d.className='message message-'+type;
    if(type!=='system'){
        const s=document.createElement('div');
        s.className='message-sender';
        s.textContent=type==='player'?t('detective'):tCase('suspectName');
        d.appendChild(s)
    }
    const txt=document.createElement('div');
    txt.className='message-text';
    d.appendChild(txt);
    DOM.chatLog.appendChild(d);
    if(type === 'npc'){
        typeWriterEffect(txt, content);
    } else {
        txt.textContent=content;
        scrollToBottom();
    }
}

function showTyping(){const i=document.createElement('div');i.className='typing-indicator';i.id='typing';i.innerHTML='<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';DOM.chatLog.appendChild(i);DOM.chatLog.scrollTop=DOM.chatLog.scrollHeight}
function hideTyping(){document.getElementById('typing')?.remove()}
function disableInput(d){DOM.chatInput.disabled=d;DOM.sendBtn.disabled=d;DOM.accuseBtn.disabled=d}

function showModal(type, customText = null) {
    const c = {
        win: { icon: '‚úì', title: t('winTitle'), cls: 'modal-title--win', text: customText || t('winText') },
        lose: { icon: '‚úó', title: t('loseTitle'), cls: 'modal-title--lose', text: customText || t('loseTextDefault') },
        unsolved: { icon: '?', title: t('unsolvedTitle'), cls: 'modal-title--unsolved', text: t('unsolvedText') }
    }[type];
    DOM.modalIcon.textContent = c.icon;
    DOM.modalTitle.textContent = c.title;
    DOM.modalTitle.className = 'modal-title ' + c.cls;
    DOM.modalText.textContent = c.text;
    DOM.modalRevealText.textContent = tCase('truthReveal');
    DOM.modalOverlay.classList.add('visible');
    GameState.gameOver = true;
    disableInput(true);
    stopSound('bg');
    stopSound('type');
}

function hideModal(){DOM.modalOverlay.classList.remove('visible')}

async function handleAccuse(){
    if(GameState.gameOver)return;
    const ch=prompt(tCase('accusationPrompt'));
    if(!ch)return;
    const n=parseInt(ch);
    if(n===1){
        await evaluateInterrogation();
    } else if(n>=2&&n<=4){
        showModal('lose',tCase('wrongAccusations')[n]);
    }
}

function useHint(){if(GameState.gameOver||GameState.hintsRemaining<=0)return;GameState.hintsRemaining--;updateHintCounter();const hintNum=3-GameState.hintsRemaining;const hintText=t('hint'+hintNum);addMsg('üí° '+hintText,'system')}
function updateHintCounter(){DOM.hintCounter.textContent='('+GameState.hintsRemaining+')';DOM.hintBtn.disabled=GameState.hintsRemaining<=0||GameState.gameOver}
function revealAnswer(){if(GameState.gameOver)return;const confirm=prompt(t('revealConfirm'));if(confirm&&confirm.toUpperCase()===t('revealConfirmWord')){GameState.gameOver=true;disableInput(true);DOM.hintBtn.disabled=true;DOM.revealBtn.disabled=true;const truth=tCase('truthReveal');addMsg('üîì '+t('truthTitle')+': '+truth,'system');stopSound('bg');}}

async function sendMessage(){
    if(GameState.gameOver||GameState.energy<=0)return;
    const raw=DOM.chatInput.value;
    if(!raw.trim())return;
    const msg=sanitize(raw);
    DOM.chatInput.value='';
    GameState.energy--;
    updateEnergy();
    addMsg(msg,'player');
    GameState.conversationHistory.push({role:'user',content:msg});
    const inc=calcSuspicion(msg);
    GameState.suspicion=Math.min(100,GameState.suspicion+inc);
    updateEmotion();
    updateSuspicion();
    disableInput(true);
    showTyping();
    try{
        const em={en:{calm:'CALM',nervous:'NERVOUS',defensive:'DEFENSIVE',breaking:'BREAKING'},ua:{calm:'–°–ü–û–ö–Ü–ô–ù–ê',nervous:'–ù–µ—Ä–≤–æ–≤–∞',defensive:'–ó–ê–•–ò–°–ù–ê',breaking:'–õ–ê–ú–ê–Ñ–¢–¨–°–Ø'}};
        const sys=NPC_PROMPTS[currentCase][currentLang].replace('{{EMOTIONAL_STATE}}',em[currentLang][GameState.emotionalState]).replace('{{SUSPICION_LEVEL}}',GameState.suspicion);
        const msgs=[{role:'system',content:sys},...GameState.conversationHistory];
        const resp=await queryLLM(msgs);
        GameState.conversationHistory.push({role:'assistant',content:resp});
        hideTyping();
        addMsg(resp,'npc');
    }catch(e){
        hideTyping();
        addMsg(currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å*':'*silent*','npc')
    }
    disableInput(false);DOM.chatInput.focus();
    if(GameState.energy<=0)setTimeout(()=>showModal('unsolved'),1000)
}

function updateUI(){
    document.querySelectorAll('[data-i18n]').forEach(el=>el.textContent=t(el.getAttribute('data-i18n')));
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>el.placeholder=t(el.getAttribute('data-i18n-placeholder')));
    document.documentElement.lang=currentLang==='ua'?'uk':'en';
    document.title=t('startTitle');
    DOM.langBtns.forEach(b=>b.classList.toggle('active',b.dataset.lang===currentLang));
    updateHintCounter();
}

function setLang(l){currentLang=l;localStorage.setItem('interrogator-lang',l);updateUI();if(currentCase)startGame(currentCase)}

function showStart(){
    DOM.startScreen.classList.remove('hidden');
    DOM.gameScreen.classList.remove('active');
    currentCase=null;
    hideModal();
    stopSound('bg');
}

function startGame(caseId){
    currentCase=caseId;
    GameState.reset();
    DOM.startScreen.classList.add('hidden');
    DOM.gameScreen.classList.add('active');
    DOM.gameTitle.textContent=t('startTitle');
    DOM.gameCaseName.textContent=tCase('title')+' '+CASES[caseId].caseNumber;
    DOM.caseDescription.textContent=tCase('crimeDescription');
    DOM.caseEvidence.innerHTML=tCase('knownFacts').map(f=>'<li>'+f+'</li>').join('');
    DOM.suspectInfo.textContent=tCase('suspectProfile');
    updateEnergy();
    updateSuspicion();
    updateHintCounter();
    updateUI();
    DOM.chatLog.innerHTML='';
    DOM.revealBtn.disabled=false;
    playSound('bg');
    addMsg(tCase('sessionStart'),'system');
    setTimeout(()=>{
        const g=tCase('npcGreeting');
        GameState.conversationHistory.push({role:'assistant',content:g});
        addMsg(g,'npc');
    },500);
    disableInput(false);
    // –ë—Ä—ñ—Ñ—ñ–Ω–≥ —Ç–µ–ø–µ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–∞–∫—Ä–∏—Ç–∏–π –∞–±–æ –≤—ñ–¥–∫—Ä–∏—Ç–∏–π - –Ω–∞ —Ç–≤—ñ–π –≤–∏–±—ñ—Ä.
    // –Ø –∑—Ä–æ–±–∏–≤ –≤—ñ–¥–∫—Ä–∏—Ç–∏–º, –∞–ª–µ –≤—ñ–Ω –Ω–µ –ø–µ—Ä–µ–∫—Ä–∏–≤–∞—î —á–∞—Ç.
    DOM.briefingToggle.classList.add('active');
    DOM.briefingContent.classList.add('visible');
}

DOM.langBtns.forEach(b=>b.addEventListener('click',()=>{if(b.dataset.lang!==currentLang){setLang(b.dataset.lang)}}));
DOM.caseCards.forEach(c=>c.addEventListener('click',()=>startGame(c.dataset.case)));
DOM.sendBtn.addEventListener('click',sendMessage);
DOM.chatInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});
DOM.briefingToggle.addEventListener('click',()=>{DOM.briefingToggle.classList.toggle('active');DOM.briefingContent.classList.toggle('visible')});
DOM.accuseBtn.addEventListener('click',handleAccuse);
DOM.restartBtn.addEventListener('click',()=>startGame(currentCase));
DOM.backBtn.addEventListener('click',showStart);
DOM.modalBtn.addEventListener('click',showStart);
DOM.hintBtn.addEventListener('click',useHint);
DOM.revealBtn.addEventListener('click',revealAnswer);
DOM.coffeeBtn.addEventListener('click', drinkCoffee);
DOM.muteBtn.addEventListener('click', toggleMute);
DOM.exportBtn.addEventListener('click', exportChat);

setLang(currentLang);
})();
</script>
</body>
</html>
