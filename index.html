<!DOCTYPE html>

<html lang="ua">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Interrogator: AI Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Code+Pro:wght@400;500&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg-primary:#0a0a0c;--bg-secondary:#12121a;--bg-tertiary:#1a1a24;--bg-card:#15151f;--text-primary:#e8e6e3;--text-secondary:#9a9a9a;--text-muted:#5a5a6a;--accent-gold:#d4af37;--accent-gold-dim:#8b7323;--accent-red:#8b2942;--accent-red-bright:#c73e5c;--accent-green:#2d5a3d;--accent-green-bright:#4a9b6a;--border-color:#2a2a3a;--border-accent:#3a3a4a;--font-display:'Playfair Display',Georgia,serif;--font-body:'Crimson Pro',Georgia,serif;--font-mono:'Source Code Pro',monospace}
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        html{font-size:22px;scroll-behavior:smooth}
        body{font-family:var(--font-body);background:var(--bg-primary);color:var(--text-primary);min-height:100vh;overflow-y:auto;position:relative;}

```
    /* Noise overlay */
    body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:0.05;pointer-events:none;z-index:1000}
    
    /* Background - Ğ³Ñ€Ğ°Ğ´Ñ–Ñ”Ğ½Ñ‚ fallback */
    .bg-fallback{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at 20% 20%,rgba(139,41,66,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(212,175,55,0.1) 0%,transparent 50%),linear-gradient(180deg,#0a0a0c 0%,#12121a 100%);z-index:-2}
    
    /* Background image - landscape */
    .bg-image{position:fixed;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;z-index:-1;opacity:0.5;}
    .bg-image.bg-landscape{background-image:url('bg-landscape.jpg');}
    .bg-image.bg-portrait{background-image:url('bg-portrait.jpg');display:none;}
    
    /* Portrait mode */
    @media (orientation: portrait) {
        .bg-image.bg-landscape{display:none;}
        .bg-image.bg-portrait{display:block;}
    }
    
    /* Controls */
    .top-controls-left{position:fixed;top:1rem;left:1rem;display:flex;gap:0.5rem;z-index:2000;}
    .lang-switcher{position:fixed;top:1rem;right:1rem;display:flex;z-index:2000;}
    .icon-btn{background:rgba(18,18,26,0.9);border:1px solid var(--border-color);color:var(--text-muted);padding:0.6rem;font-family:var(--font-mono);font-size:0.8rem;cursor:pointer;border-radius:4px;min-width:40px;display:flex;align-items:center;justify-content:center;transition:all 0.2s;}
    .icon-btn:hover{border-color:var(--accent-gold);color:var(--accent-gold);}
    .lang-btn{background:rgba(18,18,26,0.9);border:1px solid var(--border-color);color:var(--text-muted);padding:0.6rem;font-family:var(--font-mono);font-size:0.8rem;cursor:pointer;min-width:40px;transition:all 0.2s;}
    .lang-btn:first-child{border-radius:4px 0 0 4px;border-right:none;}
    .lang-btn:last-child{border-radius:0 4px 4px 0;border-left:1px solid var(--border-color);}
    .lang-btn.active{background:var(--accent-gold-dim);color:var(--bg-primary);border-color:var(--accent-gold-dim);font-weight:bold;}
    
    /* Start Screen */
    .start-screen{min-height:100vh;width:100%;display:flex;flex-direction:column;position:absolute;top:0;left:0;z-index:100;background:transparent;}
    .start-screen.hidden{display:none}
    .start-content{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:2rem;text-align:center;}
    .start-title{font-family:var(--font-display);font-size:2.5rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-primary);margin-bottom:0.5rem;text-shadow:0 0 60px rgba(212,175,55,0.3)}
    .start-tagline{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted);letter-spacing:0.3em;text-transform:uppercase;margin-bottom:2rem}
    
    /* Category Grid */
    .category-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;width:100%;max-width:900px;padding:0 1rem;}
    .cat-card{background:rgba(21,21,31,0.9);border:1px solid var(--border-color);border-radius:4px;padding:2rem;cursor:pointer;transition:all 0.3s;text-align:center;display:flex;flex-direction:column;align-items:center;gap:1rem;}
    .cat-card:hover{border-color:var(--accent-gold);transform:translateY(-5px);background:rgba(26,26,36,0.95);box-shadow:0 10px 40px rgba(212,175,55,0.1);}
    .cat-icon{font-size:3rem;margin-bottom:0.5rem;}
    .cat-title{font-family:var(--font-display);font-size:1.2rem;color:var(--accent-gold);}
    .cat-desc{font-size:0.75rem;color:var(--text-secondary);line-height:1.6;}
    
    /* Loading Screen */
    .loading-screen{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(10,10,12,0.95);z-index:200;align-items:center;justify-content:center;flex-direction:column;}
    .loading-screen.visible{display:flex;}
    .loader{width:50px;height:50px;border:3px solid var(--bg-tertiary);border-top:3px solid var(--accent-gold);border-radius:50%;animation:spin 1s linear infinite;margin-bottom:1rem;}
    @keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
    .loading-text{font-family:var(--font-mono);font-size:0.8rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.1em;animation:pulse 2s infinite;text-align:center;max-width:300px;line-height:1.6;}
    @keyframes pulse{0%,100%{opacity:0.5}50%{opacity:1}}
    
    /* Game Screen */
    .game-screen{display:none;min-height:100vh;width:100%;}
    .game-screen.active{display:block;}
    .game-container{max-width:900px;margin:0 auto;padding:1.5rem;padding-top:4rem;min-height:100vh;display:flex;flex-direction:column;}
    
    /* Game Header */
    .game-header{display:flex;align-items:center;gap:1.5rem;padding:1rem 0;border-bottom:1px solid var(--border-color);margin-bottom:1rem;}
    .suspect-image-container{width:100px;height:100px;border-radius:4px;overflow:hidden;border:1px solid var(--border-color);background:#000;position:relative;flex-shrink:0;display:flex;align-items:center;justify-content:center;}
    .suspect-image{width:100%;height:100%;object-fit:cover;display:none;animation:fadeIn 1s ease;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .loader-mini{width:20px;height:20px;border:2px solid var(--bg-tertiary);border-top:2px solid var(--accent-gold);border-radius:50%;animation:spin 1s linear infinite;display:none;}
    .loader-mini.visible{display:block;}
    .game-header-text{flex:1;}
    .game-title{font-family:var(--font-display);font-size:1.2rem;text-transform:uppercase;color:var(--text-primary);}
    .game-subtitle{font-family:var(--font-mono);font-size:0.55rem;color:var(--text-muted);text-transform:uppercase;}
    
    /* Status Bar */
    .status-bar{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;padding:0.8rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;margin-bottom:1rem;}
    .status-item{display:flex;flex-direction:column;gap:0.25rem}
    .status-label{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--text-muted)}
    .status-value{display:flex;align-items:center;gap:0.5rem}
    .energy-display{font-family:var(--font-display);font-size:1.2rem;font-weight:700;color:var(--accent-gold)}
    .suspicion-container{flex:1}
    .suspicion-bar-bg{height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}
    .suspicion-bar-fill{height:100%;width:0%;background:linear-gradient(90deg,#2d5a3d,#d4af37,#c73e5c);transition:width 300ms;border-radius:4px}
    .suspicion-value{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-secondary);margin-top:0.25rem;}
    
    /* Briefing */
    .briefing-container{margin-bottom:1rem;}
    .briefing-toggle{width:100%;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:0.8rem;color:var(--text-primary);font-family:var(--font-mono);font-size:0.65rem;text-transform:uppercase;cursor:pointer;display:flex;justify-content:space-between;transition:all 0.2s;}
    .briefing-toggle:hover{border-color:var(--border-accent);}
    .briefing-toggle-icon{transition:transform 0.2s;}
    .briefing-toggle.active .briefing-toggle-icon{transform:rotate(180deg);}
    .briefing-content{display:none;background:var(--bg-card);border:1px solid var(--border-color);border-top:none;border-radius:0 0 4px 4px;padding:1.5rem;}
    .briefing-content.visible{display:block;animation:slideDown 0.3s ease;}
    @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    .briefing-section{margin-bottom:1rem;}
    .briefing-section:last-child{margin-bottom:0;}
    .briefing-section-title{color:var(--accent-gold);font-family:var(--font-display);font-size:0.9rem;margin-bottom:0.5rem;}
    .briefing-text{font-size:0.75rem;color:var(--text-secondary);line-height:1.6;}
    .evidence-list{list-style:none;padding-left:1rem}
    .evidence-list li{position:relative;padding-left:1rem;margin-bottom:0.5rem;color:var(--text-secondary);font-size:0.7rem}
    .evidence-list li::before{content:'â–ª';position:absolute;left:0;color:var(--accent-gold-dim)}
    
    /* Chat */
    .chat-container{flex:1;display:flex;flex-direction:column;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;overflow:hidden;height:50vh;min-height:350px;}
    .chat-log{flex-grow:1;overflow-y:auto;padding:1.5rem;display:flex;flex-direction:column;gap:1rem;}
    .chat-log::-webkit-scrollbar{width:6px}
    .chat-log::-webkit-scrollbar-track{background:var(--bg-tertiary)}
    .chat-log::-webkit-scrollbar-thumb{background:var(--border-accent);border-radius:3px}
    
    /* Messages */
    .message{max-width:85%;padding:1rem;border-radius:4px;animation:messageIn 0.3s ease;}
    @keyframes messageIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .message-player{align-self:flex-end;background:var(--bg-tertiary);border:1px solid var(--border-accent);border-right:3px solid var(--accent-gold);}
    .message-npc{align-self:flex-start;background:var(--bg-card);border:1px solid var(--border-color);border-left:3px solid var(--accent-red);}
    .message-system{align-self:center;background:transparent;border:1px dashed var(--border-color);text-align:center;max-width:90%;color:var(--text-muted);font-family:var(--font-mono);font-size:0.65rem;}
    .message-sender{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-muted);margin-bottom:0.25rem;}
    .message-text{font-size:0.75rem;line-height:1.5;}
    .message-player .message-text{color:var(--text-primary);}
    .message-npc .message-text{color:var(--text-secondary);font-style:italic;}
    
    /* Typing Indicator */
    .typing-indicator{display:flex;gap:4px;padding:1rem;align-self:flex-start;background:var(--bg-card);border-radius:4px;border-left:3px solid var(--accent-red);}
    .typing-dot{width:8px;height:8px;background:var(--text-muted);border-radius:50%;animation:typingBounce 1.4s infinite ease-in-out;}
    .typing-dot:nth-child(1){animation-delay:0ms;}
    .typing-dot:nth-child(2){animation-delay:200ms;}
    .typing-dot:nth-child(3){animation-delay:400ms;}
    @keyframes typingBounce{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-6px);opacity:1}}
    
    /* Input */
    .input-container{display:flex;gap:0.5rem;padding:1rem;background:var(--bg-tertiary);border-top:1px solid var(--border-color);}
    .chat-input{flex:1;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:4px;padding:1rem;color:var(--text-primary);font-family:var(--font-body);font-size:0.75rem;outline:none;transition:border-color 0.2s;}
    .chat-input:focus{border-color:var(--accent-gold-dim);}
    .chat-input::placeholder{color:var(--text-muted);font-style:italic;}
    .chat-input:disabled{opacity:0.5;cursor:not-allowed;}
    .send-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:0 1.5rem;color:var(--bg-primary);font-family:var(--font-mono);font-size:0.6rem;font-weight:600;cursor:pointer;transition:all 0.2s;}
    .send-btn:hover:not(:disabled){background:var(--accent-gold);}
    .send-btn:disabled{opacity:0.5;cursor:not-allowed;}
    
    /* Action Buttons */
    .action-bar{display:flex;gap:0.5rem;margin-top:0.5rem;flex-wrap:wrap;padding-bottom:1rem;}
    .action-btn{flex:1;background:transparent;border:1px solid var(--border-color);border-radius:4px;padding:0.8rem;color:var(--text-secondary);font-family:var(--font-mono);font-size:0.55rem;text-transform:uppercase;cursor:pointer;min-width:70px;text-align:center;transition:all 0.2s;}
    .action-btn:hover:not(:disabled){border-color:var(--border-accent);color:var(--text-primary);}
    .action-btn:disabled{opacity:0.4;cursor:not-allowed;}
    .action-btn--hint{border-color:var(--accent-green);color:var(--accent-green-bright);}
    .action-btn--hint:hover:not(:disabled){background:var(--accent-green);color:var(--text-primary);}
    .action-btn--coffee{border-color:var(--accent-gold-dim);color:var(--accent-gold);}
    .action-btn--coffee:hover:not(:disabled){background:var(--accent-gold-dim);color:var(--bg-primary);}
    .action-btn--accuse{border-color:var(--accent-red);color:var(--accent-red-bright);}
    .action-btn--accuse:hover:not(:disabled){background:var(--accent-red);color:var(--text-primary);}
    .action-btn--reveal{border-color:var(--text-muted);color:var(--text-muted);font-size:0.5rem;}
    .action-btn--reveal:hover:not(:disabled){border-color:var(--accent-red);color:var(--accent-red-bright);}
    
    /* Modal */
    .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.9);z-index:200;align-items:center;justify-content:center}
    .modal-overlay.visible{display:flex}
    .modal-content{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:2rem;max-width:500px;width:90%;text-align:center;animation:modalIn 0.4s ease;}
    @keyframes modalIn{from{opacity:0;transform:scale(0.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
    .modal-icon{font-size:3rem;margin-bottom:1rem;}
    .modal-title{font-family:var(--font-display);font-size:1.3rem;margin-bottom:1rem;text-transform:uppercase;letter-spacing:0.1em;}
    .modal-title--win{color:var(--accent-green-bright);}
    .modal-title--lose{color:var(--accent-red-bright);}
    .modal-text{font-size:0.8rem;color:var(--text-secondary);line-height:1.6;margin-bottom:1rem;}
    .modal-reveal{background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:4px;padding:1rem;margin-bottom:1rem;text-align:left;}
    .modal-reveal-title{font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--accent-gold);margin-bottom:0.5rem;}
    .modal-reveal-text{font-size:0.7rem;color:var(--text-secondary);line-height:1.6;}
    .modal-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:1rem 2rem;cursor:pointer;font-family:var(--font-mono);font-size:0.7rem;font-weight:500;text-transform:uppercase;transition:all 0.2s;}
    .modal-btn:hover{background:var(--accent-gold);}
    .feedback-link{display:block;margin-top:1rem;color:var(--text-muted);font-size:0.55rem;text-decoration:none;transition:color 0.2s;}
    .feedback-link:hover{color:var(--accent-gold);}
    
    /* Responsive */
    @media(max-width:600px){
        html{font-size:18px}
        .game-container{padding:0.5rem;padding-top:3.5rem;}
        .game-header{flex-direction:column;align-items:center;text-align:center;}
        .category-grid{grid-template-columns:1fr;}
        .action-bar{gap:0.3rem;}
        .action-btn{padding:0.6rem;font-size:0.5rem;min-width:60px;}
        .status-bar{grid-template-columns:1fr;gap:1rem;}
    }
</style>
```

</head>
<body>
    <div class="bg-fallback"></div>
    <div class="bg-image bg-landscape"></div>
    <div class="bg-image bg-portrait"></div>

```
<div class="lang-switcher">
    <button class="lang-btn active" data-lang="ua">UA</button>
    <button class="lang-btn" data-lang="en">EN</button>
</div>

<div class="top-controls-left">
    <button class="icon-btn" id="mute-btn" title="Sound">ğŸ”Š</button>
    <button class="icon-btn" id="back-btn" title="Back" style="display:none;">â†</button>
</div>

<div class="start-screen" id="start-screen">
    <div class="start-content">
        <h1 class="start-title" data-i18n="title">Ğ¡Ğ»Ñ–Ğ´Ñ‡Ğ¸Ğ¹</h1>
        <p class="start-tagline" data-i18n="tagline">AI-Generated Detective Stories</p>
        <div class="category-grid">
            <div class="cat-card" data-category="war">
                <div class="cat-icon">âš”ï¸</div>
                <div class="cat-title" data-i18n="catWar">Ğ’Ñ–Ğ¹Ğ½Ğ°</div>
                <div class="cat-desc" data-i18n="catWarDesc">Ğ£ĞºÑ€Ğ°Ñ—Ğ½Ğ°. Ğ¨Ğ¿Ğ¸Ğ³ÑƒĞ½Ğ¸ Ñ‚Ğ° Ğ·Ñ€Ğ°Ğ´Ğ½Ğ¸ĞºĞ¸.</div>
            </div>
            <div class="cat-card" data-category="history">
                <div class="cat-icon">ğŸ“œ</div>
                <div class="cat-title" data-i18n="catHistory">Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ</div>
                <div class="cat-desc" data-i18n="catHistoryDesc">ĞšĞ¾Ğ·Ğ°ĞºĞ¸, Ğ¿Ñ–Ğ´Ğ¿Ñ–Ğ»Ğ»Ñ, Ñ€ĞµĞ²Ğ¾Ğ»ÑÑ†Ñ–Ñ.</div>
            </div>
            <div class="cat-card" data-category="hollywood">
                <div class="cat-icon">ğŸ¬</div>
                <div class="cat-title" data-i18n="catHollywood">Ğ“Ğ¾Ğ»Ğ»Ñ–Ğ²ÑƒĞ´</div>
                <div class="cat-desc" data-i18n="catHollywoodDesc">90-Ñ‚Ñ–. Ğ—Ñ–Ñ€ĞºĞ¸ Ñ‚Ğ° Ğ²Ğ±Ğ¸Ğ²ÑÑ‚Ğ²Ğ°.</div>
            </div>
        </div>
    </div>
</div>

<div class="loading-screen" id="loading-screen">
    <div class="loader"></div>
    <div class="loading-text" data-i18n="generating">Ğ“ĞµĞ½ĞµÑ€ÑƒÑ ÑĞ¿Ñ€Ğ°Ğ²Ñƒ...<br>(15-20 ÑĞµĞºÑƒĞ½Ğ´)</div>
</div>

<div class="game-screen" id="game-screen">
    <div class="game-container">
        <header class="game-header">
            <div class="suspect-image-container">
                <img id="suspect-img" class="suspect-image" src="" alt="Suspect">
                <div class="loader-mini" id="suspect-loader-mini"></div>
            </div>
            <div class="game-header-text">
                <h1 class="game-title" id="game-title">Case #???</h1>
                <p class="game-subtitle" id="game-suspect-name">...</p>
            </div>
        </header>
        
        <div class="status-bar">
            <div class="status-item">
                <span class="status-label" data-i18n="energy">Ğ•Ğ½ĞµÑ€Ğ³Ñ–Ñ</span>
                <div class="status-value">
                    <span class="energy-display" id="energy-current">15</span>
                    <span style="font-size:0.6rem;color:var(--text-muted);">/ 15</span>
                </div>
            </div>
            <div class="status-item">
                <span class="status-label" data-i18n="pressure">Ğ¢Ğ¸ÑĞº</span>
                <div class="suspicion-container">
                    <div class="suspicion-bar-bg">
                        <div class="suspicion-bar-fill" id="suspicion-bar"></div>
                    </div>
                    <span class="suspicion-value" id="suspicion-text">0%</span>
                </div>
            </div>
        </div>
        
        <div class="briefing-container">
            <button class="briefing-toggle" id="briefing-toggle">
                <span data-i18n="files">ğŸ“ ĞœĞ°Ñ‚ĞµÑ€Ñ–Ğ°Ğ»Ğ¸ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸</span>
                <span class="briefing-toggle-icon">â–¼</span>
            </button>
            <div class="briefing-content" id="briefing-content">
                <div class="briefing-section">
                    <h3 class="briefing-section-title" data-i18n="context">ĞĞ±ÑÑ‚Ğ°Ğ²Ğ¸Ğ½Ğ¸</h3>
                    <p class="briefing-text" id="case-description"></p>
                </div>
                <div class="briefing-section">
                    <h3 class="briefing-section-title" data-i18n="facts">Ğ’Ñ–Ğ´Ğ¾Ğ¼Ñ– Ñ„Ğ°ĞºÑ‚Ğ¸</h3>
                    <ul class="evidence-list" id="case-evidence"></ul>
                </div>
                <div class="briefing-section">
                    <h3 class="briefing-section-title" data-i18n="suspect">ĞŸÑ–Ğ´Ğ¾Ğ·Ñ€ÑĞ²Ğ°Ğ½Ğ¸Ğ¹</h3>
                    <p class="briefing-text" id="suspect-info"></p>
                </div>
            </div>
        </div>
        
        <div class="chat-container">
            <div class="chat-log" id="chat-log"></div>
            <div class="input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="Ğ—Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ..." maxlength="500">
                <button class="send-btn" id="send-btn" data-i18n="send">ĞĞ°Ğ´Ñ–ÑĞ»Ğ°Ñ‚Ğ¸</button>
            </div>
        </div>
        
        <div class="action-bar">
            <button class="action-btn action-btn--hint" id="hint-btn">ğŸ’¡ <span data-i18n="hint">ĞŸÑ–Ğ´ĞºĞ°Ğ·ĞºĞ°</span> <span id="hint-counter">(3)</span></button>
            <button class="action-btn action-btn--coffee" id="coffee-btn">â˜• <span data-i18n="coffee">ĞšĞ°Ğ²Ğ°</span> <span id="coffee-counter">(2)</span></button>
            <button class="action-btn action-btn--accuse" id="accuse-btn" data-i18n="verdict">âš–ï¸ Ğ’ĞµÑ€Ğ´Ğ¸ĞºÑ‚</button>
            <button class="action-btn" id="restart-btn" data-i18n="restart">â†º Ğ¡Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ</button>
        </div>
        <div class="action-bar" style="margin-top:0;">
            <button class="action-btn action-btn--reveal" id="reveal-btn" data-i18n="reveal">ğŸ”“ Ğ Ğ¾Ğ·ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ</button>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modal-overlay">
    <div class="modal-content">
        <div class="modal-icon" id="modal-icon">ğŸ”</div>
        <h2 class="modal-title" id="modal-title">Case Closed</h2>
        <p class="modal-text" id="modal-text"></p>
        <div class="modal-reveal">
            <h4 class="modal-reveal-title" data-i18n="truth">ĞŸÑ€Ğ°Ğ²Ğ´Ğ°</h4>
            <p class="modal-reveal-text" id="modal-reveal-text"></p>
        </div>
        <button class="modal-btn" id="modal-btn" data-i18n="back">Ğ’ Ğ¼ĞµĞ½Ñ</button>
        <a href="https://forms.gle/xtrEqNsFb8wx7uyq5" target="_blank" class="feedback-link" data-i18n="feedback">ğŸ’¬ Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ³ÑƒĞº</a>
    </div>
</div>

<audio id="audio-typewriter" src="p_machine.mp3" preload="auto"></audio>
<audio id="audio-background" src="background.mp3" preload="auto" loop></audio>
```

<script>
(function(){
'use strict';

const API_ENDPOINT = 'https://interrogator-api.sashko1391.workers.dev';
let currentCaseData = null;
let isMuted = localStorage.getItem('interrogator-muted') === 'true';
let audioStarted = false;
let lastVisualState = 'neutral';
let currentLang = localStorage.getItem('interrogator-lang') || 'ua';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOCALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const i18n = {
    ua: {
        title: "Ğ¡Ğ»Ñ–Ğ´Ñ‡Ğ¸Ğ¹",
        tagline: "AI-Generated Detective Stories",
        catWar: "Ğ’Ñ–Ğ¹Ğ½Ğ°",
        catWarDesc: "Ğ£ĞºÑ€Ğ°Ñ—Ğ½Ğ°. Ğ¨Ğ¿Ğ¸Ğ³ÑƒĞ½Ğ¸ Ñ‚Ğ° Ğ·Ñ€Ğ°Ğ´Ğ½Ğ¸ĞºĞ¸.",
        catHistory: "Ğ†ÑÑ‚Ğ¾Ñ€Ñ–Ñ", 
        catHistoryDesc: "ĞšĞ¾Ğ·Ğ°ĞºĞ¸, Ğ¿Ñ–Ğ´Ğ¿Ñ–Ğ»Ğ»Ñ, Ñ€ĞµĞ²Ğ¾Ğ»ÑÑ†Ñ–Ñ.",
        catHollywood: "Ğ“Ğ¾Ğ»Ğ»Ñ–Ğ²ÑƒĞ´",
        catHollywoodDesc: "90-Ñ‚Ñ–. Ğ—Ñ–Ñ€ĞºĞ¸ Ñ‚Ğ° Ğ²Ğ±Ğ¸Ğ²ÑÑ‚Ğ²Ğ°.",
        generating: "Ğ“ĞµĞ½ĞµÑ€ÑƒÑ ÑĞ¿Ñ€Ğ°Ğ²Ñƒ...<br>(15-20 ÑĞµĞºÑƒĞ½Ğ´)",
        energy: "Ğ•Ğ½ĞµÑ€Ğ³Ñ–Ñ",
        pressure: "Ğ¢Ğ¸ÑĞº",
        files: "ğŸ“ ĞœĞ°Ñ‚ĞµÑ€Ñ–Ğ°Ğ»Ğ¸ ÑĞ¿Ñ€Ğ°Ğ²Ğ¸",
        context: "ĞĞ±ÑÑ‚Ğ°Ğ²Ğ¸Ğ½Ğ¸",
        facts: "Ğ’Ñ–Ğ´Ğ¾Ğ¼Ñ– Ñ„Ğ°ĞºÑ‚Ğ¸",
        suspect: "ĞŸÑ–Ğ´Ğ¾Ğ·Ñ€ÑĞ²Ğ°Ğ½Ğ¸Ğ¹",
        send: "ĞĞ°Ğ´Ñ–ÑĞ»Ğ°Ñ‚Ğ¸",
        hint: "ĞŸÑ–Ğ´ĞºĞ°Ğ·ĞºĞ°",
        coffee: "ĞšĞ°Ğ²Ğ°",
        verdict: "âš–ï¸ Ğ’ĞµÑ€Ğ´Ğ¸ĞºÑ‚",
        restart: "â†º Ğ¡Ğ¿Ğ¾Ñ‡Ğ°Ñ‚ĞºÑƒ",
        reveal: "ğŸ”“ Ğ Ğ¾Ğ·ĞºÑ€Ğ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´ÑŒ",
        truth: "ĞŸÑ€Ğ°Ğ²Ğ´Ğ°",
        back: "Ğ’ Ğ¼ĞµĞ½Ñ",
        feedback: "ğŸ’¬ Ğ—Ğ°Ğ»Ğ¸ÑˆĞ¸Ñ‚Ğ¸ Ğ²Ñ–Ğ´Ğ³ÑƒĞº",
        prompt: "Ğ—Ğ°Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¿Ğ¸Ñ‚Ğ°Ğ½Ğ½Ñ...",
        winTitle: "Ğ¡Ğ¿Ñ€Ğ°Ğ²Ñƒ Ñ€Ğ¾Ğ·ĞºÑ€Ğ¸Ñ‚Ğ¾!",
        loseTitle: "ĞŸÑ€Ğ¾Ğ²Ğ°Ğ»...",
        startMsg: "ğŸ¬ Ğ”Ğ¾Ğ¿Ğ¸Ñ‚ Ñ€Ğ¾Ğ·Ğ¿Ğ¾Ñ‡Ğ°Ñ‚Ğ¾.",
        detective: "Ğ”ĞµÑ‚ĞµĞºÑ‚Ğ¸Ğ²",
        suspectLabel: "ĞŸÑ–Ğ´Ğ¾Ğ·Ñ€ÑĞ²Ğ°Ğ½Ğ¸Ğ¹",
        hint1: "ğŸ’¡ Ğ—Ğ²ĞµÑ€Ğ½Ğ¸ ÑƒĞ²Ğ°Ğ³Ñƒ Ğ½Ğ° Ğ½ĞµĞ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ğ½Ğ¾ÑÑ‚Ñ– Ğ² Ñ‡Ğ°ÑÑ– Ñ‚Ğ° Ğ¼Ñ–ÑÑ†Ñ–.",
        hint2: "ğŸ’¡ Ğ—Ğ°Ğ¿Ğ¸Ñ‚Ğ°Ğ¹ Ğ¿Ñ€Ğ¾ ÑÑ‚Ğ¾ÑÑƒĞ½ĞºĞ¸ Ñ‚Ğ° Ğ¼Ğ¾Ñ‚Ğ¸Ğ²Ğ¸.",
        hint3: "ğŸ’¡ Ğ’ĞºĞ°Ğ¶Ğ¸ Ğ½Ğ° ÑÑƒĞ¿ĞµÑ€ĞµÑ‡Ğ½Ğ¾ÑÑ‚Ñ–, ÑĞºÑ– Ğ·Ğ½Ğ°Ğ¹ÑˆĞ¾Ğ².",
        coffeeMsg: "â˜• +5 ĞµĞ½ĞµÑ€Ğ³Ñ–Ñ—. ĞšĞ°Ğ²Ğ° Ğ´Ğ¾Ğ¿Ğ¾Ğ¼Ğ°Ğ³Ğ°Ñ” Ğ´ÑƒĞ¼Ğ°Ñ‚Ğ¸.",
        revealConfirm: "âš ï¸ Ğ£Ğ’ĞĞ“Ğ!\n\nĞ Ğ¾Ğ·ĞºÑ€Ğ¸Ñ‚Ñ‚Ñ Ğ²Ñ–Ğ´Ğ¿Ğ¾Ğ²Ñ–Ğ´Ñ– Ğ·Ğ°ĞºÑ–Ğ½Ñ‡Ğ¸Ñ‚ÑŒ Ğ³Ñ€Ñƒ.\nĞ’Ğ¸ Ğ·Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¿Ğ¾Ñ‡Ğ°Ñ‚Ğ¸ Ğ½Ğ¾Ğ²Ñƒ ÑĞ¿Ñ€Ğ°Ğ²Ñƒ.\n\nĞ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ¢ĞĞš Ğ´Ğ»Ñ Ğ¿Ñ–Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¶ĞµĞ½Ğ½Ñ:",
        revealWord: "Ğ¢ĞĞš",
        verdictConfirm: "Ğ’Ğ¸ Ğ²Ğ¿ĞµĞ²Ğ½ĞµĞ½Ñ– Ñƒ ÑĞ²Ğ¾Ñ”Ğ¼Ñƒ Ğ²ĞµÑ€Ğ´Ğ¸ĞºÑ‚Ñ–?",
        noHints: "ĞŸÑ–Ğ´ĞºĞ°Ğ·ĞºĞ¸ Ğ·Ğ°ĞºÑ–Ğ½Ñ‡Ğ¸Ğ»Ğ¸ÑÑŒ!",
        noCoffee: "ĞšĞ°Ğ²Ğ° Ğ·Ğ°ĞºÑ–Ğ½Ñ‡Ğ¸Ğ»Ğ°ÑÑŒ!",
        energyFull: "Ğ•Ğ½ĞµÑ€Ğ³Ñ–Ñ Ğ²Ğ¶Ğµ Ğ¿Ğ¾Ğ²Ğ½Ğ°!"
    },
    en: {
        title: "The Interrogator",
        tagline: "AI-Generated Detective Stories",
        catWar: "War Zone",
        catWarDesc: "Ukraine. Spies and traitors.",
        catHistory: "History",
        catHistoryDesc: "Cossacks, rebels, revolution.",
        catHollywood: "Hollywood",
        catHollywoodDesc: "90s. Stars and murders.",
        generating: "Generating case...<br>(15-20 seconds)",
        energy: "Energy",
        pressure: "Pressure",
        files: "ğŸ“ Case Files",
        context: "Context",
        facts: "Known Facts",
        suspect: "Suspect",
        send: "Send",
        hint: "Hint",
        coffee: "Coffee",
        verdict: "âš–ï¸ Verdict",
        restart: "â†º Restart",
        reveal: "ğŸ”“ Reveal Answer",
        truth: "The Truth",
        back: "Menu",
        feedback: "ğŸ’¬ Leave Feedback",
        prompt: "Ask a question...",
        winTitle: "Case Closed!",
        loseTitle: "Failed...",
        startMsg: "ğŸ¬ Interrogation started.",
        detective: "Detective",
        suspectLabel: "Suspect",
        hint1: "ğŸ’¡ Look for inconsistencies in time and place.",
        hint2: "ğŸ’¡ Ask about relationships and motives.",
        hint3: "ğŸ’¡ Point out contradictions you found.",
        coffeeMsg: "â˜• +5 energy. Coffee helps you think.",
        revealConfirm: "âš ï¸ WARNING!\n\nRevealing the answer will end the game.\nYou can start a new case.\n\nType YES to confirm:",
        revealWord: "YES",
        verdictConfirm: "Are you sure about your verdict?",
        noHints: "No hints left!",
        noCoffee: "No coffee left!",
        energyFull: "Energy is already full!"
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const GameState = {
    energy: 15,
    maxEnergy: 15,
    suspicion: 0,
    hintsRemaining: 3,
    coffeesRemaining: 2,
    conversationHistory: [],
    gameOver: false,
    
    reset() {
        this.energy = 15;
        this.suspicion = 0;
        this.hintsRemaining = 3;
        this.coffeesRemaining = 2;
        this.conversationHistory = [];
        this.gameOver = false;
        lastVisualState = 'neutral';
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DOM ELEMENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const DOM = {
    startScreen: document.getElementById('start-screen'),
    loadingScreen: document.getElementById('loading-screen'),
    gameScreen: document.getElementById('game-screen'),
    chatLog: document.getElementById('chat-log'),
    chatInput: document.getElementById('chat-input'),
    sendBtn: document.getElementById('send-btn'),
    energyCurrent: document.getElementById('energy-current'),
    suspicionBar: document.getElementById('suspicion-bar'),
    suspicionText: document.getElementById('suspicion-text'),
    briefingToggle: document.getElementById('briefing-toggle'),
    briefingContent: document.getElementById('briefing-content'),
    caseDescription: document.getElementById('case-description'),
    caseEvidence: document.getElementById('case-evidence'),
    suspectInfo: document.getElementById('suspect-info'),
    gameTitle: document.getElementById('game-title'),
    gameSuspectName: document.getElementById('game-suspect-name'),
    suspectImg: document.getElementById('suspect-img'),
    suspectLoaderMini: document.getElementById('suspect-loader-mini'),
    modalOverlay: document.getElementById('modal-overlay'),
    modalTitle: document.getElementById('modal-title'),
    modalText: document.getElementById('modal-text'),
    modalRevealText: document.getElementById('modal-reveal-text'),
    modalIcon: document.getElementById('modal-icon'),
    catCards: document.querySelectorAll('.cat-card'),
    backBtn: document.getElementById('back-btn'),
    modalBtn: document.getElementById('modal-btn'),
    hintBtn: document.getElementById('hint-btn'),
    hintCounter: document.getElementById('hint-counter'),
    coffeeBtn: document.getElementById('coffee-btn'),
    coffeeCounter: document.getElementById('coffee-counter'),
    revealBtn: document.getElementById('reveal-btn'),
    accuseBtn: document.getElementById('accuse-btn'),
    restartBtn: document.getElementById('restart-btn'),
    muteBtn: document.getElementById('mute-btn'),
    audioBg: document.getElementById('audio-background'),
    audioType: document.getElementById('audio-typewriter'),
    langBtns: document.querySelectorAll('.lang-btn')
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITY FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function t(key) {
    return i18n[currentLang][key] || i18n['en'][key] || key;
}

function updateTexts() {
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (i18n[currentLang][key]) {
            el.innerHTML = i18n[currentLang][key];
        }
    });
    DOM.chatInput.placeholder = t('prompt');
}

function setLanguage(lang) {
    currentLang = lang;
    localStorage.setItem('interrogator-lang', lang);
    DOM.langBtns.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.lang === lang);
    });
    updateTexts();
}

function startAudio() {
    if (!audioStarted && !isMuted) {
        DOM.audioBg.volume = 0.3;
        DOM.audioBg.play().catch(() => {});
        audioStarted = true;
    }
}

function updateMuteButton() {
    DOM.muteBtn.textContent = isMuted ? 'ğŸ”‡' : 'ğŸ”Š';
    localStorage.setItem('interrogator-muted', isMuted);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI UPDATE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateUI() {
    DOM.energyCurrent.textContent = GameState.energy;
    DOM.energyCurrent.style.color = GameState.energy <= 3 ? 'var(--accent-red-bright)' : 'var(--accent-gold)';
    DOM.suspicionBar.style.width = GameState.suspicion + '%';
    DOM.suspicionText.textContent = GameState.suspicion + '%';
    
    // Update counters
    DOM.hintCounter.textContent = `(${GameState.hintsRemaining})`;
    DOM.coffeeCounter.textContent = `(${GameState.coffeesRemaining})`;
    
    // Disable buttons when empty
    DOM.hintBtn.disabled = GameState.hintsRemaining <= 0 || GameState.gameOver;
    DOM.coffeeBtn.disabled = GameState.coffeesRemaining <= 0 || GameState.energy >= GameState.maxEnergy || GameState.gameOver;
    DOM.sendBtn.disabled = GameState.gameOver;
    DOM.chatInput.disabled = GameState.gameOver;
    DOM.accuseBtn.disabled = GameState.gameOver;
}

function disableAllInputs(disabled) {
    DOM.sendBtn.disabled = disabled;
    DOM.chatInput.disabled = disabled;
    DOM.hintBtn.disabled = disabled;
    DOM.coffeeBtn.disabled = disabled;
    DOM.accuseBtn.disabled = disabled;
    DOM.revealBtn.disabled = disabled;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MESSAGE FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addMsg(text, type) {
    const div = document.createElement('div');
    div.className = `message message-${type}`;
    
    if (type === 'player') {
        div.innerHTML = `<div class="message-sender">${t('detective')}</div><div class="message-text">${text}</div>`;
    } else if (type === 'npc') {
        div.innerHTML = `<div class="message-sender">${currentCaseData?.suspectName || t('suspectLabel')}</div><div class="message-text"></div>`;
        DOM.chatLog.appendChild(div);
        DOM.chatLog.scrollTop = DOM.chatLog.scrollHeight;
        typeWriter(div.querySelector('.message-text'), text);
        return;
    } else {
        div.innerHTML = `<div class="message-text">${text}</div>`;
    }
    
    DOM.chatLog.appendChild(div);
    DOM.chatLog.scrollTop = DOM.chatLog.scrollHeight;
}

function typeWriter(element, text, speed = 25) {
    let i = 0;
    if (!isMuted) {
        DOM.audioType.volume = 0.2;
        DOM.audioType.currentTime = 0;
        DOM.audioType.play().catch(() => {});
    }
    
    const interval = setInterval(() => {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            DOM.chatLog.scrollTop = DOM.chatLog.scrollHeight;
        } else {
            clearInterval(interval);
            if (!isMuted) DOM.audioType.pause();
        }
    }, speed);
}

function showTyping() {
    const div = document.createElement('div');
    div.id = 'typing-indicator';
    div.className = 'typing-indicator';
    div.innerHTML = '<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';
    DOM.chatLog.appendChild(div);
    DOM.chatLog.scrollTop = DOM.chatLog.scrollHeight;
}

function hideTyping() {
    document.getElementById('typing-indicator')?.remove();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MODAL FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showModal(type, reason = '') {
    GameState.gameOver = true;
    disableAllInputs(true);
    
    DOM.modalIcon.textContent = type === 'win' ? 'âœ…' : 'âŒ';
    DOM.modalTitle.textContent = type === 'win' ? t('winTitle') : t('loseTitle');
    DOM.modalTitle.className = `modal-title modal-title--${type}`;
    DOM.modalText.textContent = reason;
    DOM.modalRevealText.textContent = currentCaseData?.truthReveal || '';
    DOM.modalOverlay.classList.add('visible');
    
    if (!isMuted) DOM.audioBg.pause();
}

function hideModal() {
    DOM.modalOverlay.classList.remove('visible');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// API FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function generateCase(category) {
    startAudio();
    DOM.startScreen.classList.add('hidden');
    DOM.backBtn.style.display = 'none';
    DOM.loadingScreen.classList.add('visible');
    
    try {
        const response = await fetch(API_ENDPOINT + '/generate', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ category: category, lang: currentLang })
        });
        
        if (!response.ok) {
            const errData = await response.json().catch(() => ({}));
            throw new Error(errData.error || `HTTP ${response.status}`);
        }
        
        currentCaseData = await response.json();
        startGame();
    } catch (e) {
        console.error('Generate Error:', e);
        alert(`Error: ${e.message}`);
        DOM.loadingScreen.classList.remove('visible');
        DOM.startScreen.classList.remove('hidden');
    }
}

async function generateSuspectImage() {
    if (!currentCaseData?.visualPrompt) return;
    
    let newState = 'calm';
    if (GameState.suspicion > 80) newState = 'broken';
    else if (GameState.suspicion > 50) newState = 'nervous';
    
    if (newState === lastVisualState && DOM.suspectImg.src.includes('http')) return;
    lastVisualState = newState;
    
    DOM.suspectLoaderMini.classList.add('visible');
    
    let prompt = currentCaseData.visualPrompt;
    if (newState === 'nervous') prompt += ", nervous, sweating, anxious eyes";
    if (newState === 'broken') prompt += ", crying, looking down, defeated, despair";
    
    try {
        const response = await fetch(API_ENDPOINT + '/image', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt: prompt })
        });
        
        const data = await response.json();
        if (data.error) throw new Error(data.error);
        
        if (data.imageUrl) {
            const img = new Image();
            img.onload = () => {
                DOM.suspectImg.src = data.imageUrl;
                DOM.suspectLoaderMini.classList.remove('visible');
                DOM.suspectImg.style.display = 'block';
            };
            img.onerror = () => {
                DOM.suspectLoaderMini.classList.remove('visible');
            };
            img.src = data.imageUrl;
        }
    } catch (e) {
        console.error('Image Error:', e);
        DOM.suspectLoaderMini.classList.remove('visible');
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME FUNCTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
    DOM.loadingScreen.classList.remove('visible');
    DOM.gameScreen.classList.add('active');
    DOM.backBtn.style.display = 'flex';
    
    GameState.reset();
    updateUI();
    
    // Fill case data
    DOM.gameTitle.textContent = currentCaseData.title || 'Case #???';
    DOM.gameSuspectName.textContent = currentCaseData.suspectName || '???';
    DOM.caseDescription.textContent = currentCaseData.crimeDescription || '';
    DOM.suspectInfo.textContent = currentCaseData.suspectProfile || '';
    DOM.caseEvidence.innerHTML = (currentCaseData.knownFacts || []).map(f => `<li>${f}</li>`).join('');
    
    // Reset chat
    DOM.chatLog.innerHTML = '';
    
    // Reset image
    DOM.suspectImg.style.display = 'none';
    DOM.suspectImg.src = '';
    DOM.suspectLoaderMini.classList.add('visible');
    
    // Start background music
    if (!isMuted) {
        DOM.audioBg.currentTime = 0;
        DOM.audioBg.play().catch(() => {});
    }
    
    // Initial messages
    addMsg(t('startMsg'), 'system');
    generateSuspectImage();
    
    setTimeout(() => {
        if (currentCaseData.npcGreeting) {
            GameState.conversationHistory.push({ role: 'assistant', content: currentCaseData.npcGreeting });
            addMsg(currentCaseData.npcGreeting, 'npc');
        }
    }, 500);
    
    // Open briefing by default
    DOM.briefingToggle.classList.add('active');
    DOM.briefingContent.classList.add('visible');
    
    DOM.chatInput.focus();
}

async function sendMessage() {
    if (GameState.gameOver || GameState.energy <= 0) return;
    
    const text = DOM.chatInput.value.trim();
    if (!text) return;
    
    DOM.chatInput.value = '';
    GameState.energy--;
    updateUI();
    
    addMsg(text, 'player');
    GameState.conversationHistory.push({ role: 'user', content: text });
    
    disableAllInputs(true);
    showTyping();
    
    const systemPrompt = `${currentCaseData.systemPrompt || ''}

CURRENT STATE:
- Suspicion Level: ${GameState.suspicion}%
- Energy Left: ${GameState.energy}

INSTRUCTIONS: 
- Respond in character as the suspect
- If caught in a lie or pressed hard, show more nervousness
- ALWAYS append hidden tag at the end: <<<NERVOUSNESS: [0-100]>>>
- Keep responses under 150 words`;
    
    try {
        const response = await fetch(API_ENDPOINT + '/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                system: systemPrompt,
                messages: GameState.conversationHistory
            })
        });
        
        const data = await response.json();
        let reply = data.content?.[0]?.text || '*Ğ¼Ğ¾Ğ²Ñ‡Ğ¸Ñ‚ÑŒ*';
        
        // Extract nervousness
        const match = reply.match(/<<<NERVOUSNESS:\s*(\d+)>>>/);
        if (match) {
            GameState.suspicion = Math.min(100, Math.max(GameState.suspicion, parseInt(match[1])));
            reply = reply.replace(match[0], '').trim();
            updateUI();
            generateSuspectImage();
        }
        
        GameState.conversationHistory.push({ role: 'assistant', content: reply });
        hideTyping();
        addMsg(reply, 'npc');
        
    } catch (e) {
        console.error('Chat Error:', e);
        hideTyping();
        addMsg('*Ğ¼Ğ¾Ğ²Ñ‡Ğ¸Ñ‚ÑŒ*', 'npc');
    }
    
    disableAllInputs(false);
    updateUI();
    DOM.chatInput.focus();
    
    // Check energy
    if (GameState.energy <= 0) {
        setTimeout(() => showModal('lose', currentLang === 'ua' ? 'Ğ•Ğ½ĞµÑ€Ğ³Ñ–Ñ Ğ²Ğ¸Ñ‡ĞµÑ€Ğ¿Ğ°Ğ½Ğ°.' : 'Energy exhausted.'), 1000);
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACTION HANDLERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function useHint() {
    if (GameState.gameOver) return;
    if (GameState.hintsRemaining <= 0) {
        addMsg(t('noHints'), 'system');
        return;
    }
    
    const hintNum = 4 - GameState.hintsRemaining; // 1, 2, 3
    GameState.hintsRemaining--;
    updateUI();
    
    const hintKey = 'hint' + hintNum;
    addMsg(t(hintKey), 'system');
}

function useCoffee() {
    if (GameState.gameOver) return;
    if (GameState.coffeesRemaining <= 0) {
        addMsg(t('noCoffee'), 'system');
        return;
    }
    if (GameState.energy >= GameState.maxEnergy) {
        addMsg(t('energyFull'), 'system');
        return;
    }
    
    GameState.coffeesRemaining--;
    GameState.energy = Math.min(GameState.maxEnergy, GameState.energy + 5);
    updateUI();
    addMsg(t('coffeeMsg'), 'system');
}

async function handleAccuse() {
    if (GameState.gameOver) return;
    
    const confirmed = confirm(t('verdictConfirm'));
    if (!confirmed) return;
    
    addMsg('â³ ĞĞ½Ğ°Ğ»Ñ–Ğ·ÑƒÑ...', 'system');
    disableAllInputs(true);
    
    const log = GameState.conversationHistory.map(m => `${m.role}: ${m.content}`).join('\n');
    const judgePrompt = `Case: ${currentCaseData.title}
Truth: ${currentCaseData.truthReveal}

Analyze the interrogation log below. Did the user uncover the truth or break the suspect?
Reply JSON ONLY: { "verdict": "WIN" or "LOSE", "reason": "Short reason in ${currentLang === 'ua' ? 'Ukrainian' : 'English'}" }

LOG:
${log}`;
    
    try {
        const response = await fetch(API_ENDPOINT + '/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                system: "You are a Senior Detective Judge. Analyze interrogations.",
                messages: [{ role: 'user', content: judgePrompt }]
            })
        });
        
        const data = await response.json();
        const text = data.content?.[0]?.text || '{}';
        const cleanJson = text.replace(/```json/g, '').replace(/```/g, '').trim();
        const result = JSON.parse(cleanJson);
        
        showModal(result.verdict?.toLowerCase() || 'lose', result.reason || '');
    } catch (e) {
        console.error('Judge Error:', e);
        // Fallback based on suspicion
        if (GameState.suspicion >= 60) {
            showModal('win', currentLang === 'ua' ? 'ĞŸÑ–Ğ´Ğ¾Ğ·Ñ€ÑĞ²Ğ°Ğ½Ğ¸Ğ¹ Ğ·Ğ»Ğ°Ğ¼Ğ°Ğ²ÑÑ Ğ¿Ñ–Ğ´ Ñ‚Ğ¸ÑĞºĞ¾Ğ¼.' : 'Suspect broke under pressure.');
        } else {
            showModal('lose', currentLang === 'ua' ? 'ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ½ÑŒĞ¾ Ğ´Ğ¾ĞºĞ°Ğ·Ñ–Ğ².' : 'Insufficient evidence.');
        }
    }
}

function revealAnswer() {
    if (GameState.gameOver) return;
    
    const input = prompt(t('revealConfirm'));
    if (input && input.toUpperCase() === t('revealWord')) {
        GameState.gameOver = true;
        disableAllInputs(true);
        addMsg('ğŸ”“ ' + t('truth') + ': ' + (currentCaseData?.truthReveal || '???'), 'system');
        if (!isMuted) DOM.audioBg.pause();
    }
}

function goBack() {
    DOM.gameScreen.classList.remove('active');
    DOM.startScreen.classList.remove('hidden');
    DOM.backBtn.style.display = 'none';
    if (!isMuted) DOM.audioBg.pause();
    hideModal();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT LISTENERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
DOM.langBtns.forEach(btn => {
    btn.addEventListener('click', () => setLanguage(btn.dataset.lang));
});

DOM.catCards.forEach(card => {
    card.addEventListener('click', () => generateCase(card.dataset.category));
});

DOM.sendBtn.addEventListener('click', sendMessage);
DOM.chatInput.addEventListener('keypress', e => {
    if (e.key === 'Enter') sendMessage();
});

DOM.briefingToggle.addEventListener('click', () => {
    DOM.briefingToggle.classList.toggle('active');
    DOM.briefingContent.classList.toggle('visible');
});

DOM.hintBtn.addEventListener('click', useHint);
DOM.coffeeBtn.addEventListener('click', useCoffee);
DOM.accuseBtn.addEventListener('click', handleAccuse);
DOM.revealBtn.addEventListener('click', revealAnswer);
DOM.restartBtn.addEventListener('click', () => {
    if (currentCaseData) startGame();
});

DOM.backBtn.addEventListener('click', goBack);
DOM.modalBtn.addEventListener('click', () => {
    hideModal();
    goBack();
});

DOM.muteBtn.addEventListener('click', () => {
    isMuted = !isMuted;
    updateMuteButton();
    if (isMuted) {
        DOM.audioBg.pause();
        DOM.audioType.pause();
    } else if (DOM.gameScreen.classList.contains('active')) {
        DOM.audioBg.play().catch(() => {});
    }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INITIALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
updateMuteButton();
setLanguage(currentLang);

})();
</script>

</body>
</html>
