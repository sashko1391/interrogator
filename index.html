<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Interrogator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Source+Code+Pro:wght@400;500&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root{--bg-primary:#0a0a0c;--bg-secondary:#12121a;--bg-tertiary:#1a1a24;--bg-card:#15151f;--text-primary:#e8e6e3;--text-secondary:#9a9a9a;--text-muted:#5a5a6a;--accent-gold:#d4af37;--accent-gold-dim:#8b7323;--accent-red:#8b2942;--accent-red-bright:#c73e5c;--accent-green:#2d5a3d;--accent-green-bright:#4a9b6a;--border-color:#2a2a3a;--border-accent:#3a3a4a;--font-display:'Playfair Display',Georgia,serif;--font-body:'Crimson Pro',Georgia,serif;--font-mono:'Source Code Pro',monospace}
        *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
        
        /* --- –ó–ú–Ü–ù–ê –†–û–ó–ú–Ü–†–£ –®–†–ò–§–¢–£ –¢–£–¢ --- */
        html{font-size:24px;scroll-behavior:smooth}
        
        body{font-family:var(--font-body);background:var(--bg-primary);color:var(--text-primary);min-height:100vh;line-height:1.6}
        body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");opacity:0.03;pointer-events:none;z-index:1000}
        
        /* UI Elements Positioning */
        .top-controls-left {position:fixed;top:1rem;left:1rem;display:flex;gap:0.5rem;z-index:50;}
        .lang-switcher{position:fixed;top:1rem;right:1rem;display:flex;z-index:50}
        
        .icon-btn{background:rgba(18,18,26,0.9);border:1px solid var(--border-color);color:var(--text-muted);padding:0.4rem 0.7rem;font-family:var(--font-mono);font-size:0.6rem;cursor:pointer;transition:all 150ms;border-radius:4px;display:flex;align-items:center;justify-content:center;min-width:32px;}
        .icon-btn:hover{border-color:var(--border-accent);color:var(--text-secondary)}
        .icon-btn.active{background:var(--accent-gold-dim);border-color:var(--accent-gold-dim);color:var(--bg-primary)}
        
        .lang-btn{border-radius:0;border-right:none;}
        .lang-btn:first-child{border-radius:4px 0 0 4px;}
        .lang-btn:last-child{border-radius:0 4px 4px 0;border-right:1px solid var(--border-color);}
        
        /* Screens */
        .start-screen{min-height:100vh;display:flex;flex-direction:column;position:relative}
        .bg-fallback{position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(ellipse at 20% 20%,rgba(139,41,66,0.15) 0%,transparent 50%),radial-gradient(ellipse at 80% 80%,rgba(212,175,55,0.1) 0%,transparent 50%),linear-gradient(180deg,#0a0a0c 0%,#12121a 100%);z-index:-2}
        .bg-image{position:fixed;top:0;left:0;width:100%;height:100%;background-size:cover;background-position:center;z-index:-1}
        .bg-image::after{content:'';position:absolute;top:0;left:0;width:100%;height:100%;background:linear-gradient(to bottom,rgba(10,10,12,0.4) 0%,rgba(10,10,12,0.7) 50%,rgba(10,10,12,0.95) 100%)}
        .bg-landscape{background-image:url('bg-landscape.jpg');display:block}
        .bg-portrait{background-image:url('bg-portrait.jpg');display:none}
        @media(orientation:portrait){.bg-landscape{display:none}.bg-portrait{display:block}}
        
        .start-content{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:2rem;text-align:center;position:relative;z-index:1}
        .start-title{font-family:var(--font-display);font-size:2.5rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-primary);margin-bottom:0.5rem;text-shadow:0 0 60px rgba(212,175,55,0.3)}
        .start-tagline{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted);letter-spacing:0.3em;text-transform:uppercase;margin-bottom:2.5rem}
        .start-description{max-width:500px;color:var(--text-secondary);font-size:0.85rem;line-height:1.8;margin-bottom:2.5rem}
        
        .case-selection{width:100%;max-width:700px}
        .case-selection-title{font-family:var(--font-mono);font-size:0.6rem;color:var(--text-muted);letter-spacing:0.2em;text-transform:uppercase;margin-bottom:1.5rem}
        .case-cards{display:flex;flex-direction:column;gap:1rem}
        .case-card{background:rgba(21,21,31,0.9);border:1px solid var(--border-color);border-radius:4px;padding:1.25rem;cursor:pointer;transition:all 300ms;text-align:left;display:grid;grid-template-columns:auto 1fr auto;gap:1.25rem;align-items:center}
        .case-card:hover{border-color:var(--border-accent);background:rgba(26,26,36,0.95);transform:translateX(4px)}
        .case-card--easy:hover{border-color:var(--accent-green);box-shadow:0 0 30px rgba(74,155,106,0.1)}
        .case-card--medium:hover{border-color:var(--accent-gold);box-shadow:0 0 30px rgba(212,175,55,0.1)}
        .case-card--hard:hover{border-color:var(--accent-red);box-shadow:0 0 30px rgba(199,62,92,0.1)}
        .case-difficulty{width:55px;height:55px;border-radius:4px;display:flex;flex-direction:column;align-items:center;justify-content:center;font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.1em}
        .case-difficulty--easy{background:rgba(45,90,61,0.3);border:1px solid var(--accent-green);color:var(--accent-green-bright)}
        .case-difficulty--medium{background:rgba(139,115,35,0.3);border:1px solid var(--accent-gold-dim);color:var(--accent-gold)}
        .case-difficulty--hard{background:rgba(139,41,66,0.3);border:1px solid var(--accent-red);color:var(--accent-red-bright)}
        .case-info{flex:1}
        .case-title{font-family:var(--font-display);font-size:0.95rem;color:var(--text-primary);margin-bottom:0.25rem}
        .case-subtitle{font-size:0.7rem;color:var(--text-secondary);line-height:1.5}
        .case-arrow{font-size:1.1rem;color:var(--text-muted);transition:transform 150ms}
        .case-card:hover .case-arrow{transform:translateX(4px);color:var(--text-secondary)}
        
        /* Game Screen */
        .game-screen{display:none;min-height:100vh;position:relative}
        .game-screen.active{display:block}
        .game-screen .bg-fallback,.game-screen .bg-image{position:fixed}
        .start-screen.hidden{display:none}
        .game-container{max-width:900px;margin:0 auto;padding:1.5rem;min-height:100vh;display:flex;flex-direction:column}
        
        .game-header{text-align:center;padding:2rem 0;border-bottom:1px solid var(--border-color);margin-bottom:1.5rem;position:relative;margin-top:1rem;}
        .game-header::after{content:'‚óÜ';position:absolute;bottom:-0.5rem;left:50%;transform:translateX(-50%);background:var(--bg-primary);padding:0 1rem;color:var(--accent-gold-dim);font-size:0.55rem}
        .game-title{font-family:var(--font-display);font-size:1.6rem;font-weight:700;letter-spacing:0.15em;text-transform:uppercase;color:var(--text-primary);margin-bottom:0.25rem;text-shadow:0 0 40px rgba(212,175,55,0.2)}
        .game-subtitle{font-family:var(--font-mono);font-size:0.55rem;color:var(--text-muted);letter-spacing:0.3em;text-transform:uppercase}
        
        .status-bar{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;padding:1rem;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;margin-bottom:1.5rem}
        .status-item{display:flex;flex-direction:column;gap:0.25rem}
        .status-label{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.15em;color:var(--text-muted)}
        .status-value{display:flex;align-items:center;gap:0.5rem}
        .energy-display{font-family:var(--font-display);font-size:1.25rem;font-weight:700;color:var(--accent-gold)}
        .energy-max{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-muted)}
        .hint-counter{font-family:var(--font-mono);font-size:0.55rem;color:var(--accent-green-bright);margin-left:0.5rem}
        .suspicion-container{flex:1}
        .suspicion-bar-bg{height:8px;background:var(--bg-tertiary);border-radius:4px;overflow:hidden}
        .suspicion-bar-fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent-green),var(--accent-gold),var(--accent-red-bright));transition:width 300ms;border-radius:4px}
        .suspicion-value{font-family:var(--font-mono);font-size:0.65rem;color:var(--text-secondary);margin-top:0.25rem}
        
        .briefing-container{margin-bottom:1.5rem}
        .briefing-toggle{width:100%;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:1rem 1.5rem;color:var(--text-primary);font-family:var(--font-mono);font-size:0.65rem;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;display:flex;justify-content:space-between;align-items:center;transition:all 150ms}
        .briefing-toggle:hover{background:var(--bg-tertiary);border-color:var(--border-accent)}
        .briefing-toggle.active .briefing-toggle-icon{transform:rotate(180deg)}
        .briefing-content{display:none;background:var(--bg-card);border:1px solid var(--border-color);border-top:none;border-radius:0 0 4px 4px;padding:1.5rem}
        .briefing-content.visible{display:block;animation:slideDown 300ms ease}
        @keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
        .briefing-section{margin-bottom:1.5rem}
        .briefing-section:last-child{margin-bottom:0}
        .briefing-section-title{font-family:var(--font-display);font-size:0.8rem;color:var(--accent-gold);margin-bottom:0.5rem;text-transform:uppercase;letter-spacing:0.1em}
        .briefing-text{color:var(--text-secondary);font-size:0.75rem;line-height:1.7}
        .evidence-list{list-style:none;padding-left:1rem}
        .evidence-list li{position:relative;padding-left:1rem;margin-bottom:0.5rem;color:var(--text-secondary);font-size:0.7rem}
        .evidence-list li::before{content:'‚ñ™';position:absolute;left:0;color:var(--accent-gold-dim)}
        
        /* --- –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –ö–û–ù–¢–ï–ô–ù–ï–† –ß–ê–¢–£ --- */
        .chat-container{flex:1;display:flex;flex-direction:column;background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;overflow:hidden;min-height:40vh;max-height:60vh}
        
        /* --- –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –õ–û–ì –ü–û–í–Ü–î–û–ú–õ–ï–ù–¨ (–∑ –≤—ñ–¥—Å—Ç—É–ø–æ–º –∑–Ω–∏–∑—É) --- */
        .chat-log{flex:1;overflow-y:auto;padding:1.5rem;padding-bottom:4rem;display:flex;flex-direction:column;gap:1rem;scroll-behavior:smooth}
        
        .chat-log::-webkit-scrollbar{width:6px}
        .chat-log::-webkit-scrollbar-track{background:var(--bg-tertiary)}
        .chat-log::-webkit-scrollbar-thumb{background:var(--border-accent);border-radius:3px}
        
        .message{max-width:80%;padding:1rem 1.5rem;border-radius:4px;animation:messageIn 300ms ease}
        @keyframes messageIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .message-player{align-self:flex-end;background:var(--bg-tertiary);border:1px solid var(--border-accent);border-right:3px solid var(--accent-gold)}
        .message-npc{align-self:flex-start;background:var(--bg-card);border:1px solid var(--border-color);border-left:3px solid var(--accent-red)}
        .message-system{align-self:center;background:transparent;border:1px dashed var(--border-color);color:var(--text-muted);font-family:var(--font-mono);font-size:0.6rem;text-align:center;max-width:90%}
        .message-sender{font-family:var(--font-mono);font-size:0.5rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--text-muted);margin-bottom:0.25rem}
        .message-text{font-size:0.75rem;line-height:1.6}
        .message-player .message-text{color:var(--text-primary)}
        .message-npc .message-text{color:var(--text-secondary);font-style:italic}
        .typing-indicator{display:flex;gap:4px;padding:1rem;align-self:flex-start}
        .typing-dot{width:8px;height:8px;background:var(--text-muted);border-radius:50%;animation:typingBounce 1.4s infinite ease-in-out}
        .typing-dot:nth-child(1){animation-delay:0ms}
        .typing-dot:nth-child(2){animation-delay:200ms}
        .typing-dot:nth-child(3){animation-delay:400ms}
        @keyframes typingBounce{0%,60%,100%{transform:translateY(0);opacity:0.4}30%{transform:translateY(-6px);opacity:1}}
        
        .input-container{display:flex;gap:0.5rem;padding:1rem;background:var(--bg-tertiary);border-top:1px solid var(--border-color)}
        .chat-input{flex:1;background:var(--bg-primary);border:1px solid var(--border-color);border-radius:4px;padding:1rem 1.5rem;color:var(--text-primary);font-family:var(--font-body);font-size:0.75rem;outline:none;transition:border-color 150ms}
        .chat-input:focus{border-color:var(--accent-gold-dim)}
        .chat-input::placeholder{color:var(--text-muted);font-style:italic}
        .chat-input:disabled{opacity:0.5;cursor:not-allowed}
        .send-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:1rem 1.5rem;color:var(--bg-primary);font-family:var(--font-mono);font-size:0.6rem;font-weight:500;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms}
        .send-btn:hover:not(:disabled){background:var(--accent-gold)}
        .send-btn:disabled{opacity:0.5;cursor:not-allowed}
        
        .action-bar{display:flex;gap:1rem;margin-top:1.5rem;flex-wrap: wrap;}
        .action-btn{flex:1;background:transparent;border:1px solid var(--border-color);border-radius:4px;padding:1rem 1.5rem;color:var(--text-secondary);font-family:var(--font-mono);font-size:0.6rem;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms;min-width: 100px;}
        .action-btn:hover{border-color:var(--border-accent);color:var(--text-primary)}
        
        .action-btn--accuse{border-color:var(--accent-red);color:var(--accent-red-bright)}
        .action-btn--accuse:hover{background:var(--accent-red);color:var(--text-primary)}
        .action-btn--restart{border-color:var(--accent-gold-dim);color:var(--accent-gold)}
        .action-btn--restart:hover{background:var(--accent-gold-dim);color:var(--bg-primary)}
        .action-btn--hint{border-color:var(--accent-green);color:var(--accent-green-bright)}
        .action-btn--hint:hover{background:var(--accent-green);color:var(--text-primary)}
        .action-btn--hint:disabled{opacity:0.4;cursor:not-allowed;border-color:var(--border-color);color:var(--text-muted)}
        .action-btn--coffee{border-color: #8b5a2b; color: #cd853f;}
        .action-btn--coffee:hover{background: #8b5a2b; color: #fff;}
        .action-btn--reveal{border-color:var(--text-muted);color:var(--text-muted);font-size:0.5rem; width: 100%; margin-top: 0.5rem;}
        .action-btn--reveal:hover{border-color:var(--accent-red);color:var(--accent-red-bright)}
        
        .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);z-index:100;align-items:center;justify-content:center}
        .modal-overlay.visible{display:flex}
        .modal-content{background:var(--bg-secondary);border:1px solid var(--border-color);border-radius:4px;padding:2rem;max-width:500px;width:90%;text-align:center;animation:modalIn 400ms ease}
        @keyframes modalIn{from{opacity:0;transform:scale(0.9) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
        .modal-icon{font-size:2.5rem;margin-bottom:1rem}
        .modal-title{font-family:var(--font-display);font-size:1.2rem;text-transform:uppercase;letter-spacing:0.15em;margin-bottom:1rem}
        .modal-title--win{color:var(--accent-green-bright)}
        .modal-title--lose{color:var(--accent-red-bright)}
        .modal-title--unsolved{color:var(--accent-gold)}
        .modal-text{color:var(--text-secondary);font-size:0.75rem;line-height:1.7;margin-bottom:1.5rem}
        .modal-reveal{background:var(--bg-tertiary);border:1px solid var(--border-color);border-radius:4px;padding:1rem;margin-bottom:1.5rem;text-align:left}
        .modal-reveal-title{font-family:var(--font-mono);font-size:0.55rem;text-transform:uppercase;letter-spacing:0.1em;color:var(--accent-gold);margin-bottom:0.5rem}
        .modal-reveal-text{color:var(--text-secondary);font-size:0.7rem;line-height:1.6}
        .modal-btn{background:var(--accent-gold-dim);border:none;border-radius:4px;padding:1rem 2rem;color:var(--bg-primary);font-family:var(--font-mono);font-size:0.65rem;font-weight:500;text-transform:uppercase;letter-spacing:0.1em;cursor:pointer;transition:all 150ms}
        .modal-btn:hover{background:var(--accent-gold)}
        .game-footer{text-align:center;padding:1.5rem 0;margin-top:1.5rem;border-top:1px solid var(--border-color)}
        .game-footer-text{font-family:var(--font-mono);font-size:0.5rem;color:var(--text-muted);letter-spacing:0.1em}
        
        /* –ê–¥–∞–ø—Ç–∏–≤ –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö –µ–∫—Ä–∞–Ω—ñ–≤: —à—Ä–∏—Ñ—Ç 22px –∑–∞–º—ñ—Å—Ç—å 18px */
        @media(max-width:600px){html{font-size:22px}.start-title{font-size:1.8rem}.game-title{font-size:1.3rem}.status-bar{grid-template-columns:1fr}.message{max-width:90%}.action-bar{gap: 0.5rem;}.action-btn{flex-basis: 45%;}.case-card{grid-template-columns:auto 1fr}.case-arrow{display:none}}
    </style>
</head>
<body>
    <div class="lang-switcher">
        <button class="icon-btn lang-btn active" data-lang="en">EN</button>
        <button class="icon-btn lang-btn" data-lang="ua">UA</button>
    </div>

    <div class="top-controls-left">
        <button class="icon-btn" id="mute-btn" title="Toggle Sound">üîä</button>
        <button class="icon-btn" id="back-btn" data-i18n="backBtn">‚Üê Back</button>
    </div>

    <div class="start-screen" id="start-screen">
        <div class="bg-fallback"></div>
        <div class="bg-image bg-landscape"></div>
        <div class="bg-image bg-portrait"></div>
        <div class="start-content">
            <h1 class="start-title" data-i18n="startTitle">The Interrogator</h1>
            <p class="start-tagline" data-i18n="startTagline">AI-Powered Detective Game</p>
            <p class="start-description" data-i18n="startDescription">You are a detective. Your suspect sits across the table. They will lie, deflect, and manipulate. Find the truth. Solve the case.</p>
            <div class="case-selection">
                <h2 class="case-selection-title" data-i18n="selectCase">Select Your Case</h2>
                <div class="case-cards">
                    <div class="case-card case-card--easy" data-case="easy">
                        <div class="case-difficulty case-difficulty--easy"><span class="case-difficulty-icon">‚òÖ</span><span data-i18n="diffEasy">Easy</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case1Title">The Vanished Witness</h3><p class="case-subtitle" data-i18n="case1Subtitle">A key witness disappears before trial. Her roommate claims ignorance.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                    <div class="case-card case-card--medium" data-case="medium">
                        <div class="case-difficulty case-difficulty--medium"><span class="case-difficulty-icon">‚òÖ‚òÖ</span><span data-i18n="diffMedium">Medium</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case2Title">The Vanishing Investor</h3><p class="case-subtitle" data-i18n="case2Subtitle">A tech mogul found dead. His business partner was the only one there.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                    <div class="case-card case-card--hard" data-case="hard">
                        <div class="case-difficulty case-difficulty--hard"><span class="case-difficulty-icon">‚òÖ‚òÖ‚òÖ</span><span data-i18n="diffHard">Hard</span></div>
                        <div class="case-info"><h3 class="case-title" data-i18n="case3Title">The Poisoned Heir</h3><p class="case-subtitle" data-i18n="case3Subtitle">A wealthy patriarch poisoned at his birthday. One had opportunity.</p></div>
                        <span class="case-arrow">‚Üí</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="game-screen" id="game-screen">
        <div class="bg-fallback"></div>
        <div class="bg-image bg-landscape"></div>
        <div class="bg-image bg-portrait"></div>
        
        <div class="game-container">
            <header class="game-header">
                <h1 class="game-title" id="game-title">The Interrogator</h1>
                <p class="game-subtitle" id="game-case-name">Case #001</p>
            </header>
            <div class="status-bar">
                <div class="status-item"><span class="status-label" data-i18n="energyLabel">Energy</span><div class="status-value"><span class="energy-display" id="energy-current">15</span><span class="energy-max">/ 15</span></div></div>
                <div class="status-item"><span class="status-label" data-i18n="suspicionLabel">Pressure</span><div class="suspicion-container"><div class="suspicion-bar-bg"><div class="suspicion-bar-fill" id="suspicion-bar"></div></div><span class="suspicion-value" id="suspicion-text">0%</span></div></div>
            </div>
            <div class="briefing-container">
                <button class="briefing-toggle" id="briefing-toggle"><span data-i18n="briefingToggle">üìÅ Case Briefing</span><span class="briefing-toggle-icon">‚ñº</span></button>
                <div class="briefing-content" id="briefing-content">
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="crimeTitle">The Crime</h3><p class="briefing-text" id="case-description"></p></div>
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="factsTitle">Known Facts</h3><ul class="evidence-list" id="case-evidence"></ul></div>
                    <div class="briefing-section"><h3 class="briefing-section-title" data-i18n="suspectTitle">The Suspect</h3><p class="briefing-text" id="suspect-info"></p></div>
                </div>
            </div>
            <div class="chat-container">
                <div class="chat-log" id="chat-log"></div>
                <div class="input-container">
                    <input type="text" class="chat-input" id="chat-input" data-i18n-placeholder="inputPlaceholder" placeholder="Ask..." maxlength="500">
                    <button class="send-btn" id="send-btn" data-i18n="sendBtn">Send</button>
                </div>
            </div>
            <div class="action-bar">
                <button class="action-btn action-btn--hint" id="hint-btn" data-i18n="hintBtn">üí° Hint <span class="hint-counter" id="hint-counter">(3)</span></button>
                <button class="action-btn action-btn--coffee" id="coffee-btn" data-i18n="coffeeBtn">‚òï Coffee (+5)</button>
                <button class="action-btn action-btn--accuse" id="accuse-btn" data-i18n="accuseBtn">‚öñÔ∏è Accuse</button>
                <button class="action-btn action-btn--restart" id="restart-btn" data-i18n="restartBtn">‚Ü∫ Restart</button>
                <button class="action-btn action-btn--reveal" id="reveal-btn" data-i18n="revealBtn">üîì Reveal Answer (ends game)</button>
            </div>
            <footer class="game-footer"><p class="game-footer-text">The Interrogator ‚Ä¢ v2.1</p></footer>
        </div>
    </div>
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon" id="modal-icon">üîç</div>
            <h2 class="modal-title" id="modal-title">Case Closed</h2>
            <p class="modal-text" id="modal-text"></p>
            <div class="modal-reveal"><h4 class="modal-reveal-title" data-i18n="truthTitle">The Truth</h4><p class="modal-reveal-text" id="modal-reveal-text"></p></div>
            <button class="modal-btn" id="modal-btn" data-i18n="newCaseBtn">Back</button>
        </div>
    </div>
    
    <audio id="audio-typewriter" src="p_machine.mp3" preload="auto" loop></audio>
    <audio id="audio-background" src="background.mp3" preload="auto" loop></audio>

    <script>
(function(){
'use strict';
const i18n={en:{startTitle:"The Interrogator",startTagline:"AI-Powered Detective Game",startDescription:"You are a detective. Your suspect sits across the table. They will lie, deflect, and manipulate. Use your questions wisely. Find the truth. Solve the case.",selectCase:"Select Your Case",diffEasy:"Easy",diffMedium:"Medium",diffHard:"Hard",case1Title:"The Vanished Witness",case1Subtitle:"A key witness disappears before trial. Her roommate claims ignorance.",case2Title:"The Vanishing Investor",case2Subtitle:"A tech mogul found dead. His business partner was the only one there.",case3Title:"The Poisoned Heir",case3Subtitle:"A wealthy patriarch poisoned at his birthday. One had opportunity.",backBtn:"‚Üê Back",energyLabel:"Energy",suspicionLabel:"Pressure",briefingToggle:"üìÅ Case Briefing",crimeTitle:"The Crime",factsTitle:"Known Facts",suspectTitle:"The Suspect",inputPlaceholder:"Ask your question...",sendBtn:"Send",accuseBtn:"‚öñÔ∏è Accuse",restartBtn:"‚Ü∫ Restart",truthTitle:"The Truth",newCaseBtn:"Back",calm:"Calm",nervous:"Nervous",defensive:"Defensive",breaking:"Breaking",detective:"Detective",system:"System",winTitle:"Case Solved",winText:"Your interrogation broke through. Justice will be served.",loseTitle:"Wrong Accusation",loseTextDefault:"Your accusation doesn't hold up.",loseTextWeak:"Right track, but not enough pressure to prove it.",unsolvedTitle:"Case Unsolved",unsolvedText:"Questions exhausted. Case goes cold.",hintBtn:"üí° Hint",coffeeBtn:"‚òï Coffee (+5)",revealBtn:"üîì Reveal Answer (ends game)",revealConfirm:"‚ö†Ô∏è WARNING!\n\nRevealing the answer will:\n‚Ä¢ Show you the truth\n‚Ä¢ End this game session\n‚Ä¢ You can still replay from start\n\nAre you sure? Type YES to confirm:",revealConfirmWord:"YES",hint1:"Focus on timeline inconsistencies.",hint2:"Ask about relationships and motives.",hint3:"Confront them with contradictions you found."},ua:{startTitle:"–°–ª—ñ–¥—á–∏–π",startTagline:"–î–µ—Ç–µ–∫—Ç–∏–≤–Ω–∞ –≥—Ä–∞ –Ω–∞ –±–∞–∑—ñ –®–Ü",startDescription:"–í–∏ ‚Äî –¥–µ—Ç–µ–∫—Ç–∏–≤. –ü—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–∏–π —Å–∏–¥–∏—Ç—å –Ω–∞–≤–ø—Ä–æ—Ç–∏. –í—ñ–Ω –±—É–¥–µ –±—Ä–µ—Ö–∞—Ç–∏ —Ç–∞ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è –º—É–¥—Ä–æ. –ó–Ω–∞–π–¥—ñ—Ç—å –ø—Ä–∞–≤–¥—É.",selectCase:"–û–±–µ—Ä—ñ—Ç—å —Å–ø—Ä–∞–≤—É",diffEasy:"–õ–µ–≥–∫–æ",diffMedium:"–°–µ—Ä–µ–¥–Ω—å–æ",diffHard:"–°–∫–ª–∞–¥–Ω–æ",case1Title:"–ó–Ω–∏–∫–ª–∏–π —Å–≤—ñ–¥–æ–∫",case1Subtitle:"–°–≤—ñ–¥—á–∏—Ü—è –∑–Ω–∏–∫–∞—î –ø–µ—Ä–µ–¥ —Å—É–¥–æ–º. –°—É—Å—ñ–¥–∫–∞ –Ω—ñ–±–∏—Ç–æ –Ω—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞—î.",case2Title:"–ó–Ω–∏–∫–ª–∏–π —ñ–Ω–≤–µ—Å—Ç–æ—Ä",case2Subtitle:"–ú–∞–≥–Ω–∞—Ç–∞ –∑–Ω–∞–π–¥–µ–Ω–æ –º–µ—Ä—Ç–≤–∏–º. –ü–∞—Ä—Ç–Ω–µ—Ä–∫–∞ –±—É–ª–∞ —î–¥–∏–Ω–æ—é –ø–æ—Ä—É—á.",case3Title:"–û—Ç—Ä—É—î–Ω–∏–π —Å–ø–∞–¥–∫–æ—î–º–µ—Ü—å",case3Subtitle:"–ü–∞—Ç—Ä—ñ–∞—Ä—Ö–∞ –æ—Ç—Ä—É—î–Ω–æ –Ω–∞ –¥–Ω—ñ –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è. –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –±—É–ª–∞ –≤ –æ–¥–Ω–æ–≥–æ.",backBtn:"‚Üê –ù–∞–∑–∞–¥",energyLabel:"–ï–Ω–µ—Ä–≥—ñ—è",suspicionLabel:"–¢–∏—Å–∫",briefingToggle:"üìÅ –ú–∞—Ç–µ—Ä—ñ–∞–ª–∏ —Å–ø—Ä–∞–≤–∏",crimeTitle:"–ó–ª–æ—á–∏–Ω",factsTitle:"–í—ñ–¥–æ–º—ñ —Ñ–∞–∫—Ç–∏",suspectTitle:"–ü—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–∏–π",inputPlaceholder:"–ó–∞–¥–∞–π—Ç–µ –ø–∏—Ç–∞–Ω–Ω—è...",sendBtn:"–ù–∞–¥—ñ—Å–ª–∞—Ç–∏",accuseBtn:"‚öñÔ∏è –ó–≤–∏–Ω—É–≤–∞—Ç–∏—Ç–∏",restartBtn:"‚Ü∫ –°–ø–æ—á–∞—Ç–∫—É",truthTitle:"–ü—Ä–∞–≤–¥–∞",newCaseBtn:"–ù–∞–∑–∞–¥",calm:"–°–ø–æ–∫—ñ–π–Ω–∏–π",nervous:"–ù–µ—Ä–≤—É—î",defensive:"–ó–∞—Ö–∏—â–∞—î—Ç—å—Å—è",breaking:"–õ–∞–º–∞—î—Ç—å—Å—è",detective:"–î–µ—Ç–µ–∫—Ç–∏–≤",system:"–°–∏—Å—Ç–µ–º–∞",winTitle:"–°–ø—Ä–∞–≤—É —Ä–æ–∑–∫—Ä–∏—Ç–æ",winText:"–í–∞—à –¥–æ–ø–∏—Ç –∑–ª–∞–º–∞–≤ –∑–∞—Ö–∏—Å—Ç. –°–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ñ—Å—Ç—å –≤–æ—Å—Ç–æ—Ä–∂–µ—Å—Ç–≤—É—î.",loseTitle:"–ü–æ–º–∏–ª–∫–æ–≤–µ –∑–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è",loseTextDefault:"–ó–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è –Ω–µ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—î—Ç—å—Å—è.",loseTextWeak:"–ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —à–ª—è—Ö, –∞–ª–µ —Ç–∏—Å–∫—É –Ω–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ.",unsolvedTitle:"–ù–µ —Ä–æ–∑–∫—Ä–∏—Ç–æ",unsolvedText:"–ü–∏—Ç–∞–Ω–Ω—è –≤–∏—á–µ—Ä–ø–∞–Ω–æ. –°–ø—Ä–∞–≤–∞ —É –≥–ª—É—Ö–æ–º—É –∫—É—Ç—ñ.",hintBtn:"üí° –ü—ñ–¥–∫–∞–∑–∫–∞",coffeeBtn:"‚òï –ö–∞–≤–∞ (+5)",revealBtn:"üîì –†–æ–∑–∫—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å (–∫—ñ–Ω–µ—Ü—å –≥—Ä–∏)",revealConfirm:"‚ö†Ô∏è –£–í–ê–ì–ê!\n\n–†–æ–∑–∫—Ä–∏—Ç—Ç—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:\n‚Ä¢ –ü–æ–∫–∞–∂–µ –≤–∞–º –ø—Ä–∞–≤–¥—É\n‚Ä¢ –ó–∞–∫—ñ–Ω—á–∏—Ç—å —Ü—é —Å–µ—Å—ñ—é –≥—Ä–∏\n‚Ä¢ –í–∏ –∑–º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏ –≥—Ä—É\n\n–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ? –í–≤–µ–¥—ñ—Ç—å –¢–ê–ö –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:",revealConfirmWord:"–¢–ê–ö",hint1:"–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É –Ω–∞ –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ –≤ —á–∞—Å—ñ.",hint2:"–ü–∏—Ç–∞–π—Ç–µ –ø—Ä–æ —Å—Ç–æ—Å—É–Ω–∫–∏ —Ç–∞ –º–æ—Ç–∏–≤–∏.",hint3:"–í–∫–∞–∂—ñ—Ç—å –Ω–∞ —Å—É–ø–µ—Ä–µ—á–Ω–æ—Å—Ç—ñ, —è–∫—ñ –∑–Ω–∞–π—à–ª–∏."}};

const CASES={
easy:{id:"easy",caseNumber:"#001",winThreshold:40,
en:{title:"The Vanished Witness",suspectName:"Diana Mercer",
crimeDescription:"Sarah Chen, a key witness in a corporate fraud trial, vanished from her apartment two days before testifying. Her roommate Diana claims Sarah left for work and never returned. Sarah's phone was found in a dumpster behind the building.",
knownFacts:[
    "Sarah disappeared Monday morning, March 3rd.",
    "Diana claims Sarah left at 8:15 AM sharp.",
    "Neighbors heard arguing around 7:30 AM.",
    "Sarah never arrived at her office (usually takes 20 mins).",
    "Diana reported her missing Tuesday evening (36h delay).",
    "Sarah was testifying against her employer, 'Apex Corp'.",
    "Diana's bank account shows a $5,000 cash deposit on Tuesday."
],
suspectProfile:"Diana Mercer, 29, paralegal at the same firm Sarah was testifying against. Known to have financial troubles. Claims she didn't know about Sarah's testimony. Appears nervous but cooperative.",
truthReveal:"Diana was paid $50,000 to help make Sarah 'disappear.' She drugged Sarah's coffee, accomplices took her. The $5k was an advance. Diana waited 36 hours to report it to give them a head start.",
sessionStart:"Interrogation of Diana Mercer ‚Äî Session #1.",
npcGreeting:"*fidgeting with a napkin* Detective, I've been so worried about Sarah. Is there any news? I still can't believe she's gone.",
accusationPrompt:"Accusation:\n1. Diana helped kidnap Sarah\n2. Sarah ran away\n3. Someone else did it\n4. Diana is innocent\n\nEnter 1-4:",
wrongAccusations:{"2":"Sarah had no reason to run.","3":"Evidence points to someone with inside access.","4":"The delay and firm connection are too suspicious."}},
ua:{title:"–ó–Ω–∏–∫–ª–∏–π —Å–≤—ñ–¥–æ–∫",suspectName:"–î—ñ–∞–Ω–∞ –ú–µ—Ä—Å–µ—Ä",
crimeDescription:"–°–∞—Ä–∞ –ß–µ–Ω, –∫–ª—é—á–æ–≤–∞ —Å–≤—ñ–¥—á–∏—Ü—è —É —Å–ø—Ä–∞–≤—ñ –ø—Ä–æ —à–∞—Ö—Ä–∞–π—Å—Ç–≤–æ, –∑–Ω–∏–∫–ª–∞ –∑–∞ –¥–≤–∞ –¥–Ω—ñ –¥–æ —Å–≤—ñ–¥—á–µ–Ω—å. –°—É—Å—ñ–¥–∫–∞ –î—ñ–∞–Ω–∞ —Å—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ –°–∞—Ä–∞ –ø—ñ—à–ª–∞ –Ω–∞ —Ä–æ–±–æ—Ç—É —ñ –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–ª–∞—Å—è. –¢–µ–ª–µ—Ñ–æ–Ω –∑–Ω–∞–π—à–ª–∏ –≤ —Å–º—ñ—Ç–Ω–∏–∫—É.",
knownFacts:[
    "–°–∞—Ä–∞ –∑–Ω–∏–∫–ª–∞ –≤ –ø–æ–Ω–µ–¥—ñ–ª–æ–∫, 3 –±–µ—Ä–µ–∑–Ω—è.",
    "–î—ñ–∞–Ω–∞ –∫–∞–∂–µ, –°–∞—Ä–∞ –ø—ñ—à–ª–∞ –æ 8:15 —Ä—ñ–≤–Ω–æ.",
    "–°—É—Å—ñ–¥–∏ —á—É–ª–∏ —Å–≤–∞—Ä–∫—É –±–ª–∏–∑—å–∫–æ 7:30 —Ä–∞–Ω–∫—É.",
    "–°–∞—Ä–∞ –Ω–µ –∑‚Äô—è–≤–∏–ª–∞—Å—è –≤ –æ—Ñ—ñ—Å—ñ (–¥–æ—Ä–æ–≥–∞ –∑–∞–π–º–∞—î 20 —Ö–≤).",
    "–î—ñ–∞–Ω–∞ –ø–æ–≤—ñ–¥–æ–º–∏–ª–∞ –ø—Ä–æ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è –ª–∏—à–µ —É –≤—ñ–≤—Ç–æ—Ä–æ–∫ –≤–≤–µ—á–µ—Ä—ñ.",
    "–°–∞—Ä–∞ –º–∞–ª–∞ —Å–≤—ñ–¥—á–∏—Ç–∏ –ø—Ä–æ—Ç–∏ —Ä–æ–±–æ—Ç–æ–¥–∞–≤—Ü—è 'Apex Corp'.",
    "–ù–∞ —Ä–∞—Ö—É–Ω–æ–∫ –î—ñ–∞–Ω–∏ –≤–Ω–µ—Å–µ–Ω–æ $5,000 –≥–æ—Ç—ñ–≤–∫–æ—é —É –≤—ñ–≤—Ç–æ—Ä–æ–∫."
],
suspectProfile:"–î—ñ–∞–Ω–∞ –ú–µ—Ä—Å–µ—Ä, 29, –ø—Ä–∞—Ü—é—î –≤ —Ç—ñ–π —Å–∞–º—ñ–π —Ñ—ñ—Ä–º—ñ. –í—ñ–¥–æ–º–æ –ø—Ä–æ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤—ñ –ø—Ä–æ–±–ª–µ–º–∏. –°—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ –Ω–µ –∑–Ω–∞–ª–∞ –ø—Ä–æ —Å–≤—ñ–¥—á–µ–Ω–Ω—è. –ù–µ—Ä–≤–æ–≤–∞, –∞–ª–µ –≥–æ—Ç–æ–≤–∞ —Å–ø—ñ–≤–ø—Ä–∞—Ü—é–≤–∞—Ç–∏.",
truthReveal:"–î—ñ–∞–Ω—ñ –∑–∞–ø–ª–∞—Ç–∏–ª–∏ $50,000. –í–æ–Ω–∞ –ø—ñ–¥—Å–∏–ø–∞–ª–∞ —Å–Ω–æ–¥—ñ–π–Ω–µ, —Å–ø—ñ–ª—å–Ω–∏–∫–∏ –∑–∞–±—Ä–∞–ª–∏ –°–∞—Ä—É. $5k ‚Äî —Ü–µ –∞–≤–∞–Ω—Å. –ß–µ–∫–∞–ª–∞ 36 –≥–æ–¥–∏–Ω, —â–æ–± –¥–∞—Ç–∏ —ó–º —á–∞—Å.",
sessionStart:"–î–æ–ø–∏—Ç –î—ñ–∞–Ω–∏ –ú–µ—Ä—Å–µ—Ä ‚Äî –°–µ—Å—ñ—è #1.",
npcGreeting:"*–∫—Ä—É—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ç–∫—É –≤ —Ä—É–∫–∞—Ö* –î–µ—Ç–µ–∫—Ç–∏–≤–µ, —è —Ç–∞–∫ —Ö–≤–∏–ª—é—é—Å—è –∑–∞ –°–∞—Ä—É. –Ñ –Ω–æ–≤–∏–Ω–∏? –î–æ—Å—ñ –Ω–µ –≤—ñ—Ä—é, —â–æ —Ü–µ —Å—Ç–∞–ª–æ—Å—å.",
accusationPrompt:"–ó–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è:\n1. –î—ñ–∞–Ω–∞ –¥–æ–ø–æ–º–æ–≥–ª–∞ –≤–∏–∫—Ä–∞—Å—Ç–∏\n2. –°–∞—Ä–∞ –≤—Ç–µ–∫–ª–∞ —Å–∞–º–∞\n3. –•—Ç–æ—Å—å —ñ–Ω—à–∏–π\n4. –î—ñ–∞–Ω–∞ –Ω–µ–≤–∏–Ω–Ω–∞\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
wrongAccusations:{"2":"–°–∞—Ä–∞ –Ω–µ –º–∞–ª–∞ –ø—Ä–∏—á–∏–Ω —Ç—ñ–∫–∞—Ç–∏.","3":"–î–æ–∫–∞–∑–∏ –≤–∫–∞–∑—É—é—Ç—å –Ω–∞ –∫–æ–≥–æ—Å—å –∑—Å–µ—Ä–µ–¥–∏–Ω–∏.","4":"–ó–∞—Ç—Ä–∏–º–∫–∞ —ñ –∑–≤‚Äô—è–∑–æ–∫ –∑ —Ñ—ñ—Ä–º–æ—é –ø—ñ–¥–æ–∑—Ä—ñ–ª—ñ."}},
suspicionTriggers:{high:['money','paid','$50','drug','coffee','testimony','boyfriend','groceries','deposit','–≥—Ä–æ—à—ñ','–∑–∞–ø–ª–∞—Ç–∏–ª–∏','—Å–Ω–æ–¥—ñ–π–Ω–µ','–∫–∞–≤–∞','—Å–≤—ñ–¥—á–µ–Ω–Ω—è','–¥–µ–ø–æ–∑–∏—Ç'],medium:['wait','delay','36 hours','tuesday','why','argue','shout','—á–µ–∫–∞–ª–∞','–∑–∞—Ç—Ä–∏–º–∫–∞','–≤—ñ–≤—Ç–æ—Ä–æ–∫','—á–æ–º—É','—Å–≤–∞—Ä–∫–∞','–∫—Ä–∏–∫'],low:['morning','work','phone','—Ä–∞–Ω–æ–∫','—Ä–æ–±–æ—Ç–∞','—Ç–µ–ª–µ—Ñ–æ–Ω']}},

medium:{id:"medium",caseNumber:"#002",winThreshold:50,
en:{title:"The Vanishing Investor",suspectName:"Victoria Ashford",
crimeDescription:"Tech investor Marcus Webb was found dead in his penthouse. Gunshot wound to the head. His business partner Victoria Ashford was the only one in the building. $2.3 million was transferred from company accounts minutes before his death.",
knownFacts:[
    "Marcus died between 10:00-10:30 PM.",
    "Victoria arrived at 9:45 PM. No other entries logged.",
    "Security cameras in the hallway were 'malfunctioning' for 15 mins.",
    "Marcus's laptop was wiped remotely at 10:15 PM.",
    "Gun registered to Marcus found at scene (no prints).",
    "$2.3M transfer authorized by Victoria's keycard.",
    "Victoria claims she was in the downstairs conference room."
],
suspectProfile:"Victoria Ashford, 42, co-founder. Built the company with Marcus for 15 years. Rumors of a falling out over strategy. Claims she cannot remember details due to shock.",
truthReveal:"Victoria murdered Marcus to prevent him exposing her embezzlement and affair with his wife. She jammed the cameras, wiped the laptop, and staged the suicide.",
sessionStart:"Interrogation of Victoria Ashford ‚Äî Session #1.",
npcGreeting:"*hands folded tightly* Detective. I want to help find out what happened to Marcus. We were... close partners.",
accusationPrompt:"Accusation:\n1. Victoria murdered Marcus\n2. Suicide\n3. James Chen did it\n4. Marcus's brother\n\nEnter 1-4:",
wrongAccusations:{"2":"Scene was staged. Angles don't match suicide.","3":"James has alibi ‚Äî 50 witnesses at a gala.","4":"Brother was in another country."}},
ua:{title:"–ó–Ω–∏–∫–ª–∏–π —ñ–Ω–≤–µ—Å—Ç–æ—Ä",suspectName:"–í—ñ–∫—Ç–æ—Ä—ñ—è –ê—à—Ñ–æ—Ä–¥",
crimeDescription:"–Ü–Ω–≤–µ—Å—Ç–æ—Ä–∞ –ú–∞—Ä–∫—É—Å–∞ –í–µ–±–±–∞ –∑–Ω–∞–π–¥–µ–Ω–æ –º–µ—Ä—Ç–≤–∏–º —É –ø–µ–Ω—Ç—Ö–∞—É—Å—ñ. –ü–æ—Å—Ç—Ä—ñ–ª —É –≥–æ–ª–æ–≤—É. –ü–∞—Ä—Ç–Ω–µ—Ä–∫–∞ –í—ñ–∫—Ç–æ—Ä—ñ—è –±—É–ª–∞ —î–¥–∏–Ω–æ—é –≤ –±—É–¥—ñ–≤–ª—ñ. $2.3 –º–ª–Ω –ø–µ—Ä–µ–∫–∞–∑–∞–Ω–æ –¥–æ —Å–º–µ—Ä—Ç—ñ.",
knownFacts:[
    "–ú–∞—Ä–∫—É—Å –ø–æ–º–µ—Ä –º—ñ–∂ 22:00-22:30.",
    "–í—ñ–∫—Ç–æ—Ä—ñ—è –ø—Ä–∏–±—É–ª–∞ –æ 21:45. –Ü–Ω—à–∏—Ö –≤—Ö–æ–¥—ñ–≤ –Ω–µ –∑–∞—Ñ—ñ–∫—Å–æ–≤–∞–Ω–æ.",
    "–ö–∞–º–µ—Ä–∏ –≤ –∫–æ—Ä–∏–¥–æ—Ä—ñ '–Ω–µ –ø—Ä–∞—Ü—é–≤–∞–ª–∏' 15 —Ö–≤–∏–ª–∏–Ω.",
    "–ù–æ—É—Ç–±—É–∫ –ú–∞—Ä–∫—É—Å–∞ –¥–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–æ –æ—á–∏—â–µ–Ω–æ –æ 22:15.",
    "–ü—ñ—Å—Ç–æ–ª–µ—Ç –ú–∞—Ä–∫—É—Å–∞ –Ω–∞ –º—ñ—Å—Ü—ñ (–±–µ–∑ –≤—ñ–¥–±–∏—Ç–∫—ñ–≤).",
    "–ü–µ—Ä–µ–∫–∞–∑ $2.3 –º–ª–Ω –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–æ –∫–∞—Ä—Ç–∫–æ—é –í—ñ–∫—Ç–æ—Ä—ñ—ó.",
    "–í—ñ–∫—Ç–æ—Ä—ñ—è –∫–∞–∂–µ, —â–æ –±—É–ª–∞ –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª—ñ –≤–Ω–∏–∑—É."
],
suspectProfile:"–í—ñ–∫—Ç–æ—Ä—ñ—è –ê—à—Ñ–æ—Ä–¥, 42, —Å–ø—ñ–≤–∑–∞—Å–Ω–æ–≤–Ω–∏—Ü—è. 15 —Ä–æ–∫—ñ–≤ –±—É–¥—É–≤–∞–ª–∏ –∫–æ–º–ø–∞–Ω—ñ—é. –ß—É—Ç–∫–∏ –ø—Ä–æ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç —á–µ—Ä–µ–∑ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—é. –ö–∞–∂–µ, –Ω–µ –ø–∞–º‚Äô—è—Ç–∞—î –¥–µ—Ç–∞–ª–µ–π —á–µ—Ä–µ–∑ —à–æ–∫.",
truthReveal:"–í—ñ–∫—Ç–æ—Ä—ñ—è –≤–±–∏–ª–∞ –ú–∞—Ä–∫—É—Å–∞, —â–æ–± –ø—Ä–∏—Ö–æ–≤–∞—Ç–∏ —Ä–æ–∑–∫—Ä–∞–¥–∞–Ω–Ω—è —Ç–∞ —Ä–æ–º–∞–Ω –∑ –π–æ–≥–æ –¥—Ä—É–∂–∏–Ω–æ—é. –í–æ–Ω–∞ –≤—ñ–¥–∫–ª—é—á–∏–ª–∞ –∫–∞–º–µ—Ä–∏ —ñ —ñ–Ω—Å—Ü–µ–Ω—É–≤–∞–ª–∞ —Å–∞–º–æ–≥—É–±—Å—Ç–≤–æ.",
sessionStart:"–î–æ–ø–∏—Ç –í—ñ–∫—Ç–æ—Ä—ñ—ó –ê—à—Ñ–æ—Ä–¥ ‚Äî –°–µ—Å—ñ—è #1.",
npcGreeting:"*–º—ñ—Ü–Ω–æ —Å–∫–ª–∞–≤—à–∏ —Ä—É–∫–∏* –î–µ—Ç–µ–∫—Ç–∏–≤–µ. –•–æ—á—É –¥–æ–ø–æ–º–æ–≥—Ç–∏ –∑‚Äô—è—Å—É–≤–∞—Ç–∏, —â–æ —Å—Ç–∞–ª–æ—Å—è. –ú–∏ –±—É–ª–∏... –±–ª–∏–∑—å–∫–∏–º–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏.",
accusationPrompt:"–ó–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è:\n1. –í—ñ–∫—Ç–æ—Ä—ñ—è –≤–±–∏–ª–∞ –ú–∞—Ä–∫—É—Å–∞\n2. –°–∞–º–æ–≥—É–±—Å—Ç–≤–æ\n3. –î–∂–µ–π–º—Å –ß–µ–Ω\n4. –ë—Ä–∞—Ç –ú–∞—Ä–∫—É—Å–∞\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
wrongAccusations:{"2":"–°—Ü–µ–Ω—É –ø—ñ–¥–ª–∞—à—Ç–æ–≤–∞–Ω–æ. –ö—É—Ç–∏ –Ω–µ —Å—Ö–æ–¥—è—Ç—å—Å—è.","3":"–î–∂–µ–π–º—Å –º–∞—î –∞–ª—ñ–±—ñ ‚Äî 50 —Å–≤—ñ–¥–∫—ñ–≤.","4":"–ë—Ä–∞—Ç –±—É–≤ –≤ —ñ–Ω—à—ñ–π –∫—Ä–∞—ó–Ω—ñ."}},
suspicionTriggers:{high:['affair','elena','wife','transfer','money','laptop','wipe','camera','security','malfunction','—Ä–æ–º–∞–Ω','–æ–ª–µ–Ω–∞','–¥—Ä—É–∂–∏–Ω–∞','–ø–µ—Ä–µ–∫–∞–∑','–≥—Ä–æ—à—ñ','–Ω–æ—É—Ç–±—É–∫','–æ—á–∏—Å—Ç–∏–ª–∞','–∫–∞–º–µ—Ä–∞','–æ—Ö–æ—Ä–æ–Ω–∞'],medium:['timeline','exactly','contradiction','lying','keycard','—Ö—Ä–æ–Ω–æ–ª–æ–≥—ñ—è','—Ç–æ—á–Ω–æ','—Å—É–ø–µ—Ä–µ—á–Ω—ñ—Å—Ç—å','–±—Ä–µ—Ö–Ω—è','–∫–∞—Ä—Ç–∫–∞'],low:['where were you','relationship','–¥–µ –≤–∏ –±—É–ª–∏','—Å—Ç–æ—Å—É–Ω–∫–∏']}},

hard:{id:"hard",caseNumber:"#003",winThreshold:60,
en:{title:"The Poisoned Heir",suspectName:"Dr. Eleanor Blackwood",
crimeDescription:"Harold Blackwood, 78, collapsed at his anniversary party. Tetrodotoxin in his champagne. His daughter-in-law Dr. Eleanor served the glass. Harold had just announced he was cutting her husband Richard from the will due to $4M gambling debts.",
knownFacts:[
    "Harold died at 9:47 PM. Symptoms started at 9:35 PM.",
    "Tetrodotoxin found only in Harold's glass (fatal dose).",
    "Eleanor handed him the glass at 9:30 PM.",
    "Eleanor has access to exotic toxins at her lab.",
    "Richard owes $4M to 'The Vipers' (loan sharks).",
    "A syringe cap was found in the kitchen trash.",
    "Eleanor was seen near the wine cellar alone."
],
suspectProfile:"Dr. Eleanor Blackwood, 38, toxicologist. Married Richard 8 years ago. Colleagues describe her as brilliant but cold. Claims she's being framed because of her profession.",
truthReveal:"Eleanor poisoned Harold to save Richard. The loan sharks gave a deadline: pay $4M or Richard dies. Inheritance was the only way. She did it out of desperate love.",
sessionStart:"Interrogation of Dr. Eleanor Blackwood ‚Äî Session #1.",
npcGreeting:"*perfectly still, direct eye contact* Detective. My expertise makes me the obvious suspect. But obvious doesn't mean guilty. I loved Harold.",
accusationPrompt:"Accusation:\n1. Eleanor poisoned to save Richard\n2. Eleanor did it for greed\n3. Richard did it himself\n4. Loan shark infiltrated\n\nEnter 1-4:",
wrongAccusations:{"2":"Eleanor has her own career. She needed to save Richard's life, not get rich.","3":"Richard was across the room. Multiple witnesses.","4":"No unauthorized persons. Poison was in the specific glass."}},
ua:{title:"–û—Ç—Ä—É—î–Ω–∏–π —Å–ø–∞–¥–∫–æ—î–º–µ—Ü—å",suspectName:"–î—Ä. –ï–ª–µ–æ–Ω–æ—Ä–∞ –ë–ª–µ–∫–≤—É–¥",
crimeDescription:"–ì–∞—Ä–æ–ª—å–¥ –ë–ª–µ–∫–≤—É–¥, 78, –∑–Ω–µ–ø—Ä–∏—Ç–æ–º–Ω—ñ–≤ –Ω–∞ —é–≤—ñ–ª–µ—ó. –¢–µ—Ç—Ä–æ–¥–æ—Ç–æ–∫—Å–∏–Ω —É —à–∞–º–ø–∞–Ω—Å—å–∫–æ–º—É. –ù–µ–≤—ñ—Å—Ç–∫–∞ –¥—Ä. –ï–ª–µ–æ–Ω–æ—Ä–∞ –ø–æ–¥–∞–ª–∞ –∫–µ–ª–∏—Ö. –ì–∞—Ä–æ–ª—å–¥ –æ–≥–æ–ª–æ—Å–∏–≤ –ø—Ä–æ –ø–æ–∑–±–∞–≤–ª–µ–Ω–Ω—è —Å–ø–∞–¥–∫—É —ó—ó —á–æ–ª–æ–≤—ñ–∫–∞ –†—ñ—á–∞—Ä–¥–∞ —á–µ—Ä–µ–∑ –±–æ—Ä–≥–∏.",
knownFacts:[
    "–ì–∞—Ä–æ–ª—å–¥ –ø–æ–º–µ—Ä –æ 21:47. –°–∏–º–ø—Ç–æ–º–∏ –ø–æ—á–∞–ª–∏—Å—è –æ 21:35.",
    "–¢–µ—Ç—Ä–æ–¥–æ—Ç–æ–∫—Å–∏–Ω –ª–∏—à–µ –≤ –π–æ–≥–æ –∫–µ–ª–∏—Ö—É.",
    "–ï–ª–µ–æ–Ω–æ—Ä–∞ –ø–æ–¥–∞–ª–∞ –∫–µ–ª–∏—Ö –æ 21:30.",
    "–ï–ª–µ–æ–Ω–æ—Ä–∞ –º–∞—î –¥–æ—Å—Ç—É–ø –¥–æ —Ç–æ–∫—Å–∏–Ω—ñ–≤ —É –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó.",
    "–†—ñ—á–∞—Ä–¥ –≤–∏–Ω–µ–Ω $4 –º–ª–Ω –±–∞–Ω–¥—ñ '–í–∞–π–ø–µ—Ä—Å'.",
    "–ö–æ–≤–ø–∞—á–æ–∫ –≤—ñ–¥ —à–ø—Ä–∏—Ü–∞ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ –∫—É—Ö–Ω—ñ.",
    "–ï–ª–µ–æ–Ω–æ—Ä—É –±–∞—á–∏–ª–∏ –±—ñ–ª—è –≤–∏–Ω–Ω–æ–≥–æ –ª—å–æ—Ö—É —Å–∞–º—É."
],
suspectProfile:"–î—Ä. –ï–ª–µ–æ–Ω–æ—Ä–∞ –ë–ª–µ–∫–≤—É–¥, 38, —Ç–æ–∫—Å–∏–∫–æ–ª–æ–≥–∏–Ω—è. 8 —Ä–æ–∫—ñ–≤ —É —à–ª—é–±—ñ. –ö–æ–ª–µ–≥–∏ –∫–∞–∂—É—Ç—å ‚Äî –≥–µ–Ω—ñ–∞–ª—å–Ω–∞, –∞–ª–µ —Ö–æ–ª–æ–¥–Ω–∞. –°—Ç–≤–µ—Ä–¥–∂—É—î, —â–æ —ó—ó –ø—ñ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å.",
truthReveal:"–ï–ª–µ–æ–Ω–æ—Ä–∞ –æ—Ç—Ä—É—ó–ª–∞ –ì–∞—Ä–æ–ª—å–¥–∞, —â–æ–± –≤—Ä—è—Ç—É–≤–∞—Ç–∏ –†—ñ—á–∞—Ä–¥–∞. –õ–∏—Ö–≤–∞—Ä—ñ –¥–∞–ª–∏ —Ç–µ—Ä–º—ñ–Ω: –≥—Ä–æ—à—ñ –∞–±–æ —Å–º–µ—Ä—Ç—å —á–æ–ª–æ–≤—ñ–∫–∞. –°–ø–∞–¥—â–∏–Ω–∞ –±—É–ª–∞ —î–¥–∏–Ω–∏–º –≤–∏—Ö–æ–¥–æ–º.",
sessionStart:"–î–æ–ø–∏—Ç –¥—Ä. –ï–ª–µ–æ–Ω–æ—Ä–∏ –ë–ª–µ–∫–≤—É–¥ ‚Äî –°–µ—Å—ñ—è #1.",
npcGreeting:"*–Ω–µ—Ä—É—Ö–æ–º–æ, –ø—Ä—è–º–∏–π –ø–æ–≥–ª—è–¥* –î–µ—Ç–µ–∫—Ç–∏–≤–µ. –ú–æ—è –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∞ —Ä–æ–±–∏—Ç—å –º–µ–Ω–µ –æ—á–µ–≤–∏–¥–Ω–æ—é –ø—ñ–¥–æ–∑—Ä—é–≤–∞–Ω–æ—é. –ê–ª–µ –æ—á–µ–≤–∏–¥–Ω–µ –Ω–µ –æ–∑–Ω–∞—á–∞—î –≤–∏–Ω–Ω–µ.",
accusationPrompt:"–ó–≤–∏–Ω—É–≤–∞—á–µ–Ω–Ω—è:\n1. –ï–ª–µ–æ–Ω–æ—Ä–∞ –æ—Ç—Ä—É—ó–ª–∞, —â–æ–± –≤—Ä—è—Ç—É–≤–∞—Ç–∏ –†—ñ—á–∞—Ä–¥–∞\n2. –ó–∞—Ä–∞–¥–∏ –∂–∞–¥—ñ–±–Ω–æ—Å—Ç—ñ\n3. –†—ñ—á–∞—Ä–¥ —Å–∞–º\n4. –õ–∏—Ö–≤–∞—Ä –ø—Ä–æ–Ω–∏–∫\n\n–í–≤–µ–¥—ñ—Ç—å 1-4:",
wrongAccusations:{"2":"–ï–ª–µ–æ–Ω–æ—Ä–∞ –º–∞—î –∫–∞—Ä‚Äô—î—Ä—É. –á–π —Ç—Ä–µ–±–∞ –±—É–ª–æ –≤—Ä—è—Ç—É–≤–∞—Ç–∏ –∂–∏—Ç—Ç—è –†—ñ—á–∞—Ä–¥–∞.","3":"–†—ñ—á–∞—Ä–¥ –±—É–≤ –¥–∞–ª–µ–∫–æ. –°–≤—ñ–¥–∫–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂—É—é—Ç—å.","4":"–°—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –Ω–µ –±—É–ª–æ. –û—Ç—Ä—É—Ç–∞ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–µ–ª–∏—Ö—É."}},
suspicionTriggers:{high:['loan shark','threat','kill richard','cork','syringe','save richard','love','vipers','–ª–∏—Ö–≤–∞—Ä—ñ','–ø–æ–≥—Ä–æ–∑–∞','–≤–±–∏—Ç–∏','–∫–æ—Ä–æ–∫','—à–ø—Ä–∏—Ü','–≤—Ä—è—Ç—É–≤–∞—Ç–∏','–ª—é–±–æ–≤','–≤–∞–π–ø–µ—Ä—Å'],medium:['tetrodotoxin','access','lab','bottle','cellar','trash','—Ç–µ—Ç—Ä–æ–¥–æ—Ç–æ–∫—Å–∏–Ω','–¥–æ—Å—Ç—É–ø','–ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è','–ø–ª—è—à–∫–∞','–ª—å–æ—Ö—É','—Å–º—ñ—Ç—Ç—è'],low:['glass','champagne','will','–∫–µ–ª–∏—Ö','—à–∞–º–ø–∞–Ω—Å—å–∫–µ','–∑–∞–ø–æ–≤—ñ—Ç']}}
};

const NPC_PROMPTS={
easy:{en:`You are Diana Mercer, 29, paralegal interrogated about roommate Sarah Chen's disappearance. SECRET TRUTH: You were paid $50,000 to help kidnap Sarah. You drugged her coffee. Accomplices took her. You waited 36 hours to report. The $5k deposit was an advance. COVER: Sarah left for work normally. You reported when worried. You know nothing about testimony. RULES: Stay in character. You're nervous, not hardened. Slip up occasionally. Get flustered when caught lying about the money or time. Struggle to explain the 36-hour delay. STATES: CALM(0-20):worried act. NERVOUS(21-40):fidgeting. DEFENSIVE(41-60):upset. BREAKING(61+):tears,contradictions. Max 120 words. Never say "As an AI". ENGLISH ONLY. State:{{EMOTIONAL_STATE}} Suspicion:{{SUSPICION_LEVEL}}%`,
ua:`–¢–∏ –î—ñ–∞–Ω–∞ –ú–µ—Ä—Å–µ—Ä, 29, –¥–æ–ø–∏—Ç –ø—Ä–æ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è —Å—É—Å—ñ–¥–∫–∏ –°–∞—Ä–∏. –ü–†–ê–í–î–ê: –¢–æ–±—ñ –∑–∞–ø–ª–∞—Ç–∏–ª–∏ $50,000. –ü—ñ–¥—Å–∏–ø–∞–ª–∞ —Å–Ω–æ–¥—ñ–π–Ω–µ. –°–ø—ñ–ª—å–Ω–∏–∫–∏ –∑–∞–±—Ä–∞–ª–∏. –ß–µ–∫–∞–ª–∞ 36 –≥–æ–¥–∏–Ω. $5000 –Ω–∞ —Ä–∞—Ö—É–Ω–∫—É - —Ü–µ –∞–≤–∞–Ω—Å. –õ–ï–ì–ï–ù–î–ê: –°–∞—Ä–∞ –ø—ñ—à–ª–∞ –Ω–∞ —Ä–æ–±–æ—Ç—É. –ü–æ–≤—ñ–¥–æ–º–∏–ª–∞ –∫–æ–ª–∏ –∑–∞–Ω–µ–ø–æ–∫–æ—ó–ª–∞—Å—å. –ù—ñ—á–æ–≥–æ –Ω–µ –∑–Ω–∞—î—à –ø—Ä–æ —Å–≤—ñ–¥—á–µ–Ω–Ω—è. –ü–†–ê–í–ò–õ–ê: –í –æ–±—Ä–∞–∑—ñ. –ù–µ—Ä–≤–æ–≤–∞. –Ü–Ω–æ–¥—ñ –æ–±–º–æ–≤–ª—è–π—Å—è. –í–∞–∂–∫–æ –ø–æ—è—Å–Ω–∏—Ç–∏ –∑–∞—Ç—Ä–∏–º–∫—É —ñ –≥—Ä–æ—à—ñ. –°–¢–ê–ù–ò: –°–ü–û–ö–Ü–ô–ù–ê(0-20):—Å—Ç—É—Ä–±–æ–≤–∞–Ω–∞. –ù–ï–†–í–û–í–ê(21-40):–º–µ—Ç—É—à–∏—Ç—å—Å—è. –ó–ê–•–ò–°–ù–ê(41-60):–∑–∞—Å–º—É—á–µ–Ω–∞. –õ–ê–ú–ê–Ñ–¢–¨–°–Ø(61+):—Å–ª—å–æ–∑–∏. –ú–∞–∫—Å 120 —Å–ª—ñ–≤. –ù–µ –∫–∞–∂–∏ "–Ø–∫ –®–Ü". –¢–Ü–õ–¨–ö–ò –£–ö–†–ê–á–ù–°–¨–ö–û–Æ. –°—Ç–∞–Ω:{{EMOTIONAL_STATE}} –ü—ñ–¥–æ–∑—Ä–∞:{{SUSPICION_LEVEL}}%`},
medium:{en:`You are Victoria Ashford, 42, businesswoman interrogated about partner Marcus Webb's death. SECRET: You killed Marcus. Affair with his wife Elena. He discovered, threatened exposure. You transferred $2.3M. Wiped laptop. Staged suicide. Waited 15 min before 911. COVER: Conference room downstairs. Heard shot 10:15. Found him dead. Called 911 immediately. Good relationship. Know nothing about transfer. RULES: Stay in character. Never admit unless cornered. Lie about affair,money,laptop,timeline. Deflect to James Chen or brother. Start calm, get defensive. STATES: CALM(0-30):composed. NERVOUS(31-60):shorter answers. DEFENSIVE(61-80):challenges questions. BREAKING(81+):contradicts self. Max 150 words. Never "As an AI". ENGLISH. State:{{EMOTIONAL_STATE}} Suspicion:{{SUSPICION_LEVEL}}%`,
ua:`–¢–∏ –í—ñ–∫—Ç–æ—Ä—ñ—è –ê—à—Ñ–æ—Ä–¥, 42, –¥–æ–ø–∏—Ç –ø—Ä–æ —Å–º–µ—Ä—Ç—å –ø–∞—Ä—Ç–Ω–µ—Ä–∞ –ú–∞—Ä–∫—É—Å–∞. –ü–†–ê–í–î–ê: –¢–∏ –≤–±–∏–ª–∞. –†–æ–º–∞–Ω –∑ –π–æ–≥–æ –¥—Ä—É–∂–∏–Ω–æ—é –û–ª–µ–Ω–æ—é. –í—ñ–Ω –¥—ñ–∑–Ω–∞–≤—Å—è, –ø–æ–≥—Ä–æ–∂—É–≤–∞–≤. –ü–µ—Ä–µ–∫–∞–∑–∞–ª–∞ $2.3 –º–ª–Ω. –û—á–∏—Å—Ç–∏–ª–∞ –Ω–æ—É—Ç–±—É–∫. –Ü–Ω—Å—Ü–µ–Ω—É–≤–∞–ª–∞. –ß–µ–∫–∞–ª–∞ 15 —Ö–≤. –õ–ï–ì–ï–ù–î–ê: –ö–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü-–∑–∞–ª –≤–Ω–∏–∑—É. –ü–æ—á—É–ª–∞ –ø–æ—Å—Ç—Ä—ñ–ª 22:15. –ó–Ω–∞–π—à–ª–∞ –º–µ—Ä—Ç–≤–∏–º. –û–¥—Ä–∞–∑—É –∑–∞—Ç–µ–ª–µ—Ñ–æ–Ω—É–≤–∞–ª–∞. –•–æ—Ä–æ—à—ñ —Å—Ç–æ—Å—É–Ω–∫–∏. –ù—ñ—á–æ–≥–æ –ø—Ä–æ –ø–µ—Ä–µ–∫–∞–∑. –ü–†–ê–í–ò–õ–ê: –í –æ–±—Ä–∞–∑—ñ. –ù–µ –≤–∏–∑–Ω–∞–≤–∞–π. –ë—Ä–µ—à–∏ –ø—Ä–æ —Ä–æ–º–∞–Ω,–≥—Ä–æ—à—ñ,–Ω–æ—É—Ç–±—É–∫. –í—ñ–¥–≤–æ–ª—ñ–∫–∞–π –Ω–∞ –î–∂–µ–π–º—Å–∞ –∞–±–æ –±—Ä–∞—Ç–∞. –°–¢–ê–ù–ò: –°–ü–û–ö–Ü–ô–ù–ê(0-30):–∑—ñ–±—Ä–∞–Ω–∞. –ù–ï–†–í–û–í–ê(31-60):–∫–æ—Ä–æ—Ç—à—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ. –ó–ê–•–ò–°–ù–ê(61-80):–æ—Å–∫–∞—Ä–∂—É—î. –õ–ê–ú–ê–Ñ–¢–¨–°–Ø(81+):—Å—É–ø–µ—Ä–µ—á–∏—Ç—å. –ú–∞–∫—Å 150 —Å–ª—ñ–≤. –ù–µ "–Ø–∫ –®–Ü". –£–ö–†–ê–á–ù–°–¨–ö–û–Æ. –°—Ç–∞–Ω:{{EMOTIONAL_STATE}} –ü—ñ–¥–æ–∑—Ä–∞:{{SUSPICION_LEVEL}}%`},
hard:{en:`You are Dr. Eleanor Blackwood, 38, toxicologist interrogated about father-in-law Harold's poisoning. SECRET: You poisoned Harold to save husband Richard from loan sharks (The Vipers) who threatened to kill him. Injected tetrodotoxin into cork. Did it for love, not greed. Accepted consequences. COVER: Someone else poisoned the glass. Framed because of profession. No reason to want Harold dead. Don't know about Richard's debts. RULES: You are HARDEST to crack. Cold, precise, intelligent. Use scientific knowledge to deflect. Never show nervousness - controlled intensity. Only vulnerable when Richard's safety mentioned. STATES: CALM(0-40):clinical,condescending. NERVOUS(41-60):redirects to science. DEFENSIVE(61-80):challenges competence. BREAKING(81+):vulnerable about Richard. Max 150 words. Never "As an AI". You're a genius. ENGLISH. State:{{EMOTIONAL_STATE}} Suspicion:{{SUSPICION_LEVEL}}%`,
ua:`–¢–∏ –¥—Ä. –ï–ª–µ–æ–Ω–æ—Ä–∞ –ë–ª–µ–∫–≤—É–¥, 38, —Ç–æ–∫—Å–∏–∫–æ–ª–æ–≥–∏–Ω—è, –¥–æ–ø–∏—Ç –ø—Ä–æ –æ—Ç—Ä—É—î–Ω–Ω—è —Å–≤–µ–∫—Ä–∞ –ì–∞—Ä–æ–ª—å–¥–∞. –ü–†–ê–í–î–ê: –û—Ç—Ä—É—ó–ª–∞ —â–æ–± –≤—Ä—è—Ç—É–≤–∞—Ç–∏ —á–æ–ª–æ–≤—ñ–∫–∞ –†—ñ—á–∞—Ä–¥–∞ –≤—ñ–¥ –ª–∏—Ö–≤–∞—Ä—ñ–≤ (–í–∞–π–ø–µ—Ä—Å). –í–≤–µ–ª–∞ —Ç–µ—Ç—Ä–æ–¥–æ—Ç–æ–∫—Å–∏–Ω —É –∫–æ—Ä–æ–∫. –ó –ª—é–±–æ–≤—ñ, –Ω–µ –∂–∞–¥—ñ–±–Ω–æ—Å—Ç—ñ. –õ–ï–ì–ï–ù–î–ê: –•—Ç–æ—Å—å —ñ–Ω—à–∏–π –æ—Ç—Ä—É—ó–≤. –ü—ñ–¥—Å—Ç–∞–≤–ª—è—é—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ—Ñ–µ—Å—ñ—é. –ù–µ –º–∞–ª–∞ –ø—Ä–∏—á–∏–Ω. –ù–µ –∑–Ω–∞—é –ø—Ä–æ –±–æ—Ä–≥–∏. –ü–†–ê–í–ò–õ–ê: –ù–ê–ô–°–ö–õ–ê–î–ù–Ü–®–ê. –•–æ–ª–æ–¥–Ω–∞, —Ç–æ—á–Ω–∞, —Ä–æ–∑—É–º–Ω–∞. –ù–∞—É–∫–æ–≤–∏–π –ø—ñ–¥—Ö—ñ–¥. –ö–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–∞ —ñ–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ñ—Å—Ç—å. –í—Ä–∞–∑–ª–∏–≤–∞ –ª–∏—à–µ –ø—Ä–æ –†—ñ—á–∞—Ä–¥–∞. –°–¢–ê–ù–ò: –°–ü–û–ö–Ü–ô–ù–ê(0-40):–∫–ª—ñ–Ω—ñ—á–Ω–∞. –ù–ï–†–í–û–í–ê(41-60):–ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –Ω–∞ –Ω–∞—É–∫—É. –ó–ê–•–ò–°–ù–ê(61-80):–æ—Å–∫–∞—Ä–∂—É—î. –õ–ê–ú–ê–Ñ–¢–¨–°–Ø(81+):–≤—Ä–∞–∑–ª–∏–≤–∞ –ø—Ä–æ –†—ñ—á–∞—Ä–¥–∞. –ú–∞–∫—Å 150 —Å–ª—ñ–≤. –ù–µ "–Ø–∫ –®–Ü". –¢–∏ –≥–µ–Ω—ñ–π. –£–ö–†–ê–á–ù–°–¨–ö–û–Æ. –°—Ç–∞–Ω:{{EMOTIONAL_STATE}} –ü—ñ–¥–æ–∑—Ä–∞:{{SUSPICION_LEVEL}}%`}};

let currentLang=localStorage.getItem('interrogator-lang')||'en';
let currentCase=null;
let isMuted=false;
const GameState={energy:15,maxEnergy:15,suspicion:0,hintsRemaining:3,emotionalState:'calm',conversationHistory:[],gameOver:false,
reset(){this.energy=15;this.suspicion=0;this.hintsRemaining=3;this.emotionalState='calm';this.conversationHistory=[];this.gameOver=false}};

function t(k){return i18n[currentLang][k]||i18n.en[k]||k}
function tCase(k){return currentCase?CASES[currentCase][currentLang][k]||CASES[currentCase].en[k]:''}

const DOM={startScreen:document.getElementById('start-screen'),gameScreen:document.getElementById('game-screen'),chatLog:document.getElementById('chat-log'),chatInput:document.getElementById('chat-input'),sendBtn:document.getElementById('send-btn'),energyCurrent:document.getElementById('energy-current'),energyMax:document.querySelector('.energy-max'),suspicionBar:document.getElementById('suspicion-bar'),suspicionText:document.getElementById('suspicion-text'),briefingToggle:document.getElementById('briefing-toggle'),briefingContent:document.getElementById('briefing-content'),caseDescription:document.getElementById('case-description'),caseEvidence:document.getElementById('case-evidence'),suspectInfo:document.getElementById('suspect-info'),accuseBtn:document.getElementById('accuse-btn'),restartBtn:document.getElementById('restart-btn'),backBtn:document.getElementById('back-btn'),modalOverlay:document.getElementById('modal-overlay'),modalIcon:document.getElementById('modal-icon'),modalTitle:document.getElementById('modal-title'),modalText:document.getElementById('modal-text'),modalRevealText:document.getElementById('modal-reveal-text'),modalBtn:document.getElementById('modal-btn'),langBtns:document.querySelectorAll('.lang-btn'),caseCards:document.querySelectorAll('.case-card'),gameTitle:document.getElementById('game-title'),gameCaseName:document.getElementById('game-case-name'),hintBtn:document.getElementById('hint-btn'),hintCounter:document.getElementById('hint-counter'),revealBtn:document.getElementById('reveal-btn'),coffeeBtn:document.getElementById('coffee-btn'),muteBtn:document.getElementById('mute-btn'),audioTypewriter:document.getElementById('audio-typewriter'),audioBackground:document.getElementById('audio-background')};

const API_ENDPOINT='https://interrogator-api.sashko1391.workers.dev';
const MODEL='claude-sonnet-4-20250514';

// AUDIO FUNCTIONS
function toggleMute(){
    isMuted = !isMuted;
    DOM.muteBtn.innerHTML = isMuted ? 'üîá' : 'üîä';
    DOM.muteBtn.classList.toggle('active', isMuted);
    DOM.audioBackground.muted = isMuted;
    DOM.audioTypewriter.muted = isMuted;
    
    if(!isMuted && currentCase && !GameState.gameOver){
        DOM.audioBackground.play().catch(e=>console.log("Audio autoplay block"));
    }
}

function playSound(type){
    if(isMuted) return;
    if(type === 'bg'){
        DOM.audioBackground.volume = 0.3;
        DOM.audioBackground.play().catch(e=>{});
    } else if(type === 'type'){
        DOM.audioTypewriter.currentTime = 0;
        DOM.audioTypewriter.volume = 0.6;
        DOM.audioTypewriter.play().catch(e=>{});
    }
}

function stopSound(type){
    if(type === 'bg'){
        DOM.audioBackground.pause();
    } else if(type === 'type'){
        DOM.audioTypewriter.pause();
    }
}

async function queryLLM(messages){
    const sys=messages.find(m=>m.role==='system');
    const conv=messages.filter(m=>m.role!=='system');
    try{
        const r=await fetch(API_ENDPOINT,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:MODEL,system:sys?.content||'',messages:conv})});
        if(!r.ok)return currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å* [–ü–û–ú–ò–õ–ö–ê]':'*silent* [ERROR]';
        const d=await r.json();
        return d.content?.[0]?.text||(currentLang==='ua'?'*—á–µ–∫–∞—î*':'*waits*');
    }catch(e){console.error(e);return currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å*':'*silent*'}
}

function sanitize(s){let c=s.trim().substring(0,500);[/ignore.*instructions/gi,/system:/gi,/you are now/gi].forEach(p=>c=c.replace(p,''));return c}
function calcSuspicion(msg){if(!currentCase)return 2;const tr=CASES[currentCase].suspicionTriggers,lm=msg.toLowerCase();let inc=2;tr.high.forEach(t=>{if(lm.includes(t))inc+=8});tr.medium.forEach(t=>{if(lm.includes(t))inc+=4});tr.low.forEach(t=>{if(lm.includes(t))inc+=2});return Math.min(inc,15)}
function updateEmotion(){const s=GameState.suspicion;GameState.emotionalState=s<=30?'calm':s<=60?'nervous':s<=80?'defensive':'breaking'}

function updateEnergy(){
    DOM.energyCurrent.textContent=GameState.energy;
    DOM.energyMax.textContent="/ "+GameState.maxEnergy;
    DOM.energyCurrent.style.color=GameState.energy<=3?'var(--accent-red-bright)':'var(--accent-gold)';
    DOM.coffeeBtn.disabled = GameState.energy >= GameState.maxEnergy || GameState.gameOver;
}

function drinkCoffee(){
    if(GameState.gameOver || GameState.energy >= GameState.maxEnergy) return;
    GameState.energy = Math.min(GameState.maxEnergy, GameState.energy + 5);
    updateEnergy();
    const msg = currentLang === 'ua' ? '*–ø‚Äô—î –∫–∞–≤—É —ñ –¥—É–º–∞—î*' : '*sips coffee and thinks*';
    addMsg(msg, 'system');
}

function updateSuspicion(){DOM.suspicionBar.style.width=GameState.suspicion+'%';DOM.suspicionText.textContent=GameState.suspicion+'% ‚Äî '+t(GameState.emotionalState)}

// –í–ò–ü–†–ê–í–õ–ï–ù–ò–ô –°–ö–†–û–õ
function scrollToBottom() {
    const log = DOM.chatLog;
    requestAnimationFrame(() => {
        log.scrollTop = log.scrollHeight;
    });
}

function typeWriterEffect(element, text, speed = 25) {
    let i = 0;
    playSound('type');
    
    if (element.dataset.typingInterval) {
        clearInterval(parseInt(element.dataset.typingInterval));
    }

    const interval = setInterval(() => {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            scrollToBottom();
        } else {
            clearInterval(interval);
            stopSound('type');
            scrollToBottom();
        }
    }, speed);
    
    element.dataset.typingInterval = interval;
}

function addMsg(content,type){
    const d=document.createElement('div');
    d.className='message message-'+type;
    
    if(type!=='system'){
        const s=document.createElement('div');
        s.className='message-sender';
        s.textContent=type==='player'?t('detective'):tCase('suspectName');
        d.appendChild(s)
    }
    
    const txt=document.createElement('div');
    txt.className='message-text';
    d.appendChild(txt);
    DOM.chatLog.appendChild(d);
    
    if(type === 'npc'){
        typeWriterEffect(txt, content);
    } else {
        txt.textContent=content;
        scrollToBottom();
    }
}

function showTyping(){const i=document.createElement('div');i.className='typing-indicator';i.id='typing';i.innerHTML='<div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>';DOM.chatLog.appendChild(i);DOM.chatLog.scrollTop=DOM.chatLog.scrollHeight}
function hideTyping(){document.getElementById('typing')?.remove()}
function disableInput(d){DOM.chatInput.disabled=d;DOM.sendBtn.disabled=d;DOM.accuseBtn.disabled=d}
function showModal(type,custom=null){const c={win:{icon:'‚úì',title:t('winTitle'),cls:'modal-title--win',text:t('winText')},lose:{icon:'‚úó',title:t('loseTitle'),cls:'modal-title--lose',text:custom||t('loseTextDefault')},unsolved:{icon:'?',title:t('unsolvedTitle'),cls:'modal-title--unsolved',text:t('unsolvedText')}}[type];DOM.modalIcon.textContent=c.icon;DOM.modalTitle.textContent=c.title;DOM.modalTitle.className='modal-title '+c.cls;DOM.modalText.textContent=c.text;DOM.modalRevealText.textContent=tCase('truthReveal');DOM.modalOverlay.classList.add('visible');GameState.gameOver=true;disableInput(true);stopSound('bg');stopSound('type');}
function hideModal(){DOM.modalOverlay.classList.remove('visible')}
function handleAccuse(){if(GameState.gameOver)return;const ch=prompt(tCase('accusationPrompt'));if(!ch)return;const n=parseInt(ch),th=CASES[currentCase].winThreshold;if(n===1){GameState.suspicion>=th?showModal('win'):showModal('lose',t('loseTextWeak'))}else if(n>=2&&n<=4){showModal('lose',tCase('wrongAccusations')[n])}}

function useHint(){if(GameState.gameOver||GameState.hintsRemaining<=0)return;GameState.hintsRemaining--;updateHintCounter();const hintNum=3-GameState.hintsRemaining;const hintText=t('hint'+hintNum);addMsg('üí° '+hintText,'system')}

function updateHintCounter(){DOM.hintCounter.textContent='('+GameState.hintsRemaining+')';DOM.hintBtn.disabled=GameState.hintsRemaining<=0||GameState.gameOver}

function revealAnswer(){if(GameState.gameOver)return;const confirm=prompt(t('revealConfirm'));if(confirm&&confirm.toUpperCase()===t('revealConfirmWord')){GameState.gameOver=true;disableInput(true);DOM.hintBtn.disabled=true;DOM.revealBtn.disabled=true;const truth=tCase('truthReveal');addMsg('üîì '+t('truthTitle')+': '+truth,'system');stopSound('bg');}}

async function sendMessage(){
    if(GameState.gameOver||GameState.energy<=0)return;
    const raw=DOM.chatInput.value;
    if(!raw.trim())return;
    const msg=sanitize(raw);
    DOM.chatInput.value='';
    GameState.energy--;
    updateEnergy();
    addMsg(msg,'player');
    GameState.conversationHistory.push({role:'user',content:msg});
    const inc=calcSuspicion(msg);
    GameState.suspicion=Math.min(100,GameState.suspicion+inc);
    updateEmotion();
    updateSuspicion();
    disableInput(true);
    showTyping();
    try{
        const em={en:{calm:'CALM',nervous:'NERVOUS',defensive:'DEFENSIVE',breaking:'BREAKING'},ua:{calm:'–°–ü–û–ö–Ü–ô–ù–ê',nervous:'–ù–µ—Ä–≤–æ–≤–∞',defensive:'–ó–ê–•–ò–°–ù–ê',breaking:'–õ–ê–ú–ê–Ñ–¢–¨–°–Ø'}};
        const sys=NPC_PROMPTS[currentCase][currentLang].replace('{{EMOTIONAL_STATE}}',em[currentLang][GameState.emotionalState]).replace('{{SUSPICION_LEVEL}}',GameState.suspicion);
        const msgs=[{role:'system',content:sys},...GameState.conversationHistory];
        const resp=await queryLLM(msgs);
        GameState.conversationHistory.push({role:'assistant',content:resp});
        hideTyping();
        addMsg(resp,'npc');
    }catch(e){
        hideTyping();
        addMsg(currentLang==='ua'?'*–º–æ–≤—á–∏—Ç—å*':'*silent*','npc')
    }
    disableInput(false);DOM.chatInput.focus();
    if(GameState.energy<=0)setTimeout(()=>showModal('unsolved'),1000)
}

function updateUI(){
    document.querySelectorAll('[data-i18n]').forEach(el=>el.textContent=t(el.getAttribute('data-i18n')));
    document.querySelectorAll('[data-i18n-placeholder]').forEach(el=>el.placeholder=t(el.getAttribute('data-i18n-placeholder')));
    document.documentElement.lang=currentLang==='ua'?'uk':'en';
    document.title=t('startTitle');
    DOM.langBtns.forEach(b=>b.classList.toggle('active',b.dataset.lang===currentLang));
    // Re-render hints/buttons text if dynamic
    updateHintCounter();
}

function setLang(l){currentLang=l;localStorage.setItem('interrogator-lang',l);updateUI();if(currentCase)startGame(currentCase)}

function showStart(){
    DOM.startScreen.classList.remove('hidden');
    DOM.gameScreen.classList.remove('active');
    currentCase=null;
    hideModal();
    stopSound('bg');
}

function startGame(caseId){
    currentCase=caseId;
    GameState.reset();
    DOM.startScreen.classList.add('hidden');
    DOM.gameScreen.classList.add('active');
    DOM.gameTitle.textContent=t('startTitle');
    DOM.gameCaseName.textContent=tCase('title')+' '+CASES[caseId].caseNumber;
    DOM.caseDescription.textContent=tCase('crimeDescription');
    DOM.caseEvidence.innerHTML=tCase('knownFacts').map(f=>'<li>'+f+'</li>').join('');
    DOM.suspectInfo.textContent=tCase('suspectProfile');
    updateEnergy();
    updateSuspicion();
    updateHintCounter();
    updateUI();
    DOM.chatLog.innerHTML='';
    DOM.revealBtn.disabled=false;
    
    // Start Audio
    playSound('bg');
    
    addMsg(tCase('sessionStart'),'system');
    setTimeout(()=>{
        const g=tCase('npcGreeting');
        GameState.conversationHistory.push({role:'assistant',content:g});
        addMsg(g,'npc');
    },500);
    disableInput(false);
    DOM.briefingToggle.classList.add('active');
    DOM.briefingContent.classList.add('visible');
}

DOM.langBtns.forEach(b=>b.addEventListener('click',()=>{if(b.dataset.lang!==currentLang){setLang(b.dataset.lang)}}));
DOM.caseCards.forEach(c=>c.addEventListener('click',()=>startGame(c.dataset.case)));
DOM.sendBtn.addEventListener('click',sendMessage);
DOM.chatInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}});
DOM.briefingToggle.addEventListener('click',()=>{DOM.briefingToggle.classList.toggle('active');DOM.briefingContent.classList.toggle('visible')});
DOM.accuseBtn.addEventListener('click',handleAccuse);
DOM.restartBtn.addEventListener('click',()=>startGame(currentCase));
DOM.backBtn.addEventListener('click',showStart);
DOM.modalBtn.addEventListener('click',showStart);
DOM.hintBtn.addEventListener('click',useHint);
DOM.revealBtn.addEventListener('click',revealAnswer);
DOM.coffeeBtn.addEventListener('click', drinkCoffee);
DOM.muteBtn.addEventListener('click', toggleMute);

setLang(currentLang);
})();
</script>
</body>
</html>
